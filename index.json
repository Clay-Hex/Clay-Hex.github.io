[{"content":"0. C++ ä¸­çš„é” ä¸¤ç§æœ€å¸¸ç”¨çš„ï¼šäº’æ–¥é”ã€æ¡ä»¶é”ï¼Œæ­¤å¤–è¿˜æœ‰è‡ªæ—‹é”\n1. C++ ä¸­çš„æ¡ä»¶å˜é‡ 2. ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ å¼•å‡ºè™šå‡å”¤é†’çš„é—®é¢˜\n3. è™šå‡å”¤é†’ æœ‰å¤šä¸ªçº¿ç¨‹åœ¨waitåŒä¸€ä¸ªæ¡ä»¶å˜é‡æ—¶ï¼Œå½“æ¡ä»¶å˜é‡å‘å‡ºnotify_oneçš„æ—¶å€™ï¼Œå„ä¸ªçº¿ç¨‹å»ç«äº‰é”ï¼Œæ­¤æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°é”ï¼Œä½†æ˜¯ï¼Œå…¶ä»–çº¿ç¨‹åœ¨æ”¶åˆ°notify_oneä¿¡å·æ—¶ï¼Œçº¿ç¨‹å·²ç»ä»waité˜Ÿåˆ—æ¢åˆ°é”ç«äº‰çš„é˜Ÿåˆ—äº†ï¼ˆä¸å†ç­‰å¾…notifyçš„é€šçŸ¥äº†ï¼Œè€Œæ˜¯ç­‰å¾…å…¶ä»–çº¿ç¨‹è§£é™¤å¯¹é”çš„å ç”¨ï¼‰ï¼Œä¸€æ—¦æŸä¸ªçº¿ç¨‹æ‹¿åˆ°é”äº†ï¼Œå°±ä¼šç«‹åˆ»å‘ä¸‹æ‰§è¡Œä»£ç ï¼Œä½†æ­¤æ—¶ï¼Œæ¡ä»¶å¯èƒ½å·²ç»å˜äº†ï¼Œä¸æ˜¯é¢„æœŸçš„æ¡ä»¶äº†ã€‚\nè§£å†³åŠæ³•ï¼š\næŠŠifæ”¹æˆwhileï¼Œåœ¨æ”¶åˆ°é€šçŸ¥æ¶ˆæ¯åå¾ªç¯åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚ ä¼ é€’ä¸€ä¸ªlambdaå‡½æ•°ç»™waitå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥lambdaæ–¹æ³•è¿”å›ç­‰å¾…çš„æ¡ä»¶ã€‚è¯¥æ–¹å¼å¯ä»¥ç†è§£ä¸ºï¼Œåœ¨æ”¶åˆ°notifyä¿¡å·åï¼Œçº¿ç¨‹å…ˆç«äº‰é”ï¼Œå¾—åˆ°é”åï¼Œå†æ£€æŸ¥ä¸€ä¸‹lambdaå‡½æ•°çš„è¿”å›å€¼ï¼Œå¦‚æœè¿”å›å€¼æ˜¯trueï¼Œåˆ™ç»“æŸwaitçŠ¶æ€ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚å¦‚æœè¿”å›falseï¼Œåˆ™è§£é”ï¼Œç»§ç»­waitã€‚æœ¬è´¨ä¸Šç­‰ä»·äºè§£å†³åŠæ³•1ã€‚ ","permalink":"https://Clay-Hex.github.io/posts/2022/11/cpp-conditional-variables-lock/","summary":"0. C++ ä¸­çš„é” ä¸¤ç§æœ€å¸¸ç”¨çš„ï¼šäº’æ–¥é”ã€æ¡ä»¶é”ï¼Œæ­¤å¤–è¿˜æœ‰è‡ªæ—‹é” 1. C++ ä¸­çš„æ¡ä»¶å˜é‡ 2. ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ å¼•å‡ºè™šå‡å”¤é†’çš„é—®é¢˜ 3. è™šå‡å”¤é†’ æœ‰å¤šä¸ªçº¿ç¨‹åœ¨waitåŒä¸€ä¸ªæ¡ä»¶å˜é‡æ—¶ï¼Œå½“æ¡ä»¶å˜é‡å‘å‡ºnotify_oneçš„æ—¶å€™ï¼Œå„ä¸ªçº¿ç¨‹å»ç«äº‰é”ï¼Œæ­¤æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°é”ï¼Œä½†æ˜¯ï¼Œå…¶ä»–çº¿ç¨‹åœ¨æ”¶åˆ°notify_on","title":"C++å­¦ä¹ è®°å½•(15) æ¡ä»¶å˜é‡ä¸äº’æ–¥é”"},{"content":"0. QTä¸­çº¿ç¨‹å¯åŠ¨çš„æ–¹å¼ 0.1 ç»§æ‰¿QThread ç»§æ‰¿QThreadæ—¶ï¼Œå­ç±»å¿…é¡»é‡å†™runæ–¹æ³•ï¼Œä¿è¯çº¿ç¨‹åœ¨æ‰‹åŠ¨ç»“æŸä¹‹å‰æŒç»­è¿è¡Œã€‚\nå½“å­ç±»ä½¿ç”¨startæ–¹æ³•å¯åŠ¨åï¼Œrunæ–¹æ³•ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸå†…å¾ªç¯æ‰§è¡Œã€‚\n.hæ–‡ä»¶\n#ifndef CLASS1_H #define CLASS1_H #include \u0026lt;QObject\u0026gt; #include \u0026lt;QThread\u0026gt; // ç»§æ‰¿QTQThread class Class1 : public QThread { Q_OBJECT public: explicit Class1(QThread *parent = 0); ~Class1(); void run() override; public slots: void testFunc(); }; #endif // CLASS1_H .cppæ–‡ä»¶\n#include \u0026#34;class1.h\u0026#34; #include \u0026lt;QDebug\u0026gt; Class1::Class1(QThread *parent) : QThread(parent) { } Class1::~Class1() { } void Class1::run() { qDebug() \u0026lt;\u0026lt; \u0026#34;class 1 run threadID : \u0026#34; \u0026lt;\u0026lt; currentThreadId(); while(1){ // æµ‹è¯•ä»£ç ï¼Œå†™æˆäº†æ­»å¾ªç¯ï¼Œå®é™…ä¸­åº”è¯¥é¿å…è¿™æ ·å†™ msleep(5); } } void Class1::testFunc() { qDebug() \u0026lt;\u0026lt; \u0026#34;class1 testFunc threadID : \u0026#34; \u0026lt;\u0026lt; currentThreadId(); } 0.2 ä½¿ç”¨moveToThreadå¯åŠ¨ è¿™ç§æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œæ­£å¸¸å†™è‡ªå·±çš„ç±»å³å¯ï¼Œä¸ºäº†ä¿è¯å…¶æ–¹æ³•å¯ä»¥åœ¨çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œéœ€è¦ç»§æ‰¿QObjectç±»ã€‚\nåœ¨ä½¿ç”¨æ—¶é¦–å…ˆç”Ÿæˆå­ç±»å¯¹è±¡ï¼ŒåŒæ—¶newä¸€ä¸ªQThreadå‡ºæ¥ï¼Œç„¶åä½¿ç”¨å­ç±»çš„moveToThreadæ–¹æ³•ï¼Œå°†å­ç±»æ”¾åˆ°åˆšåˆšnewå‡ºæ¥çš„QThreadä¸Šï¼Œå†å¯åŠ¨è¯¥çº¿ç¨‹å³å¯ã€‚\n.hæ–‡ä»¶\n#ifndef CLASS2_H #define CLASS2_H #include \u0026lt;QObject\u0026gt; // ä½¿ç”¨moveToThread class Class2 : public QObject { Q_OBJECT public: explicit Class2(QObject *parent = nullptr); ~Class2(); public slots: void testFunc(); }; #endif // CLASS2_H .cppæ–‡ä»¶\n#include \u0026#34;class2.h\u0026#34; #include \u0026lt;QDebug\u0026gt; #include \u0026lt;QThread\u0026gt; Class2::Class2(QObject *parent) : QObject(parent) { } Class2::~Class2() { } void Class2::testFunc() { qDebug() \u0026lt;\u0026lt; \u0026#34;class2 testFunc threadID : \u0026#34; \u0026lt;\u0026lt; QThread::currentThreadId(); } 0.3 ä½¿ç”¨QtConcurrentå¯åŠ¨ QtConcurrentæ–¹å¼é€šå¸¸ç”¨äºåœ¨å½“å‰çº¿ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªè€—æ—¶çš„æ–¹æ³•ï¼Œå°†è¯¥æ–¹æ³•å•ç‹¬æ”¾åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚åªéœ€è¦ä¸€è¡Œä»£ç å³å¯ã€‚\nå¯åŠ¨åï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚å¯ä»¥é…åˆQFutureç±»è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœã€‚\n1. å¯¹è±¡æ–¹æ³•è°ƒç”¨æ—¶çš„å‘ 1.1 å¯¹è±¡æ–¹æ³•è°ƒç”¨æ–¹å¼ æœ‰ä¸¤ç§ã€‚\nç›´æ¥è°ƒç”¨ï¼Œobject.func()æˆ–è€…object-\u0026gt;func ä½¿ç”¨QTä¸­çš„ä¿¡å·æ§½æ–¹å¼ï¼Œ 1.2 å‘ ä½¿ç”¨ç»§æ‰¿QThreadçš„æ–¹å¼æ—¶ï¼Œåªæœ‰runæ–¹æ³•å’Œrunè°ƒç”¨çš„æ–¹æ³•ä¼šåœ¨å­çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚\nå½“ä¸»çº¿ç¨‹ç›´æ¥è°ƒç”¨è¯¥ç±»çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ç”±ä¸»çº¿ç¨‹è´Ÿè´£æ‰§è¡Œã€‚ å½“ä¸»çº¿ç¨‹ä½¿ç”¨ä¿¡å·æ§½çš„æ–¹å¼è°ƒç”¨è¯¥ç±»çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ç”±ä¸»çº¿ç¨‹è´Ÿè´£æ‰§è¡Œã€‚ ä½¿ç”¨moveToThreadçš„æ–¹å¼æ—¶ï¼Œå…·æœ‰æ›´å¥½çš„çµæ´»æ€§ã€‚\nå½“ä¸»çº¿ç¨‹ç›´æ¥è°ƒç”¨è¯¥ç±»çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ç”±ä¸»çº¿ç¨‹è´Ÿè´£æ‰§è¡Œã€‚ å½“ä¸»çº¿ç¨‹ä½¿ç”¨ä¿¡å·æ§½çš„æ–¹å¼è°ƒç”¨è¯¥ç±»çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œç”±ä¸»çº¿ç¨‹æ‰§è¡Œè¿˜æ˜¯ç”±å­çº¿ç¨‹æ‰§è¡Œï¼Œæ ¹æ®ä¿¡å·æ§½çš„è¿æ¥æ–¹å¼ç¡®å®šã€‚ 2. ä¿¡å·æ§½çš„5ç§è¿æ¥æ–¹å¼ åœ¨Qtçš„ä¿¡å·æ§½æœºåˆ¶å½“ä¸­ï¼Œæœ‰5ç§è¿æ¥æ–¹å¼ã€‚\nåœ¨ä»£ç ä¸­ä½¿ç”¨ä¿¡å·æ§½æœºåˆ¶çš„æ—¶å€™ï¼Œé€šå¸¸åªéœ€è¦ä¸‹è¾¹çš„ä¸€è¡Œä»£ç \nconnect(sender, signal, receiver, slot)\nconnectæ–¹æ³•é™¤äº†ä¿¡å·å‘é€è€…ã€ä¿¡å·ã€ä¿¡å·æ¥æ”¶è€…ã€æ§½å‡½æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ç¬¬äº”ä¸ªå‚æ•°ï¼šè¿™å¯¹ä¿¡å·æ§½çš„è¿æ¥æ–¹å¼ã€‚\n2.1 ç›´æ¥è¿æ¥ Qt::DirectConnection\næ§½å‡½æ•°åœ¨ä¿¡å·å‘é€è€…æ‰€åœ¨çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ•ˆæœå°±åƒæ˜¯åœ¨ä¿¡å·å‘å°„ä½ç½®ç›´æ¥è°ƒç”¨æ§½å‡½æ•°ã€‚\n2.2 é˜Ÿåˆ—è¿æ¥ Qt::QueuedConnection\næ§½å‡½æ•°åœ¨ä¿¡å·æ¥æ”¶è€…æ‰€åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä½†æ˜¯ï¼Œè¯¥æ§½å‡½æ•°ä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œæ˜¯æ”¾å…¥åˆ°ä¿¡å·æ¥æ”¶è€…çº¿ç¨‹ä¸­çš„æ§½å‡½æ•°é˜Ÿåˆ—å†…ï¼Œç­‰åˆ°è¯¥æ§½å‡½æ•°å‰è¾¹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šæ‰§è¡Œè¯¥æ§½å‡½æ•°ã€‚\nå¯è§ï¼Œå¦‚æœæ§½å‡½æ•°æ¥æ”¶è€…çº¿ç¨‹ä¸­æœ‰æ­»å¾ªç¯æ§½å‡½æ•°è¢«æ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆåœ¨æ­»å¾ªç¯ä¹‹åçš„æ§½å‡½æ•°å°±æ°¸è¿œéƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚\nä½¿ç”¨è¿™ç§æ–¹å¼æ—¶ï¼Œä¿¡å·å‘é€è€…ä¿¡å·å‘å‡ºåï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚\n2.3 é˜»å¡é˜Ÿåˆ—è¿æ¥ Qt::BlockingQueuedConnection\nä¸é˜Ÿåˆ—è¿æ¥ç±»ä¼¼ï¼Œä½†ï¼šåœ¨ä½¿ç”¨é˜»å¡é˜Ÿåˆ—è¿æ¥æ–¹å¼ï¼Œå‘é€ä¿¡å·åï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æ§½å‡½æ•°æ‰§è¡Œå®Œæ¯•æ‰æ¢å¤ã€‚\nå¯è§ï¼šä½¿ç”¨è¿™ç§æ–¹å¼æ—¶ï¼Œå¦‚æœä¿¡å·å’Œæ§½å‡½æ•°åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä¼šé€ æˆæ­»é”ã€‚\n2.4 è‡ªåŠ¨è¿æ¥ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ–è€…åˆšæ¥è§¦Qtå¼€å‘æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§æ–¹å¼è¿›è¡Œè¿æ¥ã€‚\nåœ¨è‡ªåŠ¨è¿æ¥æ–¹å¼ä¸­ï¼š\nå¦‚æœä¿¡å·å‘é€è€…å’Œæ¥æ”¶è€…åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåˆ™ä½¿ç”¨ç›´æ¥è¿æ¥Qt::DirectConnection å¦‚æœä¿¡å·å‘é€è€…å’Œæ¥æ”¶è€…åœ¨ä¸åŒçº¿ç¨‹ä¸­ï¼Œåˆ™ä½¿ç”¨é˜Ÿåˆ—è¿æ¥Qt::QueuedConnection 2.5 å•ä¸€è¿æ¥ Qt::UniqueConnection\nå…¶å®ï¼Œè¿™ä¸ªä¸ç®—è¿æ¥æ–¹å¼ï¼Œè¯¥å€¼å¯ä»¥ç¡®ä¿å½“å‰ä¿¡å·å’Œå½“å‰æ§½å‡½æ•°çš„è¿æ¥ä»…è¿›è¡Œä¸€æ¬¡ï¼Œä¸å¯ä»¥è¿›è¡Œé‡å¤çš„ç›¸åŒè¿æ¥ã€‚\nå¯ä»¥é€šè¿‡æˆ–è¿ç®—ï¼Œä¸å…¶ä»–4ç§æ–¹å¼ç»“åˆä½¿ç”¨ã€‚\n3. æµ‹è¯•ä»£ç  åˆ›å»ºQtå·¥ç¨‹ï¼Œåˆ›å»ºç•Œé¢å¦‚ä¸‹ï¼š\nåœ¨uiç±»ä¸­æ·»åŠ class1å’Œclass2ä¸¤ä¸ªç±»çš„æŒ‡é’ˆï¼ˆä¸Šè¾¹æœ‰ä»£ç ï¼‰ï¼Œclass1ä½¿ç”¨ç»§æ‰¿QThreadçš„æ–¹å¼ï¼Œclass2ä½¿ç”¨moveToThreadçš„æ–¹å¼ã€‚\nç•Œé¢ä¸­çš„4ä¸ªæŒ‰é’®éƒ½æ˜¯è°ƒç”¨class1å’Œclass2å¯¹è±¡ä¸­çš„testFuncæ–¹æ³•è¾“å‡ºå¯¹è±¡æ–¹æ³•çš„æ‰§è¡Œçº¿ç¨‹IDã€‚ä½†è°ƒç”¨æ–¹å¼ä¸åŒã€‚\nTestClass1å’ŒTestClass2æŒ‰é’®ç›´æ¥è°ƒç”¨ï¼Œå…¶ä½™ä¸¤ä¸ªä½¿ç”¨ä¿¡å·æ§½çš„æ–¹å¼è°ƒç”¨ã€‚\nä»£ç å¦‚ä¸‹ï¼š\n.h æ–‡ä»¶\n#ifndef MAINWINDOW_H #define MAINWINDOW_H #include \u0026lt;QMainWindow\u0026gt; #include \u0026lt;QDebug\u0026gt; #include \u0026lt;QThread\u0026gt; #include \u0026lt;QTime\u0026gt; #include \u0026#34;class1.h\u0026#34; #include \u0026#34;class2.h\u0026#34; namespace Ui { class MainWindow; } class MainWindow : public QMainWindow { Q_OBJECT public: explicit MainWindow(QWidget *parent = nullptr); ~MainWindow(); signals: void signal_test1_func(); void signal_test2_func(); private slots: void on_pushButton_test1_clicked(); void on_pushButton_test1s_clicked(); void on_pushButton_test2_clicked(); void on_pushButton_test2s_clicked(); private: Ui::MainWindow *ui; Class1 *m_c1Thread = nullptr; // ç»§æ‰¿QThreadçš„ Class2 *m_c2 = nullptr; // ä½¿ç”¨moveToThread QThread *m_c2Thread = nullptr; }; #endif // MAINWINDOW_H .cpp æ–‡ä»¶\n#include \u0026#34;mainwindow.h\u0026#34; #include \u0026#34;ui_mainwindow.h\u0026#34; MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent), ui(new Ui::MainWindow) { ui-\u0026gt;setupUi(this); qDebug() \u0026lt;\u0026lt; \u0026#34;main threadID : \u0026#34; \u0026lt;\u0026lt; QThread::currentThreadId(); m_c1Thread = new Class1; m_c2 = new Class2; m_c2Thread = new QThread(this); m_c2-\u0026gt;moveToThread(m_c2Thread); connect(this, \u0026amp;MainWindow::signal_test1_func, m_c1Thread, \u0026amp;Class1::testFunc); connect(this, \u0026amp;MainWindow::signal_test2_func, m_c2, \u0026amp;Class2::testFunc); // è¿™é‡Œçš„è¿æ¥æ–¹å¼ä¸€ä¼šè¦åšä¿®æ”¹ m_c1Thread-\u0026gt;start(); m_c2Thread-\u0026gt;start(); } MainWindow::~MainWindow() { m_c1Thread-\u0026gt;quit(); m_c1Thread-\u0026gt;wait(); m_c2Thread-\u0026gt;quit(); m_c2Thread-\u0026gt;wait(); delete m_c1Thread; delete m_c2Thread; delete m_c2; delete ui; } void MainWindow::on_pushButton_test1_clicked() { // m_c1Thread ç»§æ‰¿è‡ª QThread m_c1Thread-\u0026gt;testFunc(); } void MainWindow::on_pushButton_test1s_clicked() { // m_c1Thread ç»§æ‰¿è‡ª QThread emit signal_test1_func(); } void MainWindow::on_pushButton_test2_clicked() { // m_c2 ä½¿ç”¨ moveToThread å¯åŠ¨ m_c2-\u0026gt;testFunc(); } void MainWindow::on_pushButton_test2s_clicked() { // m_c2 ä½¿ç”¨ moveToThread å¯åŠ¨ emit signal_test2_func(); } æ³¨æ„ä»£ç ä¸­çš„\nconnect(this, \u0026amp;MainWindow::signal_test2_func, m_c2, \u0026amp;Class2::testFunc); è¿™é‡Œï¼Œclass2å¯¹è±¡çš„è¿æ¥æ–¹å¼ä½¿ç”¨é»˜è®¤çš„æ–¹å¼ï¼Œå³è‡ªåŠ¨è¿æ¥ã€‚\nç¨‹åºè¿è¡Œåï¼ŒæŒ‰ç¬¬ä¸€è¡Œã€ç¬¬äºŒè¡Œçš„é¡ºåºç‚¹å‡»4ä¸ªæŒ‰é’®ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\nä»…æœ‰ç¬¬å››ä¸ªæŒ‰é’®ï¼ˆä½¿ç”¨moveToThreadå¯åŠ¨çº¿ç¨‹ï¼Œä¿¡å·æ§½æ–¹å¼è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼‰åœ¨å­çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚å¯è§ï¼Œclass2å¯¹è±¡çš„è¿æ¥æ–¹å¼æ­¤æ—¶æ˜¯é˜Ÿåˆ—è¿æ¥ã€‚\nå½“ä¿®æ”¹class2å¯¹è±¡çš„è¿æ¥æ–¹å¼ä¸ºé˜Ÿåˆ—\nconnect(this, \u0026amp;MainWindow::signal_test2_func, m_c2, \u0026amp;Class2::testFunc, Qt::QueuedConnection); å†æ¬¡æ‰§è¡Œï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š\nå››ä¸ªæŒ‰é’®çš„æ–¹æ³•éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œäº†ï¼Œå°è¯äº†1.2èŠ‚ä¸­çš„æè¿°ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2022/11/qt-thread/","summary":"0. QTä¸­çº¿ç¨‹å¯åŠ¨çš„æ–¹å¼ 0.1 ç»§æ‰¿QThread ç»§æ‰¿QThreadæ—¶ï¼Œå­ç±»å¿…é¡»é‡å†™runæ–¹æ³•ï¼Œä¿è¯çº¿ç¨‹åœ¨æ‰‹åŠ¨ç»“æŸä¹‹å‰æŒç»­è¿è¡Œã€‚ å½“å­ç±»ä½¿ç”¨startæ–¹æ³•å¯åŠ¨åï¼Œrunæ–¹æ³•ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸå†…å¾ªç¯æ‰§è¡Œã€‚ .hæ–‡ä»¶ #ifndef CLASS1_H #define CLASS1_H #include \u0026lt;QObject\u0026gt; #include \u0026lt;QThread\u0026gt; // ç»§æ‰¿QTQThread class Class1 : public QThread { Q_OBJECT public: explicit Class1(QThread *parent = 0); ~Class1(); void run() override; public slots: void testFunc(); }; #endif","title":"QTä¸­çº¿ç¨‹å¯åŠ¨æ–¹å¼å’Œæ“ä½œçš„æ³¨æ„é—®é¢˜"},{"content":"0. ERSç®—æ³• xxx\n1. é—®é¢˜ åŸæœ¬ERSç®—æ³•çš„ä½œè€…æä¾›äº†pythonæ¥å£ï¼Œä½†æ˜¯æ˜¯åŸºäºPython2çš„ï¼Œåœ¨python3.6ä¸­è°ƒç”¨çš„è¯ï¼Œä¼šå‡ºç°ç¼ºå¤±DLLçš„é”™è¯¯ï¼Œå¦‚ä¸‹å›¾ï¼š\n2. è§£å†³æ–¹æ¡ˆ ä½œè€…æä¾›äº†ERSç®—æ³•çš„Cè¯­è¨€æºä»£ç ï¼Œæ‰€ä»¥åŸºäºPython3.6é‡æ–°ç¼–è¯‘ä¸€ä¸‹å³å¯ã€‚\n2.1 å®‰è£…vs æˆ‘å®‰è£…çš„æ˜¯VS2017ç¤¾åŒºç‰ˆã€‚\nç­‰å¾…å®‰è£…å®Œæˆã€‚\n2.2 è§£å‹boost å®‰è£… boost 1.6.0ï¼Œé«˜çš„ç‰ˆæœ¬ä¼šå‡ºé—®é¢˜ï¼Œæœ‰äº›æ¥å£è¢«å–æ¶ˆäº†ã€‚\nç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶\nhttps://dl.bintray.com/boostorg/release/1.64.0/binaries/\nä¸‹è½½ boost_1_64_0-msvc-14.1-64.exeï¼Œè¿è¡Œã€‚\næˆ‘è§£å‹åˆ°äº†C:\\local\\ç›˜æ ¹ç›®å½•ä¸‹ã€‚\næ‰“å¼€vs2017å¸¦çš„å¼€å‘äººå‘˜å·¥å…·ã€‚\ncd /d C:\\local\\boost_1_64_0åˆ°boostç›®å½•ä¸‹\næ‰§è¡Œbootstrap.batï¼Œç›®å½•ä¸‹ä¼šç”Ÿæˆbjam.exeå’Œb2.exeä¸¤ä¸ªæ–‡ä»¶ï¼Œéƒ½å¯ä»¥ç”¨äºç¼–è¯‘boostã€‚\næ‰§è¡Œb2.exeå¼€å§‹ç¼–è¯‘ã€‚\nç¼–è¯‘æˆåŠŸã€‚\n2.3 å‡†å¤‡python3.6ç¯å¢ƒ æˆ‘ç”¨çš„Anacondaï¼Œä¸‹å¥½äº†Python3.6çš„ç¯å¢ƒ\n2.4 ç¼–è¯‘ ç”¨VS2017 æ‰“å¼€ERSæºç ä¸­çš„å·¥ç¨‹æ–‡ä»¶\nç‚¹å‡»ã€ç¡®å®šã€‘\nå¼€å§‹é…ç½®åŒ…å«ç›®å½•ã€‚\né…ç½®åº“ç›®å½•\nç‚¹å‡»ç¼–è¯‘ï¼ŒæŠ¥é”™äº†\næŠŠè¿”å›å€¼NULLåˆ æ‰ï¼Œå†ç¼–è¯‘ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2022/05/python3-ers-superpixel-segmentation/","summary":"0. ERSç®—æ³• xxx 1. é—®é¢˜ åŸæœ¬ERSç®—æ³•çš„ä½œè€…æä¾›äº†pythonæ¥å£ï¼Œä½†æ˜¯æ˜¯åŸºäºPython2çš„ï¼Œåœ¨python3.6ä¸­è°ƒç”¨çš„è¯ï¼Œä¼šå‡ºç°ç¼ºå¤±DLLçš„é”™è¯¯ï¼Œå¦‚ä¸‹å›¾ï¼š 2. è§£å†³æ–¹æ¡ˆ ä½œè€…æä¾›äº†ERSç®—æ³•çš„Cè¯­è¨€æºä»£ç ï¼Œæ‰€ä»¥åŸºäºPython3.6é‡æ–°ç¼–è¯‘ä¸€ä¸‹å³å¯ã€‚ 2.1 å®‰è£…vs æˆ‘å®‰è£…çš„æ˜¯VS2017ç¤¾","title":"Python3.6ç¯å¢ƒä½¿ç”¨ERSè¶…åƒç´ åˆ†å‰²ç®—æ³•"},{"content":"0. è¡¨è¾¾å¼æ ‘ åœ¨ä¸€é¢—æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹éƒ½æ˜¯æ“ä½œæ•°ï¼Œæ‰€æœ‰çš„éå¶å­èŠ‚ç‚¹éƒ½æ˜¯è¿ç®—ç¬¦ï¼Œè¿™æ ·çš„æ ‘å«åšè¡¨è¾¾å¼æ ‘ã€‚\nå¦‚å›¾:\n1. åç¼€è¡¨è¾¾å¼è®¡ç®— åç¼€è¡¨è¾¾å¼ï¼šä¹Ÿå«é€†æ³¢å…°è¡¨è¾¾å¼ï¼Œæ˜¯è¡¨è¾¾å¼æ ‘çš„ååºéå†ã€‚\nåœ¨è®¡ç®—æ—¶ï¼Œä¸ç”¨è¿˜åŸå‡ºæ•´æ£µæ ‘ï¼Œå¯ç”¨ä¸€ä¸ªæ ˆæ¥è¾…åŠ©è®¡ç®—ã€‚\nleetcode 150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼\nclass Solution { public: int evalRPN(vector\u0026lt;string\u0026gt;\u0026amp; tokens) { int st[10005]; int tt = 0; for( auto \u0026amp;x : tokens){ if(x == \u0026#34;+\u0026#34; || x == \u0026#34;-\u0026#34; || x == \u0026#34;*\u0026#34; || x == \u0026#34;/\u0026#34;) { int b = st[tt--]; int a = st[tt--]; if(x == \u0026#34;+\u0026#34;) st[++tt] = a + b; else if(x == \u0026#34;-\u0026#34;) st[++tt] = a - b; else if(x == \u0026#34;*\u0026#34;) st[++tt] = a * b; else st[++tt] = a / b; } else st[++tt] = stoi(x); } return st[tt]; } }; 2. ä¸­ç¼€è¡¨è¾¾å¼è®¡ç®— æ³•1: è½¬æˆåç¼€è¡¨è¾¾å¼è®¡ç®—ã€‚ æ³•2ï¼š ç›´æ¥åˆ©ç”¨è¡¨è¾¾å¼æ ‘è®¡ç®—ç»“æœ\néœ€è¦ä¸¤ä¸ªæ ˆï¼šæ•°å­—æ ˆ å’Œ ç¬¦å·æ ˆ\nä¼ªä»£ç ï¼š\nif æ˜¯æ•°å­— å…¥æ ˆ else if å·¦æ‹¬å· å…¥æ ˆ else if å³æ‹¬å· while æ ˆé¡¶å…ƒç´ ä¸æ˜¯å·¦æ‹¬å· æ¶ˆè€—æ ˆé¡¶ä¸¤ä¸ªæ•°å­— å’Œ ä¸€ä¸ªç¬¦å· åšä¸€æ¬¡è®¡ç®— å¼¹å‡ºå·¦æ‹¬å· else //æ˜¯æ™®é€šç¬¦å· while å½“å‰ç¬¦å·ä¼˜å…ˆçº§ \u0026lt;= æ ˆé¡¶ç¬¦å·ä¼˜å…ˆçº§ æ¶ˆè€—æ ˆé¡¶ä¸¤ä¸ªæ•°å­— å’Œ ä¸€ä¸ªç¬¦å· åšä¸€æ¬¡è®¡ç®—ï¼ˆæŠŠä¹‹å‰å¯ä»¥è®¡ç®—çš„ éƒ½è®¡ç®—å‡ºæ¥ï¼Œç”¨ä½œä¸‹ä¸€æ¬¡è®¡ç®—ï¼‰ å½“å‰ç¬¦å·å…¥æ ˆ /* * @Brief: * @Author: * @Date: 2021-07-14 */ #include \u0026lt;iostream\u0026gt; #include \u0026lt;algorithm\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;queue\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;stack\u0026gt; #include \u0026lt;unordered_map\u0026gt; using namespace std; stack\u0026lt;int\u0026gt; num; stack\u0026lt;char\u0026gt; op; void calc(){ int b = num.top(); num.pop(); int a = num.top(); num.pop(); char c = op.top(); op.pop(); if(c == \u0026#39;+\u0026#39;) num.push(a + b); else if(c == \u0026#39;-\u0026#39;) num.push(a - b); else if(c == \u0026#39;*\u0026#39;) num.push(a * b); else num.push(a / b); } int main(){ string sc; cin \u0026gt;\u0026gt; sc; unordered_map\u0026lt;char, int\u0026gt; mp = {{\u0026#39;+\u0026#39;, 1}, {\u0026#39;-\u0026#39;, 1}, {\u0026#39;*\u0026#39;, 2}, {\u0026#39;/\u0026#39;, 2}}; for(int i = 0; i \u0026lt; sc.size(); i++){ auto c = sc[i]; if( isdigit(c) ){ int x = 0, j = i; while(j \u0026lt; sc.size() \u0026amp;\u0026amp; isdigit(sc[j])) x = x * 10 + sc[j++] -\u0026#39;0\u0026#39;; num.push(x); i = j - 1; }else if(c == \u0026#39;(\u0026#39;) op.push(c); else if(c == \u0026#39;)\u0026#39;){ while(op.top() != \u0026#39;(\u0026#39;) calc(); // å¼¹å‡ºå·¦æ‹¬å· op.pop(); } else { // æ™®é€šè¿ç®—ç¬¦ while(op.size() \u0026amp;\u0026amp; mp[c] \u0026lt;= mp[op.top()]) calc(); // æŠŠä¹‹å‰å¯ä»¥è®¡ç®—çš„ éƒ½è®¡ç®—å‡ºæ¥ op.push(c); } } while(op.size()) calc(); cout \u0026lt;\u0026lt; num.top() \u0026lt;\u0026lt; endl; return 0; } ","permalink":"https://Clay-Hex.github.io/posts/2022/05/cpp-arithmetic-expression/","summary":"0. è¡¨è¾¾å¼æ ‘ åœ¨ä¸€é¢—æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹éƒ½æ˜¯æ“ä½œæ•°ï¼Œæ‰€æœ‰çš„éå¶å­èŠ‚ç‚¹éƒ½æ˜¯è¿ç®—ç¬¦ï¼Œè¿™æ ·çš„æ ‘å«åšè¡¨è¾¾å¼æ ‘ã€‚ å¦‚å›¾: 1. åç¼€è¡¨è¾¾å¼è®¡ç®— åç¼€è¡¨è¾¾å¼ï¼šä¹Ÿå«é€†æ³¢å…°è¡¨è¾¾å¼ï¼Œæ˜¯è¡¨è¾¾å¼æ ‘çš„ååºéå†ã€‚ åœ¨è®¡ç®—æ—¶ï¼Œä¸ç”¨è¿˜åŸå‡ºæ•´æ£µæ ‘ï¼Œå¯ç”¨ä¸€ä¸ªæ ˆæ¥è¾…åŠ©è®¡ç®—ã€‚ leetcode 150. é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼ class Solution { public: int evalRPN(vector\u0026lt;string\u0026gt;\u0026amp; tokens) { int st[10005]; int tt = 0; for( auto \u0026amp;x : tokens){ if(x == \u0026#34;+\u0026#34;","title":"ç®—æœ¯è¡¨è¾¾å¼è®¡ç®—æ–¹æ³•"},{"content":"0. æ•°æ®é›†æ¦‚è¿° Cityscapes æ•°æ®é›†ä¸“æ³¨äºå¯¹åŸå¸‚è¡—æ™¯çš„è¯­ä¹‰ç†è§£ã€‚\n1. ç‰¹ç‚¹ å¤šè¾¹å½¢çš„æ ‡ç­¾\nå®ä¾‹åˆ†å‰²è½¦è¾†å’Œäºº\n30ä¸ªç±»åˆ«\n5000å¼ ç²¾ç»†æ ‡æ³¨çš„å›¾\n20000å¼ ç²—ç•¥æ ‡æ³¨çš„å›¾\nleftImg8bit_trainvaltest.zip (11GB)\nleft 8-bit images - train, val, and test sets (5000 images)\nhttps://www.cityscapes-dataset.com/file-handling/?packageID=3\nrightImg8bit_trainvaltest.zip (11GB)\nright 8-bit images - train, val, and test sets (5000 images)\nhttps://www.cityscapes-dataset.com/file-handling/?packageID=5\ndisparity_trainvaltest.zip (3.5GB)\nprecomputed depth maps using SGM for train, val, and test sets (5000 images)\nhttps://www.cityscapes-dataset.com/file-handling/?packageID=7\ncamera_trainvaltest.zip (2MB) [md5]\nintrinsic and extrinsic camera parameters for train, val, and test sets\nhttps://www.cityscapes-dataset.com/file-handling/?packageID=8\nè„šæœ¬å®‰è£… 1. ä½¿ç”¨githubå®‰è£… https://github.com/mcordts/cityscapesScripts\nä»githubä¸Šä¸‹è½½å®˜æ–¹æä¾›çš„è„šæœ¬ä»£ç ã€‚\nç„¶åæŠŠä¸‹è½½çš„æ•°æ®é›†æ•°æ®ä¹Ÿæ”¾è¿›æ¥ï¼Œå’Œsetup.pyæ”¾åœ¨åŒçº§ç›®å½•ä¸‹ã€‚ä¾‹å¦‚ä¸‹å›¾ï¼ˆå›¾ä¸­çš„only_personæ–‡ä»¶å¤¹æ˜¯æœ¬äººè‡ªå»ºçš„ï¼Œå®˜æ–¹æä¾›çš„æ²¡æœ‰ï¼‰\næ‰“å¼€å‘½ä»¤è¡Œï¼Œcdåˆ°è¯¥ç›®å½•ä¸‹ï¼Œæ‰§è¡Œï¼š\npython setup.py install\nç­‰å¾…å®‰è£…å®Œæˆå³å¯ã€‚\nå®‰è£…çš„æ—¶å€™å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæç¤º\u0026quot;README.MD\u0026ldquo;æ€ä¹ˆæ€ä¹ˆæ ·ï¼Œä¸€ä¸ªç¼–ç é—®é¢˜ï¼Œç®€å•ç²—æš´çš„è§£å†³åŠæ³•å°±æ˜¯æ–°å»ºä¸€ä¸ªç©ºç™½æ–‡ä»¶æŠŠREADME.MDæ–‡ä»¶æ›¿æ¢æ‰ï¼Œä¸å½±å“åç»­å®‰è£…ã€‚\n2. ä½¿ç”¨pipåœ¨çº¿å®‰è£… æŒ‰ç…§githubä¸Šæç¤ºï¼Œç›´æ¥ï¼š\npython -m pip install cityscapesscripts\næœ¬äººç”¨çš„ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ²¡ç”¨è¿™ç§ï¼Œå› ä¸ºå¥½åƒè¿™æ ·å®‰è£…çš„è¯ï¼Œåˆ°åé¢æ“ä½œæ•°æ®çš„æ—¶å€™è¦ä¿®æ”¹è·¯å¾„ä¹‹ç±»çš„ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2022/04/cityscapes-dataset/","summary":"0. æ•°æ®é›†æ¦‚è¿° Cityscapes æ•°æ®é›†ä¸“æ³¨äºå¯¹åŸå¸‚è¡—æ™¯çš„è¯­ä¹‰ç†è§£ã€‚ 1. ç‰¹ç‚¹ å¤šè¾¹å½¢çš„æ ‡ç­¾ å®ä¾‹åˆ†å‰²è½¦è¾†å’Œäºº 30ä¸ªç±»åˆ« 5000å¼ ç²¾ç»†æ ‡æ³¨çš„å›¾ 20000å¼ ç²—ç•¥æ ‡æ³¨çš„å›¾ leftImg8bit_trainvaltest.zip (11GB) left 8-bit images - train, val, and test sets (5000 images) https://www.cityscapes-dataset.com/file-handling/?packageID=3 rightImg8bit_trainvaltest.zip (11GB) right 8-bit images - train, val, and test sets (5000 images) https://www.cityscapes-dataset.com/file-handling/?packageID=5 disparity_trainvaltest.zip (3.5GB) precomputed depth maps using SGM for train, val, and test sets (5000 images) https://www.cityscapes-dataset.com/file-handling/?packageID=7 camera_trainvaltest.zip (2MB) [md5] intrinsic and extrinsic camera parameters for train, val, and test sets https://www.cityscapes-dataset.com/file-handling/?packageID=8 è„šæœ¬å®‰è£… 1. ä½¿ç”¨githu","title":"Cityscapes DataSet æ•°æ®é›†"},{"content":"1. ç¼–è¯‘å™¨é»˜è®¤æ·»åŠ çš„å‡½æ•° è‡ªå†™ç±»çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼çš„å†™å‡ºæ¥æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼å‡½æ•°ã€‚å¦‚æœç¨‹åºä¸­è¿™äº›å‡½æ•°è¢«éœ€è¦ï¼ˆè¢«è°ƒç”¨ï¼‰ï¼Œç¼–è¯‘å™¨å°±ä¼šé»˜è®¤çš„åˆ›å»ºè¿™äº›å‡½æ•°ã€‚\né»˜è®¤çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°éƒ½æ˜¯ç©ºå®ç°çš„ã€‚\né»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼å‡½æ•°éƒ½æ˜¯æµ…æ‹·è´ã€‚\nå¦‚æœæœ‰è‡ªå·±å†™çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ„é€ å‡½æ•°ï¼ˆä¸ç®¡æœ‰æ— å‚æ•°ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨éƒ½ä¸ä¼šå†æ·»åŠ é»˜è®¤çš„æ„é€ å‡½æ•°ã€‚\n2. å¦‚ä½•ç¦æ­¢æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼å‡½æ•°ï¼Ÿ å¯ä»¥å°†æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼å‡½æ•°æ˜¾å¼çš„å®šä¹‰ä¸ºprivateã€‚è¿™æ ·å¯ä»¥ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ç»å¯¹çš„å®‰å…¨ï¼Œå› ä¸ºæ­¤æ—¶ï¼Œç±»çš„æˆå‘˜å‡½æ•°ã€å‹å…ƒç±»ã€å‹å…ƒå‡½æ•°ï¼Œä¾ç„¶å¯ä»¥è°ƒç”¨è¿™äº›å‡½æ•°ã€‚\næ¯”è¾ƒå¥½çš„åšæ³•æ˜¯ï¼Œå°†å‡½æ•°å£°æ˜ä¸ºprivateçš„ï¼ŒåŒæ—¶ä¸å¯¹è¯¥å‡½æ•°è¿›è¡Œå®šä¹‰ã€‚\næ­¤åï¼Œå¦‚æœç›´æ¥è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™ã€‚å¦‚æœç”¨å‹å…ƒæˆ–è€…æˆå‘˜å‡½æ•°è°ƒç”¨ï¼Œä¼šåœ¨è¿æ¥æœŸæŠ¥é”™ã€‚\nä¹Ÿå¯ä»¥å•ç‹¬å†™ä¸€ä¸ªunCopyableç±»ï¼Œç„¶åbase ç§æœ‰ç»§æ‰¿unCopyableï¼Œbaseå†…ä¸ç”¨å†å£°æ˜æ‹·è´æ„é€ å’Œæ‹·è´èµ‹å€¼ï¼Œè¿™æ ·çš„æ“ä½œï¼Œä¼šå°†é”™è¯¯ä»è¿æ¥æ—¶æœŸæå‰è‡³ç¼–è¯‘æ—¶æœŸã€‚\n3. virtual ä¿®é¥°çš„ææ„å‡½æ•° ä¸€ä¸ªå­ç±»å¯¹è±¡ç»ç”±ä¸€ä¸ªçˆ¶ç±»æŒ‡é’ˆdeleteæ—¶ï¼Œå¦‚æœçˆ¶ç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œé‚£ä¹ˆæ‰§è¡Œdeleteåï¼Œè¯¥å­ç±»å¯¹è±¡æ˜¯â€œéƒ¨åˆ†é”€æ¯â€çš„ï¼Œå­ç±»å¯¹è±¡å†…éƒ¨ç»§æ‰¿è‡ªçˆ¶ç±»çš„èµ„æºéƒ½ä¼šè¢«é‡Šæ”¾æ‰ï¼Œä½†æ˜¯å­ç±»è‡ªå·±ç‹¬æœ‰çš„èµ„æºå¯èƒ½ä¼šé€ æˆæ³„æ¼ã€‚\nä¸€ä¸ªåŸåˆ™æ˜¯ï¼šå¦‚æœç±»ä¸­æ²¡æœ‰è™šå‡½æ•°ï¼Œè¡¨æ˜è¯¥ç±»ä¸æƒ³è¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆææ„å‡½æ•°ä¹Ÿä¸éœ€è¦å¼„æˆè™šå‡½æ•°ï¼›å¦‚æœä¸€ä¸ªç±»ä¸­æœ‰è‡³å°‘ä¸€ä¸ªè™šå‡½æ•°ï¼Œè¡¨æ˜è¯¥ç±»æœ‰å¯èƒ½è¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆææ„å‡½æ•°æœ€å¥½å¼„æˆè™šå‡½æ•°ã€‚\n4. çº¯è™šå‡½æ•°ä¸çº¯è™šææ„å‡½æ•°çš„åŒºåˆ« ä¸€ä¸ªç±»ï¼Œä¸€æ—¦å†…éƒ¨æœ‰ä¸€ä¸ªçº¯è™šå‡½æ•°,é‚£ä¹ˆè¯¥ç±»å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ— æ³•å®ä¾‹åŒ–ã€‚åªèƒ½ç­‰å¾…è¢«ç»§æ‰¿ã€‚\nçº¯è™šå‡½æ•°ä¸çº¯è™šææ„å‡½æ•°çš„åŒºåˆ«åœ¨äºçº¯è™šå‡½æ•°ä¸éœ€è¦æä¾›å®šä¹‰ï¼Œè€Œçº¯è™šææ„å‡½æ•°éœ€è¦å…·ä½“å®šä¹‰ã€‚åŸå› åœ¨äºï¼šå½“å‘ç”Ÿå¤šæ€æ—¶ï¼Œé€šè¿‡çˆ¶ç±»æŒ‡é’ˆdeleteå­ç±»å¯¹è±¡æ—¶ï¼Œå…ˆæ‰§è¡Œå­ç±»çš„ææ„å‡½æ•°ï¼Œå†è°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•°ï¼Œä»ä¸‹è‡³ä¸Šé€å±‚ææ„ï¼Œé‚£ä¹ˆæŠ½è±¡ç±»çš„çº¯è™šææ„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å…·ä½“å®ç°ï¼Œåœ¨è¿æ¥æ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å¿…é¡»è¦æœ‰å…·ä½“å®ç°ã€‚ä¿è¯ç»§æ‰¿ä½“ç³»çš„å®Œæ•´ææ„è¿‡ç¨‹ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2022/04/cpp-constructors-destructors/","summary":"1. ç¼–è¯‘å™¨é»˜è®¤æ·»åŠ çš„å‡½æ•° è‡ªå†™ç±»çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼çš„å†™å‡ºæ¥æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼å‡½æ•°ã€‚å¦‚æœç¨‹åºä¸­è¿™äº›å‡½æ•°è¢«éœ€è¦ï¼ˆè¢«è°ƒç”¨ï¼‰ï¼Œç¼–è¯‘å™¨å°±ä¼šé»˜è®¤çš„åˆ›å»ºè¿™äº›å‡½æ•°ã€‚ é»˜è®¤çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°éƒ½æ˜¯ç©ºå®ç°çš„ã€‚ é»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼å‡½æ•°éƒ½æ˜¯æµ…æ‹·è´ã€‚ å¦‚æœæœ‰è‡ªå·±å†™çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ„","title":"C++å­¦ä¹ è®°å½•(14) æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°"},{"content":"1. ä»£ç  /* * @Brief: å¸¸è§æ’åºç®—æ³•æ±‡æ€» * @Author: * @Date: 2021-07-01 */ #include \u0026lt;iostream\u0026gt; #include \u0026lt;algorithm\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;queue\u0026gt; using namespace std; void printArray(int *a, int len){ for(int i = 0; i \u0026lt; len; i++) cout \u0026lt;\u0026lt; a[i] \u0026lt;\u0026lt; \u0026#34; \u0026#34;; cout \u0026lt;\u0026lt; endl \u0026lt;\u0026lt; endl; } void bubbleSort(int *a, int len){ for(int i = 0; i \u0026lt; len - 1; i++){ for(int j = 0; j \u0026lt; len - i; j++){ if(a[j] \u0026gt; a[j+1]) swap(a[j], a[j+1]); } } } void selectSort(int *a, int len){ for(int i = 0; i \u0026lt; len; i++){ int mi = i; for(int j = i; j \u0026lt; len; j++){ if(a[j] \u0026lt; a[mi]) mi = j; } if(i != mi) swap(a[i], a[mi]); } } void insertionSort(int *a, int len){ for(int i = 0; i \u0026lt; len; i++){ int key = a[i]; int j = i; while(j \u0026gt;= 1 \u0026amp;\u0026amp; a[j - 1] \u0026gt; key) a[j] = a[j-1], j--; a[j] = key; } } void shellSort(int *a, int len){ // cout \u0026lt;\u0026lt; \u0026#34;åŸå§‹æ•°ç»„\u0026#34; \u0026lt;\u0026lt; endl; // printArray(a, len); for(int d = len / 2; d \u0026gt;= 1; d /= 2){ // æ’å…¥æ’åº for(int i = 0; i \u0026lt; len; i += d){ int key = a[i]; int j = i; while(j \u0026gt;= d \u0026amp;\u0026amp; a[j-d] \u0026gt; key) a[j] = a[j-d], j -= d; a[j] = key; } // cout \u0026lt;\u0026lt; \u0026#34;d = \u0026#34; \u0026lt;\u0026lt; d \u0026lt;\u0026lt; \u0026#34; æ’åºç»“æœ\u0026#34; \u0026lt;\u0026lt; endl; // printArray(a, len); } } void quickSort(int *a, int len, int l, int r){ if(l \u0026gt;= r) return ; int x = a[l + (r - l) / 2]; int i = l - 1, j = r + 1; while(i \u0026lt; j){ while(a[++i] \u0026lt; x); while(a[--j] \u0026gt; x); if(i \u0026lt; j) swap(a[i], a[j]); } quickSort(a, len, l, j); quickSort(a, len, j + 1, r); } void mergeSort(int *a, int len, int l, int r){ if(l \u0026gt;= r) return ; int mid = l + (r - l) / 2; mergeSort(a, len, l, mid); mergeSort(a, len, mid + 1, r); int i = l, j = mid + 1, k = 0; int *tmp = new int[r - l + 1]; while(i \u0026lt;= mid \u0026amp;\u0026amp; j \u0026lt;= r){ if(a[i] \u0026lt; a[j]) tmp[k++] = a[i++]; else tmp[k++] = a[j++]; } // å¤„ç†å°¾å·´ while(i \u0026lt;= mid) tmp[k++] = a[i++]; while(j \u0026lt;= r) tmp[k++] = a[j++]; // å¤åˆ¶å›åŸæ•°ç»„ä¸­ for(i = l, k = 0; i \u0026lt;= r; i++, k++) a[i] = tmp[k]; delete tmp; // å›æ”¶å†…å­˜ } // å †æ’åº namespace heapSort{ int *heap = nullptr; int ss = 0; // å †çš„ç°æœ‰èŠ‚ç‚¹æ•° ä»ä¸‹æ ‡æ˜¯1çš„èŠ‚ç‚¹å¼€å§‹å­˜ int n = 0; // æ•°ç»„é•¿åº¦ void down(int u){ // å°é¡¶å † int t = u; if(u * 2 \u0026lt;= ss \u0026amp;\u0026amp; heap[u * 2] \u0026lt; heap[t]) t = u * 2; if(u * 2 + 1 \u0026lt;= ss \u0026amp;\u0026amp; heap[u * 2 + 1] \u0026lt; heap[t]) t = u * 2 + 1; if(t != u){ swap(heap[t], heap[u]); down(t); } } void heapSort(int *a, int len){ heap = new int[len + 5]; n = len; for(int i = 0; i \u0026lt; len; i++) heap[++ss] = a[i]; for(int i = n / 2; i ; i--) down(i); for(int i = 0; i \u0026lt; len; i++){ a[i] = heap[1]; heap[1] = heap[ss--]; down(1); } delete heap; } }; int main(){ int a[10] = {8, 4, 2, 5, 7, 3, 1, 9, 0, 6}; int len = 10; //bubbleSort(a, len); //selectSort(a, len); //insertionSort(a, len); //quickSort(a, len, 0, len - 1); //mergeSort(a, len, 0, len - 1); //shellSort(a, len); //heapSort::heapSort(a, len); printArray(a, len); return 0; } 2. ç¨³å®šæ€§ ç¨³å®šæ’åºç®—æ³•ï¼šå¦‚æœä¸¤æ•°ç›¸ç­‰çš„è¯ï¼Œæ’åºä»¥åå…ˆåä½ç½®æ˜¯å¦ä¼šæ”¹å˜ï¼Œå¦‚æœä¸æ”¹å˜ï¼Œå°±æ˜¯ç¨³å®šçš„ã€‚\nå†’æ³¡ï¼šç›¸é‚»ä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒï¼Œæœ‰ä¸ç­‰å…³ç³»æ‰è¿›è¡Œäº¤æ¢ï¼Œä¸¤å…ƒç´ ç›¸ç­‰ï¼Œä¸äº¤æ¢ã€‚æ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚\né€‰æ‹©ï¼šä¾‹å¦‚ x, x, x-1 ä¸‰ä¸ªæ•°ï¼Œæ¯æ¬¡é€‰æ‹©æœ€å°çš„ï¼Œç¬¬ä¸€è½®å°±æŠŠç¬¬ä¸€ä¸ªxå’Œx-1äº¤æ¢ä½ç½®äº†ï¼Œæ˜æ˜¾ä¸¤ä¸ªxçš„å…ˆåé¡ºåºæ”¹å˜äº†ã€‚æ‰€ä»¥æ˜¯ä¸ç¨³å®šçš„ã€‚\næ’å…¥ï¼šä»åå¾€å‰éå†æœ‰åºåºåˆ—ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª \u0026lt;= x çš„ï¼Œå¦‚æœè¿™ä¸ªæ•°å’Œxç›¸ç­‰ï¼Œå¾ˆæ˜æ˜¾ä¸ç”¨äº¤æ¢ã€‚æ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚\nå¸Œå°”ï¼šä¸€æ¬¡æ’å…¥æ’åºæ˜¯ç¨³å®šçš„ï¼Œä½†æ˜¯å¸Œå°”ç”¨äº†å¤šæ¬¡ï¼Œå¯èƒ½å¼•èµ·ç›¸ç­‰çš„æ•°äº¤æ¢ä½ç½®ï¼Œæ‰€ä»¥ï¼Œæ˜¯ä¸ç¨³å®šçš„ã€‚\nå¿«æ’ï¼šæ ¹æ®å¿«æ’çš„ä»£ç å°±å¯ä»¥çŸ¥é“ï¼Œå½“ä¸¤ä¾§çš„iå’Œjå¯¹åº”å…ƒç´ ç›¸ç­‰æ—¶ï¼Œä¹Ÿä¼šäº¤æ¢ä½ç½®ï¼Œæ‰€ä»¥æ˜¯ä¸ç¨³å®šçš„ã€‚\nå½’å¹¶ï¼šå¯ä»¥ä¿è¯åŸå…ˆåœ¨å‰è¾¹çš„è¿˜åœ¨å‰è¾¹ï¼Œåè¾¹çš„è¿˜åœ¨åè¾¹ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚\nå †æ’ï¼šä¸ç¨³å®šã€‚\nåŸºæ•°æ’åºï¼šç¨³å®šã€‚\nç»¼ä¸Šï¼š\nç¨³å®šçš„æœ‰ï¼šå†’æ³¡ã€æ’å…¥ã€å½’å¹¶ã€åŸºæ•°ã€‚ ä¸ç¨³å®šçš„æœ‰ï¼šé™¤ä¸Šè¿°4ä¸ªéƒ½ä¸ç¨³å®šã€‚ ","permalink":"https://Clay-Hex.github.io/posts/2021/12/sorting-algorithm-stability/","summary":"1. ä»£ç  /* * @Brief: å¸¸è§æ’åºç®—æ³•æ±‡æ€» * @Author: * @Date: 2021-07-01 */ #include \u0026lt;iostream\u0026gt; #include \u0026lt;algorithm\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;queue\u0026gt; using namespace std; void printArray(int *a, int len){ for(int i = 0; i \u0026lt; len; i++) cout \u0026lt;\u0026lt; a[i] \u0026lt;\u0026lt; \u0026#34; \u0026#34;; cout \u0026lt;\u0026lt; endl \u0026lt;\u0026lt; endl; } void bubbleSort(int *a, int len){ for(int i = 0; i \u0026lt; len - 1; i++){ for(int j = 0; j \u0026lt; len - i; j++){ if(a[j] \u0026gt; a[j+1]) swap(a[j], a[j+1]); } } } void selectSort(int *a, int len){ for(int i = 0; i \u0026lt; len; i++){ int mi = i; for(int j = i; j \u0026lt; len; j++){ if(a[j] \u0026lt; a[mi]) mi = j; } if(i != mi) swap(a[i], a[mi]); } } void insertionSort(int *a, int len){ for(int i = 0; i \u0026lt; len;","title":"å¸¸è§æ’åºç®—æ³•åŠç¨³å®šæ€§"},{"content":"I\u0026rsquo;m Clay.\nèƒ½åŠ›ä¸é«˜ï¼Œæ°´å¹³æœ‰é™ï¼Œä½†TMæ€»æƒ³å†™ç‚¹ä»€ä¹ˆã€‚\nè¿™æ˜¯ç¬¬Næ¬¡æ­åšå®¢ï¼Œå¸Œæœ›ä¸ä¼šæœ‰N+1æ¬¡ã€‚\n2024å¹´3æœˆÂ·ä¸Šæµ·\n","permalink":"https://Clay-Hex.github.io/about/","summary":"I\u0026rsquo;m Clay. èƒ½åŠ›ä¸é«˜ï¼Œæ°´å¹³æœ‰é™ï¼Œä½†TMæ€»æƒ³å†™ç‚¹ä»€ä¹ˆã€‚ è¿™æ˜¯ç¬¬Næ¬¡æ­åšå®¢ï¼Œå¸Œæœ›ä¸ä¼šæœ‰N+1æ¬¡ã€‚ 2024å¹´3æœˆÂ·ä¸Šæµ·","title":"ğŸ“– å…³äº"},{"content":"1. ç¯å¢ƒ æœºå™¨1ï¼šIntel(R) Core(TM) i5-4200H CPU @ 2.80GHzï¼ŒåŒæ ¸å››çº¿ç¨‹ï¼Œwin10 x64ï¼Œ16Gå†…å­˜\næœºå™¨2ï¼šIntel(R) Core(TM) i3-9100T CPU @ 3.10GHzï¼Œå››æ ¸å››çº¿ç¨‹ã€‚wn10 x64ï¼Œ8Gå†…å­˜\nç›®çš„ï¼šå¤§æ¦‚æµ‹è¯•ä¸€ä¸‹2C4Tä¸4C4Tåœ¨è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸‹çš„æ•ˆç‡æå‡å¯¹æ¯”ï¼Œå†…å­˜å¤§å°ã€é¢‘ç‡æš‚ä¸”å¿½ç•¥ã€‚\næ–¹æ³•ï¼šä½¿ç”¨openMPæ§åˆ¶è®¡ç®—ä»»åŠ¡ä¸­çš„çº¿ç¨‹ä½¿ç”¨æ•°é‡ï¼Œæµ‹è¯•12å±‚forå¾ªç¯æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼ˆ12æ˜¯1ã€2ã€3ã€4çš„å…¬å€æ•°ï¼Œé˜²æ­¢openMPåˆ†é…ä»»åŠ¡ä¸å‡ï¼‰ã€‚å®é™…æ˜¯æµ‹120å±‚çš„è€—æ—¶ï¼Œå†é™¤ä»¥10ã€‚\n2. ä»£ç  ç¯å¢ƒï¼š\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;omp.h\u0026gt; using namespace std; const int N = 1e9; int main() { int ans = 0; int peat = 120; double start = omp_get_wtime(); #pragma omp parallel for num_threads(1) for (int i = 0; i \u0026lt; peat; ++i) { for (int j = 0; j \u0026lt; N; ++j) { ++ans; } } double end = omp_get_wtime(); // è®¡ç®—12å±‚forå¾ªç¯æ‰€æ¶ˆè€—çš„æ—¶é—´ cout \u0026lt;\u0026lt; \u0026#34;time: \u0026#34; \u0026lt;\u0026lt; (end - start)/10 \u0026lt;\u0026lt; endl; return 0; } 3. ç»“æœ æœºå™¨1ï¼ˆ2C4Tï¼‰ï¼š\nçº¿ç¨‹æ•° è€—æ—¶ï¼ˆç§’ï¼‰ 1 2.0653 2 1.37322 3 1.15472 4 1.10587 æœºå™¨2ï¼ˆ4C4Tï¼‰ï¼š\nçº¿ç¨‹æ•° è€—æ—¶ï¼ˆç§’ï¼‰ 1 1.72509 2 0.877413 3 0.618491 4 0.49988 åœ¨åŒæ ¸å››çº¿ç¨‹çš„æœºå™¨ä¸Šï¼Œå•çº¿ç¨‹æ‰§è¡Œä¸åŒçº¿ç¨‹æ‰§è¡Œæœ‰æ˜æ˜¾çš„æ•ˆç‡æå‡ï¼Œä½†æ˜¯å½“çº¿ç¨‹æ•°å¼€åˆ°3ã€4æ—¶ï¼Œæ•ˆç‡æå‡å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚åŸå› åœ¨äºï¼ŒåŒæ ¸å››çº¿ç¨‹ï¼ŒçœŸæ­£çš„æ ¸å¿ƒåªæœ‰2ä¸ªï¼Œä¹Ÿå°±åªæœ‰ä¸¤ä¸ªç‰©ç†çº¿ç¨‹ã€‚å¤šå‡ºæ¥çš„ä¸¤ä¸ªçº¿ç¨‹æ˜¯æ¨¡æ‹Ÿå‡ºæ¥çš„ã€‚ä½†æ˜¯ï¼Œè¿™ç§è®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ï¼Œç±»ä¼¼ç­‰å¾…IOè¿™ç§è€—æ—¶çš„æ“ä½œä¹Ÿæ¯”è¾ƒå°‘ï¼Œæ ¸å¿ƒä¹Ÿå°±ä¸ä¼šåˆ‡æ¢ï¼Œè™šæ‹Ÿå‡ºæ¥çš„çº¿ç¨‹å‡ ä¹æ´¾ä¸ä¸Šç”¨åœºã€‚æ‰€ä»¥ï¼Œæœ€å¤šå°±æ˜¯ä¸¤ä¸ªçº¿ç¨‹çš„æ•ˆç‡ã€‚\nè€Œï¼Œå››æ ¸å››çº¿ç¨‹ï¼Œæ˜¯å®æ‰“å®çš„å››ä¸ªçº¿ç¨‹åœ¨å·¥ä½œã€‚ä»ä»»åŠ¡è€—æ—¶æ¥çœ‹ï¼Œæ‰€æ¶ˆè€—çš„æ—¶é—´ä¸çº¿ç¨‹æ•°é‡æˆåæ¯”ï¼Œ4çº¿ç¨‹çš„ä»…æ˜¯1çº¿ç¨‹è€—æ—¶çš„å››åˆ†ä¹‹ä¸€ï¼Œ4å€å·¦å³çš„æ•ˆç‡æå‡ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/10/2c4t-4c4t-compute-intensive-task/","summary":"1. ç¯å¢ƒ æœºå™¨1ï¼šIntel(R) Core(TM) i5-4200H CPU @ 2.80GHzï¼ŒåŒæ ¸å››çº¿ç¨‹ï¼Œwin10 x64ï¼Œ16Gå†…å­˜ æœºå™¨2ï¼šIntel(R) Core(TM) i3-9100T CPU @ 3.10GHzï¼Œå››æ ¸å››çº¿ç¨‹ã€‚wn10 x64ï¼Œ8Gå†…å­˜ ç›®çš„ï¼šå¤§æ¦‚æµ‹è¯•ä¸€ä¸‹2C4Tä¸4C4Tåœ¨è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸‹çš„æ•ˆç‡æå‡å¯¹æ¯”ï¼Œå†…å­˜å¤§å°ã€é¢‘ç‡æš‚ä¸”å¿½ç•¥ã€‚ æ–¹æ³•ï¼šä½¿","title":"2C4Tä¸4C4Tåœ¨è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸‹çš„æ•ˆç‡å¯¹æ¯”"},{"content":"0. placement new å³ åŸåœ°æ„é€ ã€‚\nç”¨æ³•ï¼š\nint *p = new int(10); // new operator new(p) int(1000); // åœ¨ p æŒ‡å‘çš„å†…å­˜ä¸Š æ„é€ ä¸€ä¸ªintå¯¹è±¡ï¼Œå³placement new // æ­¤æ—¶ *P ä¸º 1000ã€‚ å› ä¸ºæ˜¯åœ¨ä¸€ä¸ªå·²æœ‰çš„ç©ºé—´ä¸Šæ„é€ å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œç©ºé—´çš„é‡Šæ”¾ï¼Œå°±ç”±freeæˆ–è€…deleteè´Ÿè´£äº†ã€‚\n0.1 é‡è½½placement new ä¸åè¾¹çš„ 3 ï¼šoperator newçš„é‡è½½æ— å¼‚ï¼Œå°±æ˜¯å¯ä»¥å¤šå¢åŠ å‡ ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯std::size_t ç±»å‹ï¼Œè¿™ä¸ªå‚æ•°æ¥æ”¶çš„æ˜¯ new åè¾¹ç±»å‹çš„å¤§å°ï¼Œä¸ç”¨æ˜¾å¼ä¼ å‚ï¼Œé»˜è®¤ä¼šä¼ é€’ã€‚\né‡è½½ç¤ºä¾‹ï¼š\n#include \u0026lt;iostream\u0026gt; using std::cout, std::endl; class base{ public: base(){ cout \u0026lt;\u0026lt; \u0026#34;ctor\u0026#34; \u0026lt;\u0026lt; endl; } ~base(){ cout \u0026lt;\u0026lt; \u0026#34;dtor\u0026#34; \u0026lt;\u0026lt; endl; } // æ ‡å‡†åº“ä¸­çš„ placement new, è¿™é‡Œä»€ä¹ˆéƒ½æ²¡åšï¼Œåªæ˜¯è¿”å›åŸæ¥çš„æŒ‡é’ˆã€‚ void * operator new(std::size_t size, void *p){ cout \u0026lt;\u0026lt; \u0026#34;std placement new\u0026#34; \u0026lt;\u0026lt; endl; return p; } //é‡è½½ placement newï¼Œé™„åŠ äº†ä¸€ä¸ªå‚æ•° aï¼Œå‚æ•°sizeä¼šé»˜è®¤ä¼ é€’ï¼Œä¸ç”¨æ˜¾å¼ä¼ å‚ã€‚ void * operator new(std::size_t size, int a){ cout \u0026lt;\u0026lt; \u0026#34;a = \u0026#34; \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; return malloc(size); } void * operator new(std::size_t size){ cout \u0026lt;\u0026lt; \u0026#34;new diy\u0026#34; \u0026lt;\u0026lt; endl; return malloc(size); } void operator delete(void *p){ cout \u0026lt;\u0026lt; \u0026#34;delete diy\u0026#34; \u0026lt;\u0026lt; endl; free(p); } private: int a, b, c; }; int main(){ base p; new(\u0026amp;p) base; new(4) base; return 0; } è¿è¡Œç»“æœï¼š\nctor // å¯¹è±¡é»˜è®¤çš„æ„é€ å‡½æ•°è¾“å‡ºçš„ std placement new // é»˜è®¤placement new è¾“å‡ºçš„ ctor // é»˜è®¤placement new è¾“å‡ºçš„ a = 4 // é‡è½½çš„placement new è¾“å‡ºçš„ ctor // é‡è½½çš„placement new è¾“å‡ºçš„ dtor // ææ„ 1. new operator ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„newéƒ½æ˜¯new operatorã€‚\nç”¨æ³•ï¼š\nint *p = new int(3); å…¶å®åº•å±‚æœ‰ä¸¤ä¸ªè¿‡ç¨‹ï¼š\nç¬¬ä¸€ä¸ªè¿‡ç¨‹ï¼šå¼€è¾Ÿç©ºé—´\nç¬¬äºŒä¸ªè¿‡ç¨‹ï¼šæ„é€ å¯¹è±¡\n2. delete operator delete operatorå°±æ˜¯å¹³æ—¶å¸¸ç”¨çš„deleteï¼Œä¸new æ­é…æˆå¯¹ä½¿ç”¨ã€‚\nç”¨æ³•ï¼š\nint *p = new int; delete p; 3. operator new æ˜¯å…¨å±€çš„åº“å‡½æ•°ã€‚\nç”¨æ³•ï¼š\nvoid* operator new(size_t size); å…¶å®ï¼Œoperator newåº•å±‚è°ƒç”¨çš„æ˜¯mallocï¼ˆè°ƒç”¨å½¢å¼ä¹ŸæŒºåƒçš„ï¼Œä¼ å…¥ä¸€ä¸ªå¼€è¾Ÿçš„Byteæ•°ï¼Œè¿”å›ä¸€ä¸ªvoid *ï¼‰ã€‚\næ³¨æ„ï¼Œoperator new æ”¯æŒé‡è½½ï¼å½“ç„¶äº†ï¼Œå¦‚æœé‡è½½äº†ï¼Œé‚£å°±è¦é‡è½½å¯¹åº”çš„operator delete 4. operator delete æ˜¯å…¨å±€çš„åº“å‡½æ•°ï¼Œä¸operator newæ­é…ä½¿ç”¨ã€‚\nç”¨æ³•ï¼š\nint *p = new int; operator delete(p); åº•å±‚è°ƒç”¨çš„æ˜¯freeã€‚\næ”¯æŒé‡è½½ã€‚ 5. new åšäº†å“ªäº›äº‹æƒ…ï¼Ÿ new æ“ä½œå¯ä»¥å¤§è‡´çš„è®¤ä¸ºåŒ…å«äº†ä¸¤ä¸ªè¿‡ç¨‹ï¼š\nç¬¬ä¸€ä¸ªè¿‡ç¨‹ï¼šå¼€è¾Ÿç›¸åº”çš„ç©ºé—´ï¼ˆä½¿ç”¨operator newï¼‰ã€‚\nç¬¬äºŒä¸ªè¿‡ç¨‹ï¼šåœ¨åˆšå¼€è¾Ÿçš„ç©ºé—´å†…æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼ˆplacement newï¼‰ã€‚\næ¨¡æ‹Ÿnewæ“ä½œã€‚\nint *p = static_cast\u0026lt;int*\u0026gt;( operator new(sizeof(int)) ); // new operator å¼€è¾Ÿç©ºé—´ new(p) int(100); // placement new åœ¨pæŒ‡å‘çš„å†…å­˜ä¸Šæ„é€ ä¸€ä¸ªå¯¹è±¡ ä¸Šè¾¹è¯´åˆ°operator newå’Œoperator deleteæ”¯æŒé‡è½½ï¼Œé‡è½½å¯ä»¥ä¸ºæˆ‘ä»¬è‡ªå·±çš„ç±»ç±»å‹å®šåˆ¶åŒ–çš„åˆ†é…å†…å­˜ã€‚\nåªéœ€è¦åœ¨ç±»å†…é‡è½½operator newå’Œoperator deleteã€‚\nç¼–è¯‘å™¨é‡åˆ°newå’Œdeleteæ—¶ï¼Œé¦–å…ˆçœ‹å¯¹åº”çš„ç±»ç±»å‹ä¸­æ˜¯å¦æœ‰é‡è½½çš„operator newå’Œoperator deleteï¼Œå¦‚æœæœ‰ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨é‡è½½çš„ç‰ˆæœ¬å»åˆ†é…å†…å­˜ï¼Œç„¶åå†åŸåœ°æ„é€ ã€‚å¦‚æœæ²¡æœ‰é‡è½½ç‰ˆæœ¬ï¼Œå°±è°ƒç”¨å…¨å±€çš„åº“å‡½æ•°ã€‚\nå¦‚æœä¸€ä¸ªç±»å†…æœ‰é‡è½½çš„operator newå’Œoperator deleteï¼Œä¼šä¼˜å…ˆè°ƒç”¨é‡è½½ç‰ˆæœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š\n#include \u0026lt;iostream\u0026gt; using std::cout, std::endl; class base{ public: base(){ cout \u0026lt;\u0026lt; \u0026#34;ctor\u0026#34; \u0026lt;\u0026lt; endl; } ~base(){ cout \u0026lt;\u0026lt; \u0026#34;dtor\u0026#34; \u0026lt;\u0026lt; endl; } void * operator new(std::size_t size){ cout \u0026lt;\u0026lt; \u0026#34;new diy\u0026#34; \u0026lt;\u0026lt; endl; void *resPtr = malloc(size); return resPtr; } void operator delete(void *p){ cout \u0026lt;\u0026lt; \u0026#34;delete diy\u0026#34; \u0026lt;\u0026lt; endl; free(p); } private: int a, b, c; }; int main(){ base *p = new base; delete p; return 0; } è¿è¡Œç»“æœï¼š\nnew diy ctor dtor delete diy ä¹Ÿå¯ä»¥æ˜¾å¼çš„ä½¿ç”¨å…¨å±€çš„åº“å‡½æ•°æ¥newä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼ŒæŠŠmainå‡½æ•°ä¸­çš„newå’Œdeleteæ¢æˆå…¨å±€çš„åº“å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š\nbase *p = ::new base; ::delete p; è¿è¡Œç»“æœï¼š\nctor dtor æ˜¾å¼çš„è°ƒç”¨äº†å…¨å±€çš„åº“å‡½æ•°ï¼Œè€Œæ²¡æœ‰è°ƒç”¨ç±»ç±»å‹é‡è½½çš„ç‰ˆæœ¬ã€‚\nå½“ç„¶ï¼Œå¦‚æœä¸åœ¨ç±»å†…è¿›è¡Œé‡è½½ï¼Œåœ¨å…¨å±€è¿›è¡Œé‡è½½ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\nè¿™ä¸ªä¸¤ä¸ªå‡½æ•°ï¼Œåœ¨ç±»å†…é‡è½½ï¼Œå¿…é¡»æ˜¯é™æ€çš„ï¼Œå³æœ‰staticä¿®é¥°ï¼Œå› ä¸ºè°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ—¶ï¼Œå¯¹è±¡è¿˜æ²¡åˆ›å»ºï¼ˆè°ƒç”¨newæ—¶ï¼‰æˆ–è€…å·²ç»ææ„ï¼ˆè°ƒç”¨deleteæ—¶ï¼‰ï¼ŒthisæŒ‡é’ˆæ­¤æ—¶æ˜¯æ— æ•ˆçš„ï¼Œå†æƒ³å»é€šè¿‡thisè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯é™æ€çš„ã€‚\nä¸Šè¾¹çš„ä»£ç ä¸­ï¼Œæ²¡æœ‰åŠ staticä¿®é¥°ï¼Œä¹Ÿå¯ä»¥å®Œæˆæ“ä½œï¼Œæ˜¯å› ä¸ºç¼–è¯‘å™¨æ›¿æˆ‘ä»¬åŠ ä¸Šäº†staticã€‚\n6. array new ä¸ array delete int *p = new int[10]; delete[] p; array newå³æ˜¯ç”¨newç”³è¯·ä¸€ä¸ªæ•°ç»„ç©ºé—´ï¼Œæ­¤æ—¶ p æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„èµ·å§‹ä½ç½®ï¼Œé‡Šæ”¾æ—¶å¿…é¡»ä½¿ç”¨å¯¹åº”çš„array deleteï¼Œä¹Ÿå°±æ˜¯delete[ ]ã€‚\nå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå¦‚æœæŠŠä¸Šè¾¹çš„delete[] p æ”¹æˆ delete pï¼Œæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ä½†å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ç±»ï¼Œå¹¶ä¸”ç±»ä¸­æœ‰åœ¨å †ä¸Šå¼€è¾Ÿå†…å­˜ç©ºé—´çš„è¯ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚\nå› ä¸ºdelete p åªä¼šè°ƒç”¨ä¸€ä¸ªå…ƒç´ çš„ææ„å‡½æ•°ï¼Œç„¶åé‡Šæ”¾å¯¹åº”çš„ç©ºé—´ï¼Œæ•°ç»„ä¸­çš„å…¶ä½™å…ƒç´ ï¼Œè™½ç„¶å…ƒç´ ï¼ˆç±»å¯¹è±¡ï¼‰æœ¬èº«çš„ç©ºé—´é‡Šæ”¾äº†ï¼Œä½†æ˜¯è¯¥å¯¹è±¡åŸæœ¬æ¥å †ä¸Šå¼€è¾Ÿçš„å†…å­˜ç©ºé—´ï¼Œå¹¶æ²¡æœ‰é‡Šæ”¾æ‰ï¼ˆå› ä¸ºä»–çš„ææ„å‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼‰ï¼Œç”±æ­¤é€ æˆå†…å­˜æ³„æ¼ã€‚\nä¸ä¸Šè¾¹çš„new å’Œ deleteä¸€æ ·ï¼Œarrayç‰ˆæœ¬çš„newå’Œdeleteä¹Ÿæ”¯æŒé‡è½½ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n#include \u0026lt;iostream\u0026gt; using std::cout, std::endl; class base{ public: base(){ cout \u0026lt;\u0026lt; \u0026#34;ctor\u0026#34; \u0026lt;\u0026lt; endl; } ~base(){ cout \u0026lt;\u0026lt; \u0026#34;dtor\u0026#34; \u0026lt;\u0026lt; endl; } void * operator new[](std::size_t size){ cout \u0026lt;\u0026lt; \u0026#34;new[] diy\u0026#34; \u0026lt;\u0026lt; endl; void *resPtr = malloc(size); return resPtr; } void operator delete[](void *p){ cout \u0026lt;\u0026lt; \u0026#34;delete[] diy\u0026#34; \u0026lt;\u0026lt; endl; free(p); } private: int a, b, c; }; int main(){ base *p = new base[2]; delete[] p; return 0; } è¿è¡Œç»“æœï¼š\nnew[] diy ctor ctor dtor dtor delete[] diy 7. delete[ ] ä¸ºä»€ä¹ˆèƒ½å¤Ÿé‡Šæ”¾æ•°ç»„ï¼Ÿ åœ¨ä½¿ç”¨newåˆ›å»ºä¸€ä¸ªæ•°ç»„æ—¶ï¼Œæ‰€å¼€è¾Ÿçš„å®é™…å†…å­˜å¤§å°æ¯”è¦ç”³è¯·çš„å¤§å°è¦å¤§ä¸€äº›ï¼Œåœ¨ç”³è¯·åˆ°çš„æ•°ç»„ç©ºé—´çš„ä¸Šä¸‹éƒ½æœ‰é¢å¤–çš„å¼€é”€ï¼Œæ¥è®°å½•è¿™å—æ•°ç»„ç©ºé—´çš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æ•°ç»„ç©ºé—´çš„é•¿åº¦ï¼Œæ¯ä¸ªå…ƒç´ çš„é•¿åº¦ã€‚æ‰€ä»¥ delete[ ] å¯ä»¥é¡ºåˆ©çš„çŸ¥é“æ•°ç»„çš„é•¿åº¦ï¼Œå¹¶ä¸”å¯ä»¥æˆåŠŸçš„è°ƒç”¨æ‰€æœ‰å…ƒç´ çš„ææ„å‡½æ•°ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/08/cpp-new-and-delete/","summary":"0. placement new å³ åŸåœ°æ„é€ ã€‚ ç”¨æ³•ï¼š int *p = new int(10); // new operator new(p) int(1000); // åœ¨ p æŒ‡å‘çš„å†…å­˜ä¸Š æ„é€ ä¸€ä¸ªintå¯¹è±¡ï¼Œå³placement new // æ­¤æ—¶ *P ä¸º 1000ã€‚ å› ä¸ºæ˜¯åœ¨ä¸€ä¸ªå·²æœ‰çš„ç©ºé—´ä¸Šæ„é€ å¯¹è±¡ï¼Œæ‰€ä»¥ï¼Œç©ºé—´çš„é‡Šæ”¾ï¼Œå°±ç”±freeæˆ–è€…deleteè´Ÿè´£äº†ã€‚ 0.1 é‡è½½placement new ä¸åè¾¹çš„ 3 ï¼šoperator newçš„é‡è½½æ— ","title":"C++å­¦ä¹ è®°å½•(13) newä¸delete"},{"content":"0. å°æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨ ä¸¤ç§æ–¹æ³•ï¼š\nå®šç‚¹ æµ®ç‚¹ 1. å®šç‚¹æ•° é¡¾åæ€ä¹‰ï¼Œå°æ•°ç‚¹çš„ä½ç½®å›ºå®šçš„ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨å›ºå®šæ•°é‡çš„bitå­˜å‚¨æ•´æ•°éƒ¨åˆ†ï¼Œä¹Ÿç”¨å›ºå®šæ•°é‡çš„bitå­˜å‚¨å°æ•°éƒ¨åˆ†ï¼Œå¦å¤–å†ç”¨ä¸€ä¸ªbitå­˜å‚¨ç¬¦å·ä½ã€‚\nè®¡ç®—æ—¶ï¼Œå°†ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æ¥èµ·æ¥ï¼ŒåŠ ä¸ªå°æ•°ç‚¹å³å¯ã€‚\nä¼˜ç‚¹ï¼šå°æ•°ç‚¹ä½ç½®å›ºå®šï¼Œæ–¹ä¾¿è®¡ç®—ã€‚\nç¼ºç‚¹ï¼šè¡¨ç¤ºè¾“çš„èŒƒå›´å—é™ã€‚\n2. æµ®ç‚¹æ•° æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨ä¾èµ–ç§‘å­¦è®¡æ•°æ³•ã€‚\n2.1 ç§‘å­¦è®¡æ•°æ³• åè¿›åˆ¶ä¸­ï¼Œ3145ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•å¯ä»¥è¡¨ç¤ºæˆ 3.145 * 103ã€‚\nç§‘å­¦è®¡æ•°æ³•ä¸€èˆ¬çš„è¡¨è¾¾å½¢å¼ï¼šM * baseEï¼Œå…¶ä¸­ M æš‚ä¸”ç§°ä»–ä¸ºå°¾æ•°ï¼Œå¿…é¡»è¦ \u0026gt;= 1 ä¸” \u0026lt; baseï¼›baseæ˜¯è¿›åˆ¶ï¼Œ10è¿›åˆ¶å°±æ˜¯10ï¼Œ2è¿›åˆ¶å°±æ˜¯2ï¼›Eæ˜¯æŒ‡æ•°ã€‚\nä»»æ„ä¸€ä¸ªäºŒè¿›åˆ¶æµ®ç‚¹æ•°å¯ä»¥è¡¨ç¤ºæˆï¼š V = (-1)s x M x 2Eã€‚\n2.2 æµ®ç‚¹æ•°çš„å­˜å‚¨ ç»¼ä¸Šï¼Œè‹¥æƒ³åœ¨è®¡ç®—æœºä¸­å­˜å‚¨ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œéœ€è¦ä¿å­˜å¦‚ä¸‹ä¸‰ä¸ªæ•°å€¼ï¼š\nç¬¦å·ä½ sï¼Œ0 æˆ–è€… 1 ã€‚ å°¾æ•° M ï¼Œå› ä¸ºåŸºæ•°Må‰è¾¹è¯´è¿‡ï¼Œå¿…é¡» \u0026gt;= 1ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ•°å­—1å°±å¯ä»¥ä¸å­˜äº†ï¼Œç›´æ¥å­˜å‚¨åè¾¹çš„å°æ•°éƒ¨åˆ†ã€‚ æŒ‡æ•°Eã€‚ åœ¨IEEE 754ä¸­è§„å®šï¼Œ32bitçš„æµ®ç‚¹æ•°ä¸­ï¼ˆ64bitåŒç†ï¼‰ï¼Œæœ€é«˜ 1 bitæ˜¯ç¬¦å·ä½ï¼Œç´§æ¥ç€çš„ 8 bit å­˜å‚¨æŒ‡æ•° Eï¼Œæœ€åçš„ 23 ä¸ªbitå­˜å‚¨å°¾æ•° Mã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šè§„å®šï¼š\n2.3 æµ®ç‚¹æ•°å­˜å‚¨åŠèŒƒå›´çš„ä¾‹å­ ","permalink":"https://Clay-Hex.github.io/posts/2021/08/floating-point-and-fixed-point-storage-method/","summary":"0. å°æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨ ä¸¤ç§æ–¹æ³•ï¼š å®šç‚¹ æµ®ç‚¹ 1. å®šç‚¹æ•° é¡¾åæ€ä¹‰ï¼Œå°æ•°ç‚¹çš„ä½ç½®å›ºå®šçš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨å›ºå®šæ•°é‡çš„bitå­˜å‚¨æ•´æ•°éƒ¨åˆ†ï¼Œä¹Ÿç”¨å›ºå®šæ•°é‡çš„bitå­˜å‚¨å°æ•°éƒ¨åˆ†ï¼Œå¦å¤–å†ç”¨ä¸€ä¸ªbitå­˜å‚¨ç¬¦å·ä½ã€‚ è®¡ç®—æ—¶ï¼Œå°†ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æ¥èµ·æ¥ï¼ŒåŠ ä¸ªå°æ•°ç‚¹å³å¯ã€‚ ä¼˜ç‚¹ï¼šå°æ•°ç‚¹ä½ç½®å›ºå®šï¼Œæ–¹ä¾¿è®¡ç®—ã€‚ ç¼ºç‚¹ï¼šè¡¨ç¤ºè¾“çš„èŒƒå›´å—","title":"å°æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼"},{"content":" 0. å¿…è¦æ€§ Cè¯­è¨€ä¸­çš„ç±»å‹è½¬æ¢ï¼Œæ²¡æœ‰å®‰å…¨æ£€æŸ¥ï¼Œå®‰å…¨æ€§éœ€è¦ç¨‹åºçŒ¿æ¥ä¿è¯ï¼ŒC++æä¾›äº†4ç§ç±»å‹è½¬æ¢çš„æ–¹æ³•ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯è½¬æ¢çš„å®‰å…¨æ€§ã€‚\né‡ç‚¹æ˜¯ dynamic_cast\n1. const_cast ä»…ç”¨äºå»é™¤ç±»å‹çš„constå±æ€§ï¼Œä¹Ÿæ˜¯å››ç§ç±»å‹è½¬æ¢ä¸­ï¼Œå”¯ä¸€å¯ä»¥å»æ‰consté™åˆ¶çš„æ–¹æ³•ã€‚\nåªèƒ½è½¬æ¢ æŒ‡é’ˆã€å¼•ç”¨ã€thisï¼ˆåœ¨ç±»å†…çš„æ—¶å€™ç”¨ï¼‰ã€‚ 2. static_cast éšå¼è½¬æ¢èƒ½è½¬çš„ï¼Œå®ƒéƒ½èƒ½è½¬ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼ˆçˆ¶ç±»æŒ‡é’ˆ è½¬ å­ç±»æŒ‡é’ˆï¼‰ã€‚\nä½é£é™©çš„éƒ½å¯ä»¥è½¬ï¼š\næ•´æ•°ä¸æµ®ç‚¹æ•° æ•´æ•°ä¸å­—ç¬¦ voidæŒ‡é’ˆè½¬å…¶ä»–ç±»å‹æŒ‡é’ˆ è½¬æ¢è¿ç®—ç¬¦ï¼ˆç±»å†…å¿…é¡»æä¾›è½¬æ¢è¿ç®—ç¬¦ï¼Œeg : operator int() { }ï¼‰ é«˜é£é™©çš„ä¸å…è®¸è½¬ï¼š\næ•´æ•°ä¸æŒ‡é’ˆ ï¼ˆegï¼šint *p = static_cast\u0026lt;int *\u0026gt; (a);ï¼‰ æ³¨æ„ï¼šçˆ¶ç±»è½¬å­ç±»ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè½¬æ¢åçš„å­ç±»æŒ‡é’ˆæœ‰å¯èƒ½è¶Šç•Œè®¿é—®èµ„æºã€‚éšå¼è½¬æ¢ä¸­ï¼Œè¿™ç§è½¬æ¢æ˜¯ä¸å…è®¸çš„ï¼Œä½†æ˜¯static_castå¯ä»¥åšè¿™ç§å‘ä¸‹è½¬æ¢ï¼Œä½†æ˜¯ï¼Œè½¬æ¢åçš„ä½¿ç”¨å®‰å…¨ï¼Œéœ€è¦ç¨‹åºçŒ¿æ¥ä¿è¯ã€‚\nè¿™ç§å‘ä¸‹è½¬æ¢çš„ä¸å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨dynamic_castæ¥ä¿è¯ã€‚\n3. dynamic_cast ç”¨äº å…·æœ‰å¤šæ€ç±»ç±»å‹çš„å‘ä¸‹è½¬æ¢æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ã€‚\nåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœdynamic_castå‘ç°è¿™ç§è½¬æ¢ä¸å®‰å…¨ï¼Œä¼šè¿”å›nullï¼Œè½¬æ¢æˆåŠŸä¼šè¿”å›è½¬æ¢åçš„æŒ‡é’ˆã€‚\né‚£ä¹ˆï¼Œå®ƒå¦‚ä½•å‘ç°çˆ¶ç±»è½¬å­ç±»æ˜¯ä¸å®‰å…¨çš„ï¼Ÿ\nå› ä¸ºå®ƒå†…éƒ¨ä½¿ç”¨äº†RTTIæŠ€æœ¯ï¼Œè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ã€‚RTTIä¾èµ–äºè™šå‡½æ•°è¡¨ï¼Œè™šå‡½æ•°è¡¨ä¸Šè¾¹æœ‰ä¸€ä¸ªtype_infoçš„æŒ‡é’ˆï¼ŒæŒ‡å‘äº†è¿™ä¸ªç±»çš„ç»§æ‰¿é“¾ã€‚\næ‰€æœ‰ï¼Œdynamic_cast éœ€è¦è½¬æ¢çš„ç±»å‹æœ‰è™šå‡½æ•°ï¼Œæ‰ä¼šæ£€æµ‹å®‰å…¨æ€§ã€‚\nå› ä¸ºRTTIæœ‰å¼€é”€ï¼Œæ‰€ä»¥ï¼Œé™¤éå¿…è¦ï¼Œå¦åˆ™ä¸ä¼šä½¿ç”¨dynamic_cast æ€»ç»“ï¼š\nåŸºç±»å¿…é¡»è¦æœ‰è™šå‡½æ•°ï¼ˆä½¿ç”¨äº†RTTIï¼ŒRTTIä¾èµ–è™šå‡½æ•°è¡¨ï¼‰ è¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼Œè½¬æ¢ä¸æˆåŠŸä¼šè¿”å›NULL RTTIæœ‰é¢å¤–çš„å¼€é”€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨å®ƒåšç±»å‹è½¬æ¢ã€‚ 4. interpret_cast ä¸Cè¯­è¨€ä¸­çš„å¼ºåˆ¶ç±»å‹è½¬æ¢å‡ ä¹æ— å¼‚ã€‚\nå¯ä»¥ç”¨äºå„ç§é«˜å±é™©çš„ç±»å‹è½¬æ¢.\nä¸å­˜åœ¨ç±»å‹æ£€æŸ¥ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/08/cpp-type-conversion/","summary":"0. å¿…è¦æ€§ Cè¯­è¨€ä¸­çš„ç±»å‹è½¬æ¢ï¼Œæ²¡æœ‰å®‰å…¨æ£€æŸ¥ï¼Œå®‰å…¨æ€§éœ€è¦ç¨‹åºçŒ¿æ¥ä¿è¯ï¼ŒC++æä¾›äº†4ç§ç±»å‹è½¬æ¢çš„æ–¹æ³•ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯è½¬æ¢çš„å®‰å…¨æ€§ã€‚ é‡ç‚¹æ˜¯ dynamic_cast 1. const_cast ä»…ç”¨äºå»é™¤ç±»å‹çš„constå±æ€§ï¼Œä¹Ÿæ˜¯å››ç§ç±»å‹è½¬æ¢ä¸­ï¼Œå”¯ä¸€å¯ä»¥å»æ‰consté™åˆ¶çš„æ–¹æ³•ã€‚ åªèƒ½è½¬æ¢ æŒ‡é’ˆã€å¼•ç”¨ã€thisï¼ˆåœ¨ç±»å†…çš„æ—¶å€™ç”¨ï¼‰ã€‚ 2. static_cast éš","title":"C++å­¦ä¹ è®°å½•(12) ç±»å‹è½¬æ¢"},{"content":"1. ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆ ç®€è€Œè¨€ä¹‹ï¼Œä¸ºäº†æ›´å®‰å…¨çš„ä½¿ç”¨æŒ‡é’ˆã€‚\nå®ç°æ–¹å¼ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ¨¡æ¿ç±»æŠŠä¸€èˆ¬çš„æŒ‡é’ˆåŒ…è£…èµ·æ¥ã€‚ç”¨è¿™ä¸ªç±»æ¥ç»´æŠ¤å†…éƒ¨æŒ‡é’ˆçš„é‡Šæ”¾æ“ä½œã€‚\nstdä¸­æœ‰å››ç§æ™ºèƒ½æŒ‡é’ˆã€‚\nauto_ptrï¼ˆå·²å¼ƒç”¨ï¼‰ unique_ptr shared_ptr weak_ptr 2. auto_ptr æ¯”è¾ƒç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚\nå®ç°çš„åŸåˆ™æ˜¯ï¼šå†…å­˜ç©ºé—´åªèƒ½ç”±ä¸€ä¸ªæŒ‡é’ˆæ‰€æ‹¥æœ‰ã€‚\nå­˜åœ¨çš„é—®é¢˜ï¼šæ‹·è´å’Œèµ‹å€¼åï¼ŒåŸå¯¹è±¡å†…éƒ¨çš„æŒ‡é’ˆä¼šä¸ºç©ºï¼Œæœ‰é£é™©ã€‚\ntemplate\u0026lt;class T\u0026gt; class autoPtr{ public: autoPtr(T *a):m_ptr(a){ } ~autoPtr(){ if(m_ptr){ delete m_ptr; m_ptr = nullptr; } } // æ‹·è´æ„é€  æƒé™è½¬ç§» autoPtr(autoPtr\u0026lt;T\u0026gt; \u0026amp;a):m_ptr(a.m_ptr) { a.m_ptr = nullptr; } // èµ‹å€¼ æƒé™è½¬ç§» autoPtr\u0026amp; operator= (autoPtr\u0026lt;T\u0026gt; \u0026amp;a){ if(this != \u0026amp;a){ if(m_ptr) delete m_ptr; m_ptr = a.m_ptr; a.m_ptr = nullptr; } return *this; } T* operator-\u0026gt;(){ return m_ptr; } T\u0026amp; operator* (){ return *m_ptr; } private: T *m_ptr; }; 3. unique_ptr æ˜¯å¯¹auto_ptrçš„æ”¹è¿›ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚\nå®ç°çš„åŸåˆ™æ˜¯ï¼šå†…å­˜ç©ºé—´åªèƒ½ç”±ä¸€ä¸ªæŒ‡é’ˆæ‰€æ‹¥æœ‰ï¼Œä½†æ˜¯ç¦æ­¢äº†æ‹·è´å’Œèµ‹å€¼ã€‚\nåœ¨C++ä¸­unique_ptrçš„è¿›åˆ¶æ‹·è´æœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼Œå¦‚æœä¸€ä¸ªunique_ptræ˜¯å°†äº¡å€¼çš„è¯ï¼Œæ˜¯å…è®¸çš„ï¼Œæ¯”å¦‚unique_pträ½œä¸ºå‡½æ•°çš„è¿”å›å€¼æ—¶ï¼Œæ˜¯å…è®¸çš„ã€‚\n// uniquePtr å¯¹äºautoPtræ¥è¯´ ç¦æ­¢äº†æ‹·è´å’Œèµ‹å€¼ template\u0026lt;class T\u0026gt; class uniquePtr{ public: uniquePtr(const T*a):m_ptr(a) { }; ~uniquePtr(){ if(m_ptr) delete m_ptr; } T\u0026amp; operator *(){ return *m_ptr; } T* operator-\u0026gt;(){ return m_ptr; } T* get(){ return m_ptr; } private: T *m_ptr; // ç¦æ­¢æ‹·è´å’Œèµ‹å€¼ uniquePtr(const uniquePtr\u0026lt;T\u0026gt; \u0026amp;a) { }; uniquePtr\u0026lt;T\u0026gt; \u0026amp; operator = (const uniquePtr\u0026lt;T\u0026gt; \u0026amp;a) { }; }; unique_ptrç¦æ­¢äº†æ‹·è´ï¼Œé‚£ä¹ˆå¦‚ä½•æŠŠunique_pträ½œä¸ºå‚æ•°ä¼ é€’å‘¢ï¼Ÿ\næ³•1ï¼šä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨ void func(unique_ptr\u0026lt;int\u0026gt; \u0026amp;a){ } *æ³•2ï¼š æš‚æ—¶è½¬ç§»å†…å­˜çš„æ‰€æœ‰æƒï¼Œå‡½æ•°è¿”å›æ—¶ï¼Œå†æŠŠæ‰€æœ‰æƒäº¤å›æ¥ã€‚\nunique_ptr\u0026lt;int\u0026gt; func2(unique_ptr\u0026lt;int\u0026gt; a){ cout \u0026lt;\u0026lt; *a \u0026lt;\u0026lt; endl; return a; } int main() { unique_ptr\u0026lt;int\u0026gt; a(new int(6)); // æš‚æ—¶é‡Šæ”¾æ‰€æœ‰æƒ a = func2(unique_ptr\u0026lt;int\u0026gt;(a.release())); return 0; } æ³•3ï¼šmoveè¯­ä¹‰ void func1(unique_ptr\u0026lt;int\u0026gt; a) { cout \u0026lt;\u0026lt; *a \u0026lt;\u0026lt; endl; } int main() { unique_ptr\u0026lt;int\u0026gt; a(new int(6)); func1(std::move(a)); return 0; } 4. shared_ptr å®ç°é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚\nå®ç°çš„åŸåˆ™æ˜¯ï¼šå†…å­˜ç©ºé—´å¯ä»¥ç”±å¤šä¸ªæŒ‡é’ˆæ‰€æ‹¥æœ‰ï¼Œä½†æ˜¯è¦æ§åˆ¶å†…å­˜é‡Šæ”¾çš„æ—¶æœºï¼Œè¿™ä¸ªæ—¶æœºç”±â€œå¼•ç”¨è®¡æ•°â€æ¥å®ç°ã€‚\nå­˜åœ¨ä¸ºé—®é¢˜ï¼šä¼šå­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¯¼è‡´å†…å­˜æ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚\ntemplate\u0026lt;class T\u0026gt; class sharedPtr{ public: sharedPtr(T *a):m_ptr(a), m_count(new int(1)) { }; ~sharedPtr(){ if(--(*m_count) == 0){ delete m_ptr; delete m_count; m_ptr = nullptr; m_count = nullptr; } } T\u0026amp; operator *(){ return *m_ptr; } T* operator-\u0026gt;(){ return m_ptr; } // æ‹·è´æ„é€  sharedPtr(const sharedPtr\u0026lt;T\u0026gt; \u0026amp;a):m_ptr(a.m_ptr),m_count(a.m_count) { ++(*m_count); } // èµ‹å€¼å‡½æ•° sharedPtr\u0026lt;T\u0026gt; \u0026amp; operator=(const sharedPtr\u0026lt;T\u0026gt; \u0026amp;a){ if(m_ptr != a.m_ptr){ // this åŸæ¥çš„é‚£ä¸ªåŒºåŸŸå¤„ç† if(--(*m_count) == 0){ // è¿™é‡Œä¸ä»…ä»…æ˜¯æ£€æŸ¥ï¼Œä¹Ÿä¼šå¼•ç”¨è®¡æ•°å‡1 delete m_ptr; delete m_count; m_ptr = nullptr; m_count = nullptr; } m_ptr = a.m_ptr; m_count = a.m_count; ++(*m_count); } return *this; } int use_count(){ return *m_count; } int * use_countPtr(){ return m_count; } T* get(){ return m_ptr; } private: T *m_ptr; int *m_count; }; shared_pträ¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¦‚ä¸‹ä»£ç \ntemplate\u0026lt;class T\u0026gt; class sharedPtr{ public: sharedPtr(T *a):m_ptr(a), m_count(new int(1)) { }; ~sharedPtr(){ if(--(*m_count) == 0){ delete m_ptr; delete m_count; m_ptr = nullptr; m_count = nullptr; } } T\u0026amp; operator *(){ return *m_ptr; } T* operator-\u0026gt;(){ return m_ptr; } // æ‹·è´æ„é€  sharedPtr(const sharedPtr\u0026lt;T\u0026gt; \u0026amp;a):m_ptr(a.m_ptr),m_count(a.m_count) { ++(*m_count); } // èµ‹å€¼å‡½æ•° sharedPtr\u0026lt;T\u0026gt; \u0026amp; operator=(const sharedPtr\u0026lt;T\u0026gt; \u0026amp;a){ if(m_ptr != a.m_ptr){ // this åŸæ¥çš„é‚£ä¸ªåŒºåŸŸå¤„ç† if(--(*m_count) == 0){ // è¿™é‡Œä¸ä»…ä»…æ˜¯æ£€æŸ¥ï¼Œä¹Ÿä¼šå¼•ç”¨è®¡æ•°å‡1 delete m_ptr; delete m_count; m_ptr = nullptr; m_count = nullptr; } m_ptr = a.m_ptr; m_count = a.m_count; ++(*m_count); } return *this; } int use_count(){ return *m_count; } int * use_countPtr(){ return m_count; } T* get(){ return m_ptr; } private: T *m_ptr; int *m_count; }; int main() { struct Node{ Node():pre(nullptr), next(nullptr) { } int data; sharedPtr\u0026lt;Node\u0026gt; pre; sharedPtr\u0026lt;Node\u0026gt; next; }; int *c1 = nullptr; int *c2 = nullptr; { // è¿™é‡Œä¸€ä¸ªèŠ±æ‹¬å·ï¼Œé™åˆ¶äº†ä½œç”¨åŸŸ sharedPtr\u0026lt;Node\u0026gt; a(new Node); sharedPtr\u0026lt;Node\u0026gt; b(new Node); a-\u0026gt;next = b; b-\u0026gt;pre = a; // æŠŠå„è‡ªçš„m_countå–å‡ºæ¥ c1 = a.use_countPtr(); c2 = b.use_countPtr(); cout \u0026lt;\u0026lt; *c1 \u0026lt;\u0026lt;endl; cout \u0026lt;\u0026lt; *c2 \u0026lt;\u0026lt;endl; } // å› ä¸ºä¸Šè¾¹a å’Œ båœ¨ææ„æ—¶ï¼Œæ²¡æœ‰é‡Šæ”¾m_ptrå’Œm_countï¼Œæ‰€ä»¥ï¼Œä¸‹è¾¹ä¸¤è¡Œå¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”ä¸º1 cout \u0026lt;\u0026lt; *c1 \u0026lt;\u0026lt;endl; cout \u0026lt;\u0026lt; *c2 \u0026lt;\u0026lt;endl; return 0; } å¯¹è±¡aå’Œbæœ¬èº«ä¸ºsharedPtrç±»å‹ï¼Œå†…éƒ¨å„åŒ…å«ä¸€ä¸ªNode*å¹¶ä¸”å¼€è¾Ÿäº†å†…å­˜ã€‚ä¸ºäº†æ–¹ä¾¿åç»­æè¿°ï¼Œaä¸­ç”³è¯·çš„è¿™å—å†…å­˜ç§°ä¹‹ä¸ºA_Node*ï¼Œbä¸­çš„è¿™å—å†…å­˜ç§°ä¹‹ä¸ºB_Node*ã€‚\naå’Œbåˆå§‹åŒ–æ—¶ï¼Œå†…éƒ¨çš„å¼•ç”¨è®¡æ•°å‡ä¸º1ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™åªæœ‰è‡ªå·±ä½¿ç”¨è‡ªå·±å†…éƒ¨çš„è¿™å—å†…å­˜ç©ºé—´ã€‚\nå½“æ‰§è¡Œäº†\na-\u0026gt;next = b; b-\u0026gt;pre = a; è¿™ä¸¤è¡Œä»£ç ä»¥åï¼Œaå’Œbå†…éƒ¨çš„å¼•ç”¨æŠ€æœ¯å‡ä¸º2ã€‚æ­¤æ—¶å¯¹äºaæ¥è¯´ï¼Œä¸ä»…ä»…è‡ªå·±ä½¿ç”¨A_Node*ï¼ŒåŒæ—¶bä¸­çš„ä¸€ä¸ªsharedPtr\u0026lt;Node\u0026gt;ç±»å‹ï¼ˆä¸aåŒç±»å‹ï¼‰çš„preï¼Œä¹Ÿä½¿ç”¨A_Node*ï¼Œæ‰€ä»¥aä¸­çš„å¼•ç”¨è®¡æ•°ä¸º2ï¼Œbä¸­preå†…éƒ¨çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¸º2ã€‚\nå¯¹äºbæ¥è¯´ï¼ŒåŒç†ï¼Œä¸ä»…ä»…è‡ªå·±ä½¿ç”¨B_Node*ï¼ŒåŒæ—¶aä¸­çš„ä¸€ä¸ªsharedPtr\u0026lt;Node\u0026gt;ç±»å‹ï¼ˆä¸båŒç±»å‹ï¼‰çš„nextï¼Œä¹Ÿä½¿ç”¨B_Node*ï¼Œæ‰€ä»¥bä¸­çš„å¼•ç”¨è®¡æ•°ä¸º2ï¼Œaä¸­nextå†…éƒ¨çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¸º2ã€‚\né‡ç‚¹æ¥äº†ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°èŠ±æ‹¬å·å¤–è¾¹çš„æ—¶å€™ï¼Œaå’Œbä¸¤ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ°äº†ï¼Œè¦æ‰§è¡Œå„è‡ªçš„ææ„å‡½æ•°ã€‚ä½†æ˜¯ï¼æ‰§è¡Œaçš„ææ„å‡½æ•°æ—¶ï¼Œç”±äºå¼•ç”¨è®¡æ•°ä¸º2ï¼Œå‡å»1ä¹‹åä¸ä¸º0ï¼Œæ‰€ä»¥ï¼Œä¸ä¼šé‡Šæ”¾aå†…éƒ¨çš„m_ptrå’Œm_countï¼Œåªä¸è¿‡æŠŠm_countå˜ä¸ºäº†1ï¼Œç”±äºå¼•ç”¨è®¡æ•°æœºåˆ¶çš„å­˜åœ¨ï¼Œæ­¤æ—¶bä¸­çš„preï¼Œè¿™ä¸ªæ™ºèƒ½æŒ‡é’ˆå†…éƒ¨çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¼šå˜ä¸º1ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯aè¿™ä¸ªå¯¹è±¡è¢«ææ„äº†ï¼Œä½†æ˜¯ A_Node* æ²¡é‡Šæ”¾ã€‚\nåŒç†ï¼Œæ‰§è¡Œbçš„ææ„å‡½æ•°æ—¶ï¼Œç”±äºå¼•ç”¨è®¡æ•°ä¸º2ï¼Œå‡å»1ä¹‹åä¸ä¸º0ï¼Œæ‰€ä»¥ï¼Œä¸ä¼šé‡Šæ”¾bå†…éƒ¨çš„m_ptrå’Œm_countï¼Œåªä¸è¿‡æŠŠm_countå˜ä¸ºäº†1ï¼Œç”±äºå¼•ç”¨è®¡æ•°æœºåˆ¶çš„å­˜åœ¨ï¼Œæ­¤æ—¶aä¸­çš„nextï¼Œè¿™ä¸ªæ™ºèƒ½æŒ‡é’ˆå†…éƒ¨çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¼šå˜ä¸º1ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯bè¿™ä¸ªå¯¹è±¡è¢«ææ„äº†ï¼Œä½†æ˜¯ B_Node* æ²¡é‡Šæ”¾ã€‚\nç»è¿‡äº†aå’Œbä¸¤ä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ï¼Œç°åœ¨çš„æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ\nA_Node*ä¸­çš„nextæŒ‡å‘B_Node*ã€‚\nB_Node*ä¸­çš„preæŒ‡å‘A_Node*ã€‚\næ­¤æ—¶å‘¢ï¼Œå½¢æˆäº†ç¯ã€‚\nåœ¨æ²¡æœ‰äººä¸ºå¹²é¢„çš„æƒ…å†µä¸‹ï¼Œæƒ³é‡Šæ”¾A_Node*ï¼Œå°±å¿…é¡»å…ˆé‡Šæ”¾ B_Node*ã€‚\nå› ä¸ºä¸€æ—¦B_Node*é‡Šæ”¾ï¼Œä¼šè§¦å‘B_Node*å†…éƒ¨preæŒ‡é’ˆçš„ææ„å‡½æ•°ï¼Œå› æ­¤è¿™æ—¶preå†…éƒ¨çš„å¼•ç”¨è®¡æ•°ä¸º1ï¼Œå‡1ä¹‹åå˜ä¸º0ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥é‡Šæ”¾æ‰preæ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ä¼šé‡Šæ”¾æ‰A_Node*ï¼Œç„¶åæ¥ç€ä¼šè§¦å‘A_Node*å†…éƒ¨nextæŒ‡é’ˆçš„ææ„å‡½æ•°ï¼ŒåŒç†ï¼ŒnextæŒ‡é’ˆä¼šæŠŠè‡ªå·±æŒ‡å‘çš„B_Node*ç»™é‡Šæ”¾æ‰ï¼Œè¿™æ ·ï¼ŒA_Node*å’ŒB_Node*è¿™ä¸¤å—è¢«aå’Œbé—ç•™ä¸‹æ¥çš„å†…å­˜ç©ºé—´å°±å¯ä»¥æ­£å¸¸è¢«é‡Šæ”¾ã€‚\nä½†æ˜¯ï¼ï¼ï¼é—®é¢˜æ¥äº†ï¼Œæƒ³é‡Šæ”¾B_Node*ï¼Œå°±å¿…é¡»å…ˆé‡Šæ”¾ A_Node*ã€‚\näºŒè€…äº’ç›¸ç­‰å¾…ï¼Œéƒ½ç­‰å¾…å¯¹æ–¹å…ˆé‡Šæ”¾ï¼Œè¿™ä¸ªå°±æ˜¯å¾ªç¯å¼•ç”¨ã€‚\nè§£å†³åŠæ³•\næŠŠNodeä¸­çš„ä¸¤ä¸ªshared_ptræ¢æˆweak_ptrå³å¯ï¼Œè¿™æ ·ï¼Œaå’Œbçš„å¼•ç”¨è®¡æ•°å‡ä¸º1ï¼Œå¯ä»¥æ­£å¸¸æ˜¯é‡Šæ”¾ã€‚\n5. weak_ptr æ˜¯å¯¹shared_ptrçš„ä¿®æ”¹ï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚\nå®ç°çš„åŸåˆ™æ˜¯ï¼šå…è®¸ä¸€å—å†…å­˜ç”±å¤šä¸ªæŒ‡é’ˆæ‹¥æœ‰ï¼Œä¸shared_pträ¸åŒçš„æ˜¯ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚\nå­˜åœ¨çš„é—®é¢˜ï¼šé€‚ç”¨æ€§ä¸å¦‚shared_ptrå¹¿ï¼Œå› ä¸ºä¸€ä¸ªweak_ptré‡Šæ”¾çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠè‡ªå·±æŒ‡å‘çš„åŒºåŸŸé‡Šæ”¾æ‰ï¼Œå¯èƒ½ä¼šé‡å¤é‡Šæ”¾ã€‚\n// weak ptr ï¼Œä¸sharedPtrçš„ä¸åŒåœ¨äºï¼Œæ²¡æœ‰å¼•ç”¨è®¡æ•°ï¼Œæ€»æ˜¯ï¼ŒweakPtrï¼Œå…±äº«ï¼Œä½†ä¸è®¡æ•°ï¼Œç›´æ¥é‡Šæ”¾ template\u0026lt;class T\u0026gt; class weakPtr{ public: weakPtr(T *a):m_ptr(a){ } ~weakPtr(){ if(m_ptr) { delete m_ptr; m_ptr = nullptr; } } // èµ‹å€¼ weakPtr\u0026lt;T\u0026gt; \u0026amp; operator= (const weakPtr\u0026lt;T\u0026gt; \u0026amp;a){ if(m_ptr) delete m_ptr; m_ptr = a.m_ptr; return *this; } weakPtr\u0026lt;T\u0026gt; \u0026amp; operator= (T *a){ m_ptr = a; return *this; } T\u0026amp; operator *(){ return *m_ptr; } T* operator-\u0026gt;(){ return m_ptr; } private: T *m_ptr; }; ","permalink":"https://Clay-Hex.github.io/posts/2021/07/cpp-smart-pointers/","summary":"1. ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆ ç®€è€Œè¨€ä¹‹ï¼Œä¸ºäº†æ›´å®‰å…¨çš„ä½¿ç”¨æŒ‡é’ˆã€‚ å®ç°æ–¹å¼ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ¨¡æ¿ç±»æŠŠä¸€èˆ¬çš„æŒ‡é’ˆåŒ…è£…èµ·æ¥ã€‚ç”¨è¿™ä¸ªç±»æ¥ç»´æŠ¤å†…éƒ¨æŒ‡é’ˆçš„é‡Šæ”¾æ“ä½œã€‚ stdä¸­æœ‰å››ç§æ™ºèƒ½æŒ‡é’ˆã€‚ auto_ptrï¼ˆå·²å¼ƒç”¨ï¼‰ unique_ptr shared_ptr weak_ptr 2. auto_ptr æ¯”è¾ƒç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ç°é€»è¾‘å¦‚ä¸‹ä»£ç ã€‚ å®ç°çš„åŸåˆ™æ˜¯ï¼šå†…å­˜ç©ºé—´åªèƒ½ç”±ä¸€ä¸ªæŒ‡é’ˆæ‰€æ‹¥æœ‰ã€‚","title":"C++å­¦ä¹ è®°å½•(11) æ™ºèƒ½æŒ‡é’ˆ"},{"content":"0. åŸææ–™ æŠ“åŒ…å·¥å…·ï¼šwireshark\nè®¸å¤šæ–‡ç« éƒ½æ˜¯ä½¿ç”¨æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼ŒæŠ“httpçš„åŒ…ï¼Œè¿›è€Œåˆ†æä¸‹å±‚çš„tcpåè®®è¿‡ç¨‹ï¼Œä½†æ˜¯æ•°æ®æ¯”è¾ƒå¤šï¼Œä¸æ¸…æ™°ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº†TCPè°ƒè¯•åŠ©æ‰‹ï¼Œè¿™æ ·çš„è¯ï¼Œæ²¡æœ‰httpæ•°æ®çš„å¹²é¢„ï¼Œæ¯”è¾ƒæ¸…æ™°ã€‚\n1. ç¯å¢ƒ å€Ÿç”¨www.huawei.comçš„ipåœ°å€183.66.110.167ã€‚\nå› ä¸ºè¿™ä¸ªipåœ°å€å¼€äº†httpæœåŠ¡ï¼Œåˆå› ä¸ºhttpåè®®ä¸‹å±‚é‡‡ç”¨çš„tcpï¼Œæ‰€ä»¥è¿™ä¸ªipçš„80ç«¯å£ä¸€å®šæœ‰TCPæœåŠ¡åœ¨ç›‘å¬ã€‚\nä½¿ç”¨TCPè°ƒè¯•åŠ©æ‰‹ï¼Œåˆ›å»ºä¸€ä¸ªè¿æ¥\nè¿æ¥ç±»å‹ï¼šTCP ç›®æ ‡IPï¼š183.66.110.167 ç«¯å£ï¼š80 ç‚¹å‡»ã€ç¡®å®šã€‘å\nè‡³æ­¤ï¼Œç¯å¢ƒé…ç½®å®Œæ¯•ã€‚\n2. æŠ“åŒ… é¦–å…ˆæ‰“å¼€wiresharkï¼Œé€‰æ‹©è¦ç›‘å¬çš„ç½‘å¡ï¼Œç„¶ååœ¨è¿‡æ»¤å™¨ä¸­è¾“å…¥ip.addr == 183.66.110.167ï¼Œç›®çš„æ˜¯è¦è¿‡æ»¤å‡ºè¿™ä¸ªIPåœ°å€çš„æ•°æ®åŒ…ã€‚\nä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ ç„¶ååœ¨ç‚¹å‡»TCPè°ƒè¯•å·¥å…·ä¸­çš„ã€è¿æ¥ã€‘\nä¹‹åï¼Œwiresharkä¸­å¯ä»¥çœ‹åˆ°3ä¸ªæ•°æ®åŒ…ï¼Œè¿™3ä¸ªå°±æ˜¯TCPçš„ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹äº†ã€‚\nã€ç¬¬ä¸€æ¬¡æ¡æ‰‹ã€‘\nClientå‘ç»™Server\nSYN = 1, seq = 0\nã€ç¬¬äºŒæ¬¡æ¡æ‰‹ã€‘\nServerå‘ç»™Client\nSYN= 1, ACK = 1, Seq = 0, Ack = 1\nã€ç¬¬ä¸‰æ¬¡æ¡æ‰‹ã€‘\nClientå‘ç»™Server\nACK = 1, Ack = 1, Seq = 1\nå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ ç‚¹å‡»ã€æ–­å¼€è¿æ¥ã€‘ï¼Œä¼šå†å‡ºç°4ä¸ªæ•°æ®åŒ…ï¼Œè¿™æ˜¯å››æ¬¡æŒ¥æ‰‹çš„æ•°æ®åŒ…ã€‚\nã€ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ã€‘\nFIN = 1, ACK = 1, Seq = 1, Ack = 1ï¼ˆè¿™é‡Œçš„ACKå’ŒAckä¸é‡è¦ï¼‰\nã€ç¬¬äºŒæ¬¡æŒ¥æ‰‹ã€‘\nACK = 1, Seq = 1, Ack = 2\nã€ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ã€‘\nFIN = 1, ACK = 1, Seq = 1, Ack = 2\nã€ç¬¬å››æ¬¡æŒ¥æ‰‹ã€‘\nACK = 1, seq = 2, Ack = 2\nå‘é€æ•°æ®æµ‹è¯• è¿æ¥çš„ç™¾åº¦æœåŠ¡å™¨ï¼Œè¿æ¥æˆåŠŸåï¼Œå¿«é€Ÿå‘é€ä¸¤æ¡æ¶ˆæ¯ï¼Œä¸¤æ¡æ¶ˆæ¯å†…å®¹éƒ½æ˜¯adminï¼Œç„¶åæ–­å¼€è¿æ¥ï¼ŒæŠ“åŒ…æ•°æ®å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æ¡æ‰‹å’ŒæŒ¥æ‰‹å¤–ï¼Œæ¯æ¬¡çš„æ¶ˆæ¯éƒ½æœ‰ç¡®è®¤å›å¤ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/07/wireshark-tcp-handshake-wave/","summary":"0. åŸææ–™ æŠ“åŒ…å·¥å…·ï¼šwireshark è®¸å¤šæ–‡ç« éƒ½æ˜¯ä½¿ç”¨æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼ŒæŠ“httpçš„åŒ…ï¼Œè¿›è€Œåˆ†æä¸‹å±‚çš„tcpåè®®è¿‡ç¨‹ï¼Œä½†æ˜¯æ•°æ®æ¯”è¾ƒå¤šï¼Œä¸æ¸…æ™°ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº†TCPè°ƒè¯•åŠ©æ‰‹ï¼Œè¿™æ ·çš„è¯ï¼Œæ²¡æœ‰httpæ•°æ®çš„å¹²é¢„ï¼Œæ¯”è¾ƒæ¸…æ™°ã€‚ 1. ç¯å¢ƒ å€Ÿç”¨www.huawei.comçš„ipåœ°å€183.66.1","title":"Wiresharké…åˆTCPè°ƒè¯•å·¥å…·ç†è§£TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹"},{"content":"0. ä¸ºä»€ä¹ˆè¦å†…å­˜å¯¹é½ï¼Ÿ ç»è¿‡å†…å­˜å¯¹é½ä¹‹åï¼Œä¸€ä¸ªæœ€æœ€ä¸»è¦çš„åŸå› æ˜¯å¯ä»¥ä½¿å¾—CPUçš„å†…å­˜è®¿é—®é€Ÿåº¦å¤§å¤§æå‡ã€‚\nå†…å­˜ç©ºé—´æŒ‰ç…§byteåˆ’åˆ†ï¼Œä»ç†è®ºä¸Šè®²ä¼¼ä¹å¯¹ä»»ä½•ç±»å‹çš„å˜é‡çš„è®¿é—®å¯ä»¥ä»ä»»ä½•åœ°å€å¼€å§‹ï¼Œä½†å®é™…æƒ…å†µæ˜¯åœ¨è®¿é—®ç‰¹å®šå˜é‡çš„æ—¶å€™ç»å¸¸åœ¨ç‰¹å®šçš„å†…å­˜åœ°å€è®¿é—®ï¼Œè¿™å°±éœ€è¦å„ç±»å‹æ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åœ¨ç©ºé—´ä¸Šæ’åˆ—ï¼Œè€Œä¸æ˜¯é¡ºåºçš„ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ’æ”¾ï¼Œè¿™å°±æ˜¯å¯¹é½ã€‚\nç”¨ç©ºé—´æ¢æ—¶é—´ï¼\nCPUåœ¨è¯»å†…å­˜çš„æ—¶å€™æ˜¯nä¸ªä¸ºä¸€ç»„çš„æ–¹å¼å»è¯»ã€‚\nå‡è®¾æ­¤æ—¶4ä¸ªå­—èŠ‚ä¸ºä¸€ç»„å»è¯»ã€‚\nå†…å­˜å¯¹é½ä¹‹åçš„å†…å­˜ç©ºé—´å¦‚ä¸‹å›¾ï¼š\nè¿™æ ·çš„è¯ï¼Œåªéœ€è¦è¯»å†…å­˜2æ¬¡ã€‚\nå…ˆä»ç¬¬ä¸€ç»„è¯»ï¼Œç„¶åæ‰£é™¤0ä½ç½®ï¼Œaå°±è¯»å–ç»“æŸäº†ã€‚\nè¯»bçš„æ—¶å€™ï¼Œå…ˆè¯»ç¬¬ä¸€ç»„ï¼Œæ‰£é™¤1ï¼Œ2ï¼Œ3ã€‚ç„¶åè¯»ç¬¬äºŒç»„ï¼Œæ‰£é™¤4ï¼Œæ‹¼èµ·æ¥ç»„æˆå˜é‡bã€‚\nè¿™æ ·çš„è¯ã€‚ä¸€å…±è¯»äº†3æ¬¡ã€‚\n1. å†…å­˜å¯¹é½çš„åŸåˆ™? #pragma pack(N); // N å­—èŠ‚å¯¹é½ï¼› é»˜è®¤ä¸º4(32ä½), 8(64ä½) æ•°æ®æˆå‘˜å¯¹é½è§„åˆ™ï¼š\n* ç¬¬ä¸€ä¸ªæˆå‘˜offset = 0;\n* åé¢æ¯ä¸ªæˆå‘˜çš„èµ·å§‹ä½ç½®ä¸ºï¼šmin( N, è‡ªèº«é•¿åº¦) çš„ å€æ•°\nå¦‚æœæˆå‘˜ä¸­æœ‰ç»“æ„ä½“ï¼Œé‚£ä¹ˆè¯¥ç»“æ„ä½“çš„èµ·å§‹ä½ç½®ä¸ºï¼Œmin( N, ç»“æ„ä½“å†…éƒ¨æ‰€æœ‰æˆå‘˜æœ€å¤§é•¿åº¦) çš„å€æ•°\nç»“æ„ä½“çš„æ€»å¤§å°ï¼Œä¹Ÿå°±æ˜¯sizeofçš„ç»“æœï¼Œå¿…é¡»æ˜¯ min(#pragram pack() , é•¿åº¦æœ€é•¿çš„æ•°æ®æˆå‘˜) çš„æ•´æ•°å€\næ³¨æ„ï¼ŒNå¿…é¡»ä¸º1,2,4,8\u0026hellip;è¿™ç§æ‰ç”Ÿæ•ˆï¼Œå¦åˆ™çš„è¯ï¼Œéƒ½æ˜¯æŒ‰é»˜è®¤çš„å­—èŠ‚æ•°è¿›è¡Œå¯¹é½ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/06/cpp-memory-alignment/","summary":"0. ä¸ºä»€ä¹ˆè¦å†…å­˜å¯¹é½ï¼Ÿ ç»è¿‡å†…å­˜å¯¹é½ä¹‹åï¼Œä¸€ä¸ªæœ€æœ€ä¸»è¦çš„åŸå› æ˜¯å¯ä»¥ä½¿å¾—CPUçš„å†…å­˜è®¿é—®é€Ÿåº¦å¤§å¤§æå‡ã€‚ å†…å­˜ç©ºé—´æŒ‰ç…§byteåˆ’åˆ†ï¼Œä»ç†è®ºä¸Šè®²ä¼¼ä¹å¯¹ä»»ä½•ç±»å‹çš„å˜é‡çš„è®¿é—®å¯ä»¥ä»ä»»ä½•åœ°å€å¼€å§‹ï¼Œä½†å®é™…æƒ…å†µæ˜¯åœ¨è®¿é—®ç‰¹å®šå˜é‡çš„æ—¶å€™ç»å¸¸åœ¨ç‰¹å®šçš„å†…å­˜åœ°å€è®¿é—®ï¼Œè¿™å°±éœ€è¦å„ç±»å‹æ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åœ¨ç©ºé—´ä¸Šæ’åˆ—","title":"C++å­¦ä¹ è®°å½•(10) å†…å­˜å¯¹é½"},{"content":"è½¬è‡ªï¼šhttps://www.cnblogs.com/stemon/p/4406824.html\nå‰å‡ å¤©å¥³ç¥¨é—®äº†æˆ‘ä¸€ä¸ªé˜¿é‡Œçš„é¢è¯•é¢˜ï¼Œæ˜¯æœ‰å…³C++è¯­è¨€çš„constå¸¸é‡çš„ï¼Œå…¶å®å¥¹ä¸€æå‡ºæ¥æˆ‘å°±çŸ¥é“è€ƒå¯Ÿçš„ç‚¹äº†ï¼šè‚¯å®šæ˜¯constå¸¸é‡çš„å†…å­˜ä¸æ˜¯åˆ†é…åœ¨read-onlyçš„å­˜å‚¨åŒºçš„ï¼Œconstå¸¸é‡çš„å†…å­˜åˆ†é…åŒºæ˜¯å¾ˆæ™®é€šçš„æ ˆæˆ–è€…å…¨å±€åŒºåŸŸã€‚ä¹Ÿå°±æ˜¯è¯´constå¸¸é‡åªæ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™åšæ£€æŸ¥ï¼Œæ ¹æœ¬ä¸å­˜åœ¨ä»€ä¹ˆread-onlyçš„åŒºåŸŸã€‚\næ‰€ä»¥è¯´C++çš„constå¸¸é‡å’Œå¸¸é‡å­—ç¬¦ä¸²æ˜¯ä¸åŒçš„ï¼Œå¸¸é‡å­—ç¬¦ä¸²æ˜¯å­˜å‚¨åœ¨read-onlyçš„åŒºåŸŸçš„ï¼Œä»–ä»¬çš„å…·ä½“çš„å­˜å‚¨åŒºåŸŸæ˜¯ä¸åŒçš„ã€‚\nå°±å¥½åƒæ¨ç«‹ç¿”è€å¸ˆåœ¨ä¸Šè¯¾ä¸¾å¾—é‚£ä¸ªä¾‹å­ï¼ˆè®²çš„ä¸œè¥¿å¿˜å¾—å·®ä¸å¤šäº†ï¼Œä½†æ˜¯ä¾‹å­éƒ½è®°å¾—ï¼Œä»€ä¹ˆæ’•æˆ·å£æœ¬ï¼Œæœˆé¥¼æ¨¡å­ä¹‹ç±»çš„ï¼‰ï¼š\nåœºæ™¯ï¼šè€å¼çš„ç”µå½±æ”¾æ˜ æœºï¼Œé—¨å£çš„æ£€ç¥¨å‘˜ï¼Œæœ€åæ’é‚£ä¸ªåº§ä½ä¸Šçš„æ”¾æ˜ å¸ˆå‚…ï¼Œå¥½å¤šçš„è§‚ä¼—å¸­ã€‚\nä½ çš„ç”µå½±ç¥¨ä¸Šæœ‰ä½ çš„åå­—ï¼Œæ£€ç¥¨å‘˜çš„æ‰‹é‡Œæœ‰ä¸ªåå­—å’Œåº§ä½å·çš„å¯¹åº”è¡¨ï¼Œæ£€ç¥¨å‘˜ä¸å…è®¸è§‚ä¼—ä¹±åä½ç½®ã€‚\næ‰€ä»¥æ¸¸æˆå°±è¿™æ ·å¼€å§‹äº†ï¼Œç”µå½±é™¢çš„æ¯ä¸€ä¸ªè§‚ä¼—å¸­éƒ½æ˜¯constå¸¸é‡ç±»å‹çš„ï¼Œæ£€ç¥¨å‘˜å°±æ˜¯ç¼–è¯‘å™¨ï¼Œåœ¨è§‚ä¼—è¿›é—¨çš„æ—¶å€™ï¼Œæ¯ä¸ªäººéƒ½å¿…é¡»åè‡ªå·±ç¥¨ä¸Šçš„ä½å­ï¼Œä¹Ÿå°±æ˜¯è¯´è§‚ä¼—å¿…é¡»æ‹¿ç€è‡ªå·±çš„ç¥¨è¿›é—¨ã€‚ä½ æ‹¿ç€åˆ«äººçš„ç¥¨å°±ä¸è®©ä½ è¿›å»ï¼Œæ‰€ä»¥å°±ä¸èƒ½æ›´æ¢åº§ä½ã€‚\nç±»æ¯”åˆ°C++è¯­è¨€ä¸Šï¼Œåœºæ™¯åº”è¯¥æ˜¯è¿™æ ·çš„ï¼šå¯¹äºå“ªäº›constå¸¸é‡ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»å†³å®šäº†ï¼Œä»–ä»¬åœ¨å†…å­˜çš„å­˜å‚¨ä½ç½®ï¼Œä½ å¦‚æœç›´æ¥æ”¹è¿™ä¸ªå¸¸é‡çš„å€¼æ˜¯ä¸åˆæ³•çš„ã€‚å°±å¥½åƒä½ ä¸èƒ½æ‹¿ç€ä¸€å¼ åˆ«äººçš„ç”µå½±ç¥¨è¿›ç”µå½±é™¢ï¼Œå› ä¸ºæ£€ç¥¨å‘˜æ‰‹é‡Œæœ‰ä¸€å¼ åº§ä½å·åˆ°å§“åçš„æ˜ å°„è¡¨ï¼Œä»–çŸ¥é“å“ªä¸ªåº§ä½è¯¥åè°ï¼Œå¹¶ä¸”ä¸è®©è§‚ä¼—éšæ„è°ƒæ¢ï¼ˆè¿™ä¸ªä¾‹å­å°¼ç›çœŸçš„å¥½å½¢è±¡å•Šï¼Œæ¨è€å¸ˆè¯´çš„æ²¡æœ‰è¿™ä¹ˆå¥½ï¼Œæˆ‘åæœŸæ ¹æ®è‡ªå·±çš„ç†è§£ç¨å¾®æ·»æ²¹åŠ é†‹ï¼‰ã€‚å…¶å®æ£€ç¥¨å‘˜æ‰‹é‡Œçš„é‚£å¼ æ˜ å°„è¡¨å°±æ˜¯ç¼–è¯‘å™¨çš„ç¬¦å·è¡¨ï¼Œæ˜¯ä¸æ˜¯çœŸçš„å¾ˆå½¢è±¡ï¼Œå…³äºè¿™ä¸ªç¬¦å·è¡¨åé¢è¯´ã€‚\né‚£ä¹ˆæ–°çš„é—®é¢˜æ¥äº†ï¼Œè§‚ä¼—è¿›åˆ°ç”µå½±é™¢ä»¥åï¼Œæˆ‘è·Ÿæ—è¾¹çš„å“¥ä»¬è¯´ä¸€å£°ï¼Œæˆ‘ç»™ä½ 100å—ï¼Œä½ ç»™æˆ‘æ¢ä¸€ä¸‹ä½ç½®å§ï¼Œå¦‚æœä»–åŒæ„äº†ï¼Œæˆ‘ä»¬å°±èƒ½æ¢ã€‚æ£€ç¥¨å‘˜ç®¡ä¸ç€ï¼Œè¿›éƒ½è¿›æ¥äº†ï¼Œè¿˜èƒ½æ€æ ·ã€‚æ‰€ä»¥ä¸¤ä¸ªäººå°±è°ƒæ¢äº†ä½å­ã€‚\nC++çš„constå¸¸é‡ä¸€æ ·æ˜¯è¿™ä¸ªæ ·å­ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™è¦æŸ¥çœ‹å®ƒæ‰‹é‡Œçš„ç¬¦å·è¡¨ï¼Œå¦‚æœä½ æ‹¿çš„æ˜¯ä¸€ä¸ªconstå¸¸é‡ï¼Œå¹¶ä¸”ä½ è¦ä¿®æ”¹è¿™ä¸ªå¸¸é‡çš„å€¼ï¼Œä»–å°±æ‹’ç»ã€‚ä½†æ˜¯è¿™ç§æ£€æŸ¥å€¼ä¼šå‘ç”Ÿåœ¨ç¼–è¯‘å™¨ï¼Œå¦‚æœæˆ‘èƒ½ç»•è¿‡ç¼–è¯‘å™¨ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ä¿®æ”¹è¿™ä¸ªconstçš„å€¼ï¼Œå°†ä¼šæ˜¯å¾ˆeasyçš„ä¸€ä»¶äº‹ï¼Œå°±åƒå‰é¢è¯´çš„ï¼Œæˆ‘ç»™é‚£å“¥ä»¬100å—å°±æå®šäº†ã€‚æ‰€ä»¥è¯´constå¸¸é‡çš„å­˜å‚¨ç©ºé—´åŒå…¶ä»–çš„å˜é‡çš„å­˜å‚¨ç©ºé—´æ²¡æœ‰ä»»ä½•çš„åŒºåˆ«ï¼Œå®ƒçš„è¿™ç§å¸¸é‡ä¸å…è®¸å°±è¯¥çš„æ£€æŸ¥åªå‘ç”Ÿåœ¨ç¼–è¯‘å™¨çš„ç¼–è¯‘é˜¶æ®µã€‚\nä½†æ˜¯å¸¸é‡å­—ç¬¦ä¸²çš„å­˜å‚¨ä½ç½®å°±ä¸åŒäº†ï¼Œå®ƒçš„å­˜å‚¨ä½ç½®æ˜¯read-onlyçš„åŒºåŸŸï¼Œå°±åƒç”µå½±é™¢æœ€åçš„é‚£ä¸ªæ”¾æ˜ å¸ˆçš„ä½ç½®ï¼Œé‚£é‡Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä½ç½®ï¼Œæ˜¯çœŸçš„ä¸å…è®¸éšä¾¿çš„è°ƒæ¢ï¼Œä½ ç»™ä»–1000ä¹Ÿä¸ç»™ä½ æ¢ï¼Œå› ä¸ºå¸ˆå‚…è¦åœ¨é‚£ä¸ªä½ç½®æ”¾æ˜ ï¼Œä¸ç„¶æ²¡æ³•çœ‹ç”µå½±ã€‚å½“ç„¶äº†ï¼Œå®ç°è¿™ç§read-onlyçš„å­˜å‚¨åŒºåŸŸä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠé‚£ä¸ªå†…å­˜çš„é¡µï¼ˆpageï¼‰çš„å±æ€§æ ‡è®°ä¸ºåªè¯»çš„å°±å¥½äº†ã€‚\nå¯¹äº†ï¼Œå½“æ—¶æˆ‘è¿˜æƒ³èµ·äº†è¿™ä¸ªï¼š\nconst int *p1; /* p1æ‰€æŒ‡å‘çš„intå˜é‡å€¼ä¸å¯æ”¹å˜ï¼Œä¸ºå¸¸é‡ï¼Œä½†å¯ä»¥æ”¹å˜p1æŒ‡é’ˆçš„å€¼ */ int * const p2; /* p2æŒ‡é’ˆä¸ºå¸¸é‡ï¼Œå³p2çš„å€¼ä¸å¯æ”¹å˜ï¼Œä½†å¯ä»¥æ”¹å˜p2æŒ‡å‘å¯¹è±¡çš„å€¼ */ const int * const p3; /* p3æŒ‡é’ˆæ˜¯å¸¸é‡ï¼ŒåŒæ—¶p3æ‰€æŒ‡å‘intå¯¹è±¡çš„å€¼ä¹Ÿæ˜¯å¸¸é‡ */ å•°å•°å—¦å—¦è¯´è¿™ä¹ˆé•¿ä¸€ä¸ªä¾‹å­ï¼Œå…¶å®å¾ˆç®€å•çš„é“ç†ï¼Œå°±æ˜¯ä¸ºäº†å¥½ç©ï¼Œå¥½è®°ã€‚å…ˆå®è§‚çš„è¯´ä¸€ä¸‹constå¸¸é‡çš„å®ç°æœºåˆ¶ï¼Œä¸‹é¢è¯´ä¸€äº›å…·ä½“çš„å®ç°ã€‚\nå…¶å®å¥³ç¥¨æå‡ºçš„é—®é¢˜ä¸ç®—éš¾ï¼Œæ˜¯C++è¯­è¨€çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯ä¸€ä¸ªå¸¸é‡æŠ˜å ã€‚\nå…ˆè¯´ä¸€ä¸ªé”™è¯¯çš„ç†è§£ï¼ˆä¸ºä»€ä¹ˆè¦è¯´ä¸€ä¸ªé”™è¯¯çš„ç†è§£ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºæ­£ç¡®çš„ç†è§£ï¼Œå“ˆå“ˆï¼‰ï¼šå¯æŠ˜å çš„å¸¸é‡å°±åƒå®ä¸€æ ·ï¼Œåœ¨é¢„ç¼–è¯‘é˜¶æ®µå¯¹constå¸¸é‡çš„å¼•ç”¨ä¸€å¾‹è¢«æ›¿æ¢ä¸ºå¸¸é‡æ‰€å¯¹åº”çš„å€¼ã€‚å°±å’Œæ™®é€šçš„å®æ›¿æ¢æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¸ä¼šä¸ºè¯¥å¸¸é‡åˆ†é…å­˜å‚¨ç©ºé—´ã€‚\nçœ‹æ¸…æ¥šäº†ï¼Œä¸Šé¢è¯´çš„æ˜¯ä¸€ä¸ªé”™è¯¯çš„ç†è§£ï¼Œå¸¸é‡æŠ˜å ç¡®å®ä¼šåƒå®æ›¿æ¢ä¸€æ ·æŠŠå¯¹å¸¸é‡çš„å¼•ç”¨æ›¿æ¢ä¸ºå¸¸é‡å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯è¯¥å¸¸é‡æ˜¯åˆ†é…ç©ºé—´çš„ï¼Œå¹¶ä¸”é ç¼–è¯‘å™¨æ¥æ£€æŸ¥å¸¸é‡å±æ€§ã€‚\n#define PI 3.14 int main() { const int r = 10; int p = PI;//è¿™é‡Œåœ¨é¢„ç¼–è¯‘é˜¶æ®µäº§ç”Ÿå®æ›¿æ¢ï¼ŒPIç›´æ¥æ›¿æ¢ä¸º3.14ï¼Œå…¶å®å°±æ˜¯int p = 3.14 int len = 2 * r;//è¿™é‡Œä¼šå‘ç”Ÿå¸¸é‡æŠ˜å ï¼Œä¹Ÿå°±æ˜¯è¯´å¸¸é‡rçš„å¼•ç”¨ä¼šæ›¿æ¢æˆå®ƒå¯¹åº”çš„å€¼ï¼Œç›¸å½“äºint len = 2 * 10; return 0; } å¦‚ä¸Šè¿°ä»£ç ä¸­æ‰€è¿°ï¼Œå¸¸é‡æŠ˜å è¡¨é¢ä¸Šçš„æ•ˆæœå’Œå®æ›¿æ¢æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ï¼Œâ€œæ•ˆæœä¸Šæ˜¯ä¸€æ ·çš„â€ï¼Œè€Œä¸¤è€…çœŸæ­£çš„åŒºåˆ«åœ¨äºï¼Œå®æ˜¯å­—ç¬¦å¸¸é‡ï¼Œåœ¨é¢„ç¼–è¯‘é˜¶æ®µçš„å®æ›¿æ¢å®Œæˆåï¼Œè¯¥å®åå­—ä¼šæ¶ˆå¤±ï¼Œæ‰€æœ‰å¯¹å®å¦‚PIçš„å¼•ç”¨å·²ç»å…¨éƒ¨è¢«æ›¿æ¢ä¸ºå®ƒæ‰€å¯¹åº”çš„å€¼ï¼Œç¼–è¯‘å™¨å½“ç„¶æ²¡æœ‰å¿…è¦å†ç»´æŠ¤è¿™ä¸ªç¬¦å·ã€‚è€Œå¸¸é‡æŠ˜å å‘ç”Ÿçš„æƒ…å†µæ˜¯ï¼Œå¯¹å¸¸é‡çš„å¼•ç”¨å…¨éƒ¨æ›¿æ¢ä¸ºè¯¥å¸¸é‡å¦‚rçš„å€¼ï¼Œä½†æ˜¯ï¼Œå¸¸é‡årå¹¶ä¸ä¼šæ¶ˆå¤±ï¼Œç¼–è¯‘å™¨ä¼šæŠŠä»–æ”¾å…¥åˆ°ç¬¦å·è¡¨ä¸­ï¼ŒåŒæ—¶ï¼Œä¼šä¸ºè¯¥å˜é‡åˆ†é…ç©ºé—´ï¼Œæ ˆç©ºé—´æˆ–è€…å…¨å±€ç©ºé—´ã€‚æ—¢ç„¶æ”¾åˆ°äº†ç¬¦å·è¡¨ä¸­ï¼Œå°±æ„å‘³ç€å¯ä»¥æ‰¾åˆ°è¿™ä¸ªå˜é‡çš„åœ°å€ï¼ˆåŸ‹ä¸€ä¸ªä¼ç¬”å…ˆï¼‰ã€‚\nç¬¦å·è¡¨ä¸æ˜¯ä¸€å¼ è¡¨ï¼Œæ˜¯ä¸€ç³»åˆ—è¡¨çš„ç»Ÿç§°ï¼Œè¿™é‡Œçš„constå¸¸é‡ï¼Œä¼šæŠŠè¿™ä¸ªå¸¸é‡çš„åå­—ã€ç±»å‹ã€å†…å­˜åœ°å€ã€å€¼éƒ½æ”¾åˆ°å¸¸é‡è¡¨ä¸­ã€‚ç¬¦å·è¡¨è¿˜æœ‰ä¸€ä¸ªå˜é‡è¡¨ï¼Œè¿™ä¸ªè¡¨æ”¾å˜é‡çš„åå­—ã€ç±»å‹ã€å†…å­˜åœ°å€ï¼Œä½†æ˜¯æ²¡æœ‰æ”¾å˜é‡çš„å€¼ã€‚\nä¸ºäº†æ›´èƒ½ä½“ç°å‡ºå¸¸é‡æŠ˜å ï¼Œçœ‹ä¸‹é¢çš„å¯¹æ¯”å®éªŒï¼š\nint main() { int i0 = 11; const int i = 0; //å®šä¹‰å¸¸é‡i int *j = (int *) \u0026amp;i; //çœ‹åˆ°è¿™é‡Œèƒ½å¯¹iè¿›è¡Œå–å€¼ï¼Œåˆ¤æ–­iå¿…ç„¶åè‡ªå·±çš„å†…å­˜ç©ºé—´ *j = 1; //å¯¹jæŒ‡å‘çš„å†…å­˜è¿›è¡Œä¿®æ”¹ printf(\u0026#34;0x%p\\n0x%p\\n%d\\n%d\\n\u0026#34;,\u0026amp;i,j,i,*j); //è§‚çœ‹å®éªŒæ•ˆæœ const int ck = 9; //è¿™ä¸ªå¯¹ç…§å®éªŒæ˜¯ä¸ºäº†è§‚å¯Ÿï¼Œå¯¹å¸¸é‡ckçš„å¼•ç”¨æ—¶ï¼Œä¼šäº§ç”Ÿçš„æ•ˆæœ int ik = ck; int i1 = 5; //è¿™ä¸ªå¯¹ç…§å®éªŒæ˜¯ä¸ºäº†åŒºåˆ«ï¼Œå¯¹å¸¸é‡å’Œå˜é‡çš„å¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ« int i2 = i1; return 0; } ä¸‹é¢çœ‹ä¸€ä¸‹ä¸åŒç¼–è¯‘å™¨çš„è¾“å‡ºç»“æœ\nvc6.0ï¼š\nvs2010ï¼š\ng++çš„è¾“å‡ºç»“æœï¼š\næ³¨æ„ï¼šå¯¹äºLinuxçš„GUNä¸­çš„gccæ˜¯ç”¨æ¥ç¼–è¯‘.cæ–‡ä»¶çš„Cè¯­è¨€ç¼–è¯‘å™¨ï¼Œg++æ˜¯ç”¨æ¥ç¼–è¯‘.cppçš„C++è¯­è¨€ç¼–è¯‘å™¨ã€‚\næˆ‘ä»¬è¿™é‡Œè®²çš„æ˜¯C++çš„å•†é‡æŠ˜å ï¼Œæ‰€ä»¥æºæ–‡ä»¶è¦æ˜¯.cppçš„æ‰å¯ä»¥ã€‚ï¼ˆCè¯­è¨€çš„constå¸¸é‡æœ€åå†è¯´ï¼‰\nä¸Šé¢çš„ç¨‹åºçš„è¿è¡Œç»“æœè‡³å°‘è¯´æ˜ä¸¤ç‚¹ï¼š\nï¼ˆ1ï¼‰iå’Œjåœ°å€ç›¸åŒï¼ŒæŒ‡å‘åŒä¸€å—ç©ºé—´ï¼Œiè™½ç„¶æ˜¯å¯æŠ˜å å¸¸é‡ï¼Œä½†æ˜¯ï¼Œiç¡®å®æœ‰è‡ªå·±çš„ç©ºé—´\nï¼ˆ2ï¼‰iå’ŒjæŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œä½†æ˜¯*j = 1å¯¹å†…å­˜è¿›è¡Œä¿®æ”¹åï¼ŒæŒ‰é“ç†æ¥è¯´ï¼Œ*j==1,iä¹Ÿåº”è¯¥ç­‰äº1ï¼Œè€Œå®éªŒç»“æœç¡®å®iå®å®åœ¨åœ¨çš„ç­‰äº0ã€‚\nè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯æœ¬æ–‡æ‰€è¯´çš„å†…å®¹ï¼Œiæ˜¯å¯æŠ˜å å¸¸é‡ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå¯¹içš„å¼•ç”¨å·²ç»åˆ«æ›¿æ¢ä¸ºiçš„å€¼äº†ï¼ŒåŒæ—¶ä¸åŒäºå®æ›¿æ¢çš„æ˜¯ï¼Œè¿™ä¸ªiè¿˜è¢«å­˜åˆ°äº†å¸¸é‡è¡¨ä¸­ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼š\nprintf(\u0026#34;0x%p\\n0x%p\\n%d\\n%d\\n\u0026#34;,\u0026amp;i,j,i,*j); ä¸­çš„iåœ¨é¢„å¤„ç†é˜¶æ®µå·²ç»è¢«æ›¿æ¢ï¼Œå…¶å®å·²ç»è¢«æ”¹ä¸ºï¼š\nprintf(\u0026#34;0x%p\\n0x%p\\n%d\\n%d\\n\u0026#34;,\u0026amp;i,j,0,*j); åŒæ—¶åœ¨å¸¸é‡è¡¨ä¸­ä¹Ÿæœ‰iè¿™ä¸ªå˜é‡ï¼Œä¸ç„¶çš„è¯å¯¹iå–åœ°å€æ˜¯ä¸åˆæ³•çš„ï¼Œè¿™æ˜¯å’Œå®æ›¿æ¢çš„ä¸åŒç‚¹ï¼Œå®æ›¿æ¢æ˜¯ä¸ä¼šæŠŠå®åç§°æ”¾åˆ°å¸¸é‡è¡¨ä¸­çš„ï¼Œé¢„ç¼–è¯‘å®Œå°±ç”¨ä¸åˆ°äº†ã€‚\nä¸ºäº†æ›´åŠ ç›´è§‚ï¼Œä¸‹é¢ç›´æ¥ä¸Šè¿™ä¸ªç¨‹åºçš„åç¼–è¯‘çš„æ±‡ç¼–è¯­è¨€ï¼š\nï¼ˆ1ï¼‰æ–¹æ³•ï¼šæ‰“ä¸ªæ–­ç‚¹è°ƒè¯•-\u0026gt;çª—å£åæ±‡ç¼–ï¼ˆè¿˜æœ‰å¥½å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚å†…å­˜å¤šçº¿ç¨‹ç­‰ï¼‰\nï¼ˆ2ï¼‰åæ±‡ç¼–ä»£ç ï¼š\n--- d:\\cv_projects\\commontest\\commontest\\commontest.cpp ------------------------ #include \u0026lt;stdio.h\u0026gt; int main() { 01311380 push ebp 01311381 mov ebp,esp 01311383 sub esp,114h 01311389 push ebx 0131138A push esi 0131138B push edi 0131138C lea edi,[ebp-114h] 01311392 mov ecx,45h 01311397 mov eax,0CCCCCCCCh 0131139C rep stos dword ptr es:[edi] int i0 = 11; 0131139E mov dword ptr [i0],0Bh const int i = 0; //å®šä¹‰å¸¸é‡i 013113A5 mov dword ptr [i],0 //ç¼–è¯‘å™¨ç¡®å®ä¸ºå¸¸é‡iåˆ†é…äº†æ ˆç©ºé—´ï¼Œå¹¶èµ‹å€¼ä¸º0 int *j = (int *) \u0026amp;i; //çœ‹åˆ°è¿™é‡Œèƒ½å¯¹iè¿›è¡Œå–å€¼ï¼Œåˆ¤æ–­iå¿…ç„¶åè‡ªå·±çš„å†…å­˜ç©ºé—´ 013113AC lea eax,[i] 013113AF mov dword ptr [j],eax *j = 1; //å¯¹jæŒ‡å‘çš„å†…å­˜è¿›è¡Œä¿®æ”¹ 013113B2 mov eax,dword ptr [j] 013113B5 mov dword ptr [eax],1 printf(\u0026#34;0x%p\\n0x%p\\n%d\\n%d\\n\u0026#34;,\u0026amp;i,j,i,*j); //è§‚çœ‹å®éªŒæ•ˆæœ 013113BB mov esi,esp 013113BD mov eax,dword ptr [j] 013113C0 mov ecx,dword ptr [eax] 013113C2 push ecx 013113C3 push 0 013113C5 mov edx,dword ptr [j] 013113C8 push edx 013113C9 lea eax,[i] 013113CC push eax 013113CD push offset string \u0026#34;0x%p\\n0x%p\\n%d\\n%d\\n\u0026#34; (131573Ch) 013113D2 call dword ptr [__imp__printf (13182B0h)] 013113D8 add esp,14h 013113DB cmp esi,esp 013113DD call @ILT+295(__RTC_CheckEsp) (131112Ch) const int ck = 9; //è¿™ä¸ªå¯¹ç…§å®éªŒæ˜¯ä¸ºäº†è§‚å¯Ÿï¼Œå¯¹å¸¸é‡ckçš„å¼•ç”¨æ—¶ï¼Œä¼šäº§ç”Ÿçš„æ•ˆæœ 013113E2 mov dword ptr [ck],9 //ä¸ºå¸¸é‡åˆ†é…æ ˆç©ºé—´ï¼Œè¿™æ˜¯ç¬¦å·è¡¨ä¸­å·²ç»æœ‰äº†è¿™ä¸ªå˜é‡ int ik = ck; 013113E9 mov dword ptr [ik],9 //çœ‹åˆ°å¦ï¼Œå¯¹å¸¸é‡ckçš„å¼•ç”¨ï¼Œä¼šç›´æ¥æ›¿æ¢ä¸ºå¸¸é‡çš„å€¼9ï¼Œè¿™ç§æ›¿æ¢å¾ˆç±»ä¼¼äºå®æ›¿æ¢ï¼Œå†çœ‹ä¸‹é¢çš„å®éªŒ int i1 = 5; //è¿™ä¸ªå¯¹ç…§å®éªŒæ˜¯ä¸ºäº†åŒºåˆ«ï¼Œå¯¹å¸¸é‡å’Œå˜é‡çš„å¼•ç”¨æœ‰ä»€ä¹ˆåŒºåˆ« 013113F0 mov dword ptr [i1],5 int i2 = i1; //è¿™é‡Œå¼•ç”¨å˜é‡i1ï¼Œå¯¹i2è¿›è¡Œèµ‹å€¼ï¼Œç„¶åçœ‹åˆ°å¦ï¼Œå¯¹å¸¸é‡i1å¼•ç”¨æ²¡æœ‰æ›¿æ¢æˆi1çš„å€¼ï¼Œè€Œæ˜¯å»æ ˆä¸­å…ˆå–å‡ºi1çš„å€¼ï¼Œåˆ°edxå¯„å­˜å™¨ä¸­ï¼Œç„¶åå†æŠŠå€¼movåˆ°i2æ‰€åœ¨çš„å†…å­˜ä¸­ 013113F7 mov eax,dword ptr [i1] 013113FA mov dword ptr [i2],eax return 0; 013113FD xor eax,eax } é€šè¿‡ä¸Šè¿°å®éªŒçš„åˆ†æå¯ä»¥å®¹æ˜“çœ‹å‡ºï¼Œå¯¹å¯æŠ˜å çš„å¸¸é‡çš„å¼•ç”¨ä¼šè¢«æ›¿æ¢ä¸ºè¯¥å¸¸é‡çš„å€¼ï¼Œè€Œå¯¹å˜é‡çš„å¼•ç”¨å°±éœ€è¦è®¿é—®å˜é‡çš„å†…å­˜ã€‚\næ€»ç»“ï¼šå¸¸é‡æŠ˜å è¯´çš„æ˜¯ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œå¯¹è¯¥å˜é‡è¿›è¡Œå€¼æ›¿æ¢ï¼ŒåŒæ—¶ï¼Œè¯¥å¸¸é‡æ‹¥æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œå¹¶éåƒå®å®šä¹‰ä¸€æ ·ä¸åˆ†é…ç©ºé—´ï¼Œéœ€æ¾„æ¸…è¿™ç‚¹\nå‰é¢è¯´äº†ä¸ªä¸è®¸ç”¨gccç¼–è¯‘.cçš„Cè¯­è¨€çš„ç¨‹åºï¼Œä¸ç„¶å°±æ²¡æœ‰äº†å¸¸é‡æŠ˜å çš„é—®é¢˜ï¼Œå…ˆçœ‹ä¸€ä¸‹æ‰§è¡Œçš„ç»“æœï¼š\næœ€åè¯´ä¸€ä¸‹gccç¼–è¯‘çš„Cè¯­è¨€çš„constå¸¸é‡ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰åšå¸¸é‡æŠ˜å çš„è¿™ç§ä¼˜åŒ–ï¼Œç±»ä¼¼äºconstå¸¸é‡å‰é¢åŠ ä¸Švolatileè¿™ä¸ªå…³é”®å­—ã€‚å…·ä½“æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿä¸‹ä¸€ç¯‡åšå®¢å†è¯´ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/06/cpp-constant-folding/","summary":"è½¬è‡ªï¼šhttps://www.cnblogs.com/stemon/p/4406824.html å‰å‡ å¤©å¥³ç¥¨é—®äº†æˆ‘ä¸€ä¸ªé˜¿é‡Œçš„é¢è¯•é¢˜ï¼Œæ˜¯æœ‰å…³C++è¯­è¨€çš„constå¸¸é‡çš„ï¼Œå…¶å®å¥¹ä¸€æå‡ºæ¥æˆ‘å°±çŸ¥é“è€ƒå¯Ÿçš„ç‚¹äº†ï¼šè‚¯å®šæ˜¯constå¸¸é‡çš„å†…å­˜ä¸æ˜¯åˆ†é…åœ¨read-onlyçš„å­˜å‚¨åŒºçš„ï¼Œconstå¸¸é‡","title":"C++å­¦ä¹ è®°å½•(9) å¸¸é‡æŠ˜å "},{"content":"0. åŸæ–™ windowsç³»ç»Ÿçš„ä¸»æœº mosquittoè½¯ä»¶ 1. ä¸‹è½½å’Œå®‰è£…mosquitto mosquittoå¯ä»¥è‡ªå·±åˆ°GitHubä¸Šä¸‹è½½æºç æ ¹æ®è‡ªå·±å®é™…éœ€æ±‚è¿›è¡Œç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œç›´æ¥ç”¨çš„å®˜æ–¹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\nåˆ°http://mosquitto.org/files/binary/ä¸‹è½½å¯¹åº”windowsç‰ˆæœ¬çš„mqttæœåŠ¡ç«¯è½¯ä»¶ã€‚\næˆ‘ä¸‹è½½äº†è¿™ä¸€ç‰ˆã€‚\n2. é…ç½®mosquitto åªéœ€è¦é…ç½®mosquitto.confæ–‡ä»¶ã€‚\næ ¹æ®æˆ‘çš„å®é™…éœ€æ±‚ï¼Œè¦å¼€å¯åŒ¿åç™»å½•å’Œè¿œç¨‹è®¿é—®ã€‚\n2.1 å¼€å¯åŒ¿åè®¿é—® åœ¨é…ç½®æ–‡ä»¶ä¸­æœç´¢allow_anonymousï¼Œå»æ‰è¯¥è¡Œå‰è¾¹çš„#ï¼Œå°†falseæ”¹æˆtrueã€‚\n2.2 å¼€å¯ç›‘å¬å’Œè¿œç¨‹è®¿é—® åœ¨é…ç½®æ–‡ä»¶ä¸­æœç´¢listener port-numberï¼Œæ ¹æ®æç¤º# listener port-number [ip address/host name/unix socket path]ä¿®æ”¹ã€‚\næ·»åŠ ä¸€è¡Œport 1883ï¼Œåœ¨1883ç«¯å£ä½¿ç”¨mqttåè®®ã€‚\nå¦‚æœè¿˜è¦å¼€å¯websocketsè®¿é—®æ–¹å¼ï¼Œéœ€è¦å†æ·»åŠ ä¸¤è¡Œä»£ç \nlistener 1884\nprotocol websockets\nç”¨1884æœåŠ¡äºwebsocketsåè®®\næ³¨ï¼šæˆ‘æœ€å¼€å§‹å®‰è£…çš„ç‰ˆæœ¬æ˜¯2.0.0ï¼Œå¼€å¯wsåä¼šå¼‚å¸¸ï¼Œç”¨1883ç«¯å£æ—¶ï¼Œ1884ç«¯å£ä¼šæ–­ï¼Œç”¨1884ç«¯å£æ—¶ï¼Œ1883ç«¯å£ä¼šæ–­ï¼Œæ‰€ä»¥æ¢åˆ°äº†æ—§ç‰ˆæœ¬ï¼ˆ1.6.10ï¼‰ 3. è¿è¡Œmqtt åœ¨mosquittoçš„å®‰è£…ç›®å½•ä¸‹æ‰§è¡Œmosquitto.exe -c mosquitto.confï¼Œæ‰§è¡Œä¿®æ”¹åé…ç½®æ–‡ä»¶ã€‚\n4. æµ‹è¯•MQTT ä½¿ç”¨MQTT.fxè¿›è¡Œæµ‹è¯•ã€‚\n5. å¼€æœºè‡ªå¯ ä¸Šè¾¹è¿è¡Œmqttç¨‹åºæ˜¯é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨æ‰§è¡Œï¼Œæ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æœåŠ¡è‡ªå¯ã€‚\næ‰“å¼€æœåŠ¡ï¼š\nä¿®æ”¹æœåŠ¡çš„å±æ€§ï¼š\nå°†å¯åŠ¨ç±»å‹ä¿®æ”¹ä¸ºè‡ªåŠ¨ å¯åŠ¨å‚æ•°å¡«å†™-c mosquitto.confï¼Œç›®çš„æ˜¯åœ¨å¯åŠ¨æ—¶åŠ è½½åˆšåˆšä¿®æ”¹çš„é‚£ä¸ªé…ç½®æ–‡ä»¶ã€‚ï¼ˆä¸å¡«å†™ä¹Ÿè¡Œï¼Œå¥½åƒé»˜è®¤ä¹Ÿå¯ä»¥æ‰¾å¾—åˆ°é‚£ä¸ªæ–‡ä»¶ï¼Ÿï¼‰ 6. æ³¨æ„äº‹é¡¹ åœ¨é˜¿é‡Œäº‘ç­‰æœåŠ¡å™¨ä¸Šæ­å»ºçš„æ—¶å€™ï¼Œå¤–ç½‘æƒ³è¦è®¿é—®mqttï¼Œéœ€è¦åœ¨æœåŠ¡å™¨çš„å®‰å…¨ç»„ä¸­å¼€å¯TCPåè®®çš„1883ç«¯å£è®¿é—®æƒé™ï¼Œå¦åˆ™è®¿é—®ä¸äº†ã€‚ æ–°æ—§ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶ç•¥æœ‰ä¸åŒï¼Œå‚è€ƒconfæ–‡ä»¶ä¸­çš„è¯´æ˜é…ç½®å°±å¥½ã€‚ ","permalink":"https://Clay-Hex.github.io/posts/2021/04/windows-mqtt-server-mosquitto/","summary":"0. åŸæ–™ windowsç³»ç»Ÿçš„ä¸»æœº mosquittoè½¯ä»¶ 1. ä¸‹è½½å’Œå®‰è£…mosquitto mosquittoå¯ä»¥è‡ªå·±åˆ°GitHubä¸Šä¸‹è½½æºç æ ¹æ®è‡ªå·±å®é™…éœ€æ±‚è¿›è¡Œç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œç›´æ¥ç”¨çš„å®˜æ–¹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ åˆ°http://mosquitto.org/files/","title":"Windowsç¯å¢ƒä¸‹é…ç½®MQTTæœåŠ¡å™¨(mosquitto)"},{"content":"0. æ¨¡æ¿ C++ä¸­é™¤äº†æœ‰é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œè¿˜æœ‰æ³›å‹ç¼–ç¨‹çš„æ€æƒ³ï¼Œæ³›å‹ç¼–ç¨‹åˆ©ç”¨çš„ä¸»è¦æŠ€æœ¯å°±æ˜¯æ¨¡æ¿ã€‚\nC++ä¸­ä¸¤ç§æ¨¡æ¿ï¼šå‡½æ•°æ¨¡æ¿ã€ç±»æ¨¡æ¿\nè¯­æ³•ï¼š\ntemplate\u0026lt;typename T\u0026gt; å‡½æ•°å£°æ˜æˆ–å®šä¹‰ å«ä¹‰ï¼š\ntemplate å›ºå®šçš„ï¼Œå£°æ˜åˆ›å»ºæ¨¡æ¿ typename è¡¨æ˜åè¾¹çš„Tæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥ç”¨classä»£æ›¿ T ç±»ä¼¼å½¢å‚ï¼Œä»»æ„çš„åˆæ³•å­—ç¬¦éƒ½å¯ä»¥ï¼Œä¹ æƒ¯ä¸Šç”¨ T æ¨¡æ¿æœ‰ä¸¤ç§ç±»å‹æ¨å¯¼çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼ï¼Œå¦å¤–ä¸€ç§æ˜¯ç¨‹åºçŒ¿æ‰‹åŠ¨æŒ‡å®šï¼š\n#include \u0026lt;iostream\u0026gt; using namespace std; template\u0026lt;typename T\u0026gt; void func(T \u0026amp;a, T \u0026amp;b){\tT s = a; a = b; b = s; } int main(){ int a = 10, s = 9; // func(a, s); // è‡ªåŠ¨ç±»å‹æ¨å¯¼ // func\u0026lt;int\u0026gt;(a, s); // æŒ‡å®šç±»å‹æ¨å¯¼ cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; s \u0026lt;\u0026lt; endl; return 0; } 1. å‡½æ•°æ¨¡æ¿æ³¨æ„äº‹é¡¹ è‡ªåŠ¨ç±»å‹æ¨å¯¼ï¼Œå¿…é¡»æ¨å¯¼å‡ºä¸€è‡´çš„æ•°æ®ç±»å‹æ‰å¯ä»¥ä½¿ç”¨ã€‚ æ¨¡æ¿å¿…é¡»è¦ç¡®å®š T çš„æ•°æ®ç±»å‹ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚ eg:äºŒåˆ†æ’åºçš„æ¨¡æ¿å®ç°\ntemplate\u0026lt;typename T\u0026gt; void mySort(T a[], int len, int l, int r){\t// quickSort if(l \u0026gt;= r) return ; int x = a[(l + r) / 2]; int i = l - 1, j = r + 1; while(i \u0026lt; j){ while(a[++i] \u0026lt; x); while(a[--j] \u0026gt; x); if(i \u0026lt; j) swap(a[i], a[j]); } mySort(a, len, l, j); mySort(a, len, j + 1, r);\t} 2. æ™®é€šå‡½æ•°ä¸å‡½æ•°æ¨¡æ¿å¯¹æ¯” 2.1 åŒºåˆ« æ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œå‚æ•°å¯ä»¥å‘ç”Ÿè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆéšå¼è½¬æ¢ï¼‰ å‡½æ•°æ¨¡æ¿ï¼Œåœ¨è‡ªåŠ¨ç±»å‹æ¨å¯¼å½¢å¼ä¸‹ï¼Œä¸ä¼šè‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚ å‡½æ•°æ¨¡æ¿ï¼Œåœ¨æŒ‡å®šç±»å‹å½¢å¼ä¸‹ï¼Œä¼šå‘ç”Ÿè‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚ 2.2 è°ƒç”¨è§„åˆ™ å¦‚æœæ™®é€šå‡½æ•°å’Œå‡½æ•°æ¨¡æ¿åŒæ—¶å­˜åœ¨ï¼Œåˆ™ä¼šè°ƒç”¨æ™®é€šå‡½æ•°ï¼Œå¦‚æœæ™®é€šå‡½æ•°åªæœ‰å£°æ˜ï¼Œæ²¡æœ‰å®ç°ï¼Œé‚£ä¹Ÿä¸ä¼šå»è°ƒç”¨å‡½æ•°æ¨¡æ¿ï¼Œä¼šç›´æ¥æŠ¥é”™ å¯ä»¥ç”¨è¿‡ç©ºæ¨¡æ¿å‚æ•°åˆ—è¡¨ï¼Œå¼ºåˆ¶è°ƒç”¨å‡½æ•°æ¨¡æ¿ å‡½æ•°æ¨¡æ¿ä¹Ÿå¯ä»¥é‡è½½ å¦‚æœå‡½æ•°æ¨¡æ¿å¯ä»¥æ›´å¥½çš„åŒ¹é…è°ƒç”¨ï¼Œä¼šä¼˜å…ˆè°ƒç”¨å‡½æ•°æ¨¡æ¿ #include \u0026lt;iostream\u0026gt; using namespace std; void fuc(int a, int b){ cout \u0026lt;\u0026lt; \u0026#34;æ™®é€š\u0026#34; \u0026lt;\u0026lt; endl; } template\u0026lt;class T\u0026gt; void fuc(T a, T b){ cout \u0026lt;\u0026lt; \u0026#34;æ¨¡æ¿\u0026#34; \u0026lt;\u0026lt; endl; } template\u0026lt;class T\u0026gt; // é‡è½½å‡½æ•°æ¨¡æ¿ void fuc(T a, T b, T c){ cout \u0026lt;\u0026lt; \u0026#34;æ¨¡æ¿ é‡è½½\u0026#34; \u0026lt;\u0026lt; endl; } void test(){ int a = 1; int b = 2; fuc(a, b); // è°ƒç”¨æ™®é€šå‡½æ•° fuc\u0026lt;\u0026gt;(a, b); // ç©ºæ¨¡æ¿å‚æ•°åˆ—è¡¨ï¼Œè°ƒç”¨å‡½æ•°æ¨¡æ¿ fuc\u0026lt;\u0026gt;(a, b, 1); // æ¨¡æ¿ é‡è½½ char c1 = \u0026#39;a\u0026#39;; char c2 = \u0026#39;s\u0026#39;; fuc(c1, c2); // ä¼ å…¥charå‹ï¼Œæ™®é€šå‡½æ•°éœ€è¦åšè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œè€Œå‡½æ•°æ¨¡æ¿ä¸éœ€è¦è½¬æ¢ï¼Œæ‰€ä»¥ä¼˜å…ˆè°ƒç”¨å‡½æ•°æ¨¡æ¿ã€‚ } int main(){ test(); return 0; } 3. æ¨¡æ¿çš„å±€é™æ€§ æ¯”å¦‚æ¨¡æ¿æ˜¯ä¸€ä¸ªèµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆä¼ å…¥çš„æ˜¯æ•°ç»„çš„è¯ï¼Œå°±ä¸æ­£ç¡®äº†ã€‚\nå†æ¯”å¦‚ï¼Œæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å¤§å°å…³ç³»ï¼Œç±»å‹ä¸ç¡®å®šï¼Œæ¯”è¾ƒæ–¹å¼ä¹Ÿä¸ç¡®å®šã€‚\nä¸ºäº†è§£å†³ä¸Šè¾¹é—®é¢˜ï¼ŒC++æä¾›äº†æ¨¡æ¿çš„é‡è½½ï¼Œå¯ä»¥ä¸ºç‰¹å®šçš„ç±»å‹æä¾›å…·ä½“åŒ–çš„æ¨¡æ¿ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨é‡è½½ç‰¹å®šç±»å‹çš„è¿ç®—ç¬¦ï¼‰\nè¯­æ³•ï¼š\ntemplate\u0026lt;class T\u0026gt; void fuc(T a, T b){ cout \u0026lt;\u0026lt; \u0026#34;åŸæ¨¡æ¿\u0026#34; \u0026lt;\u0026lt; endl; } // testæ˜¯è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ // è¿™é‡Œå°†å‡½æ•°æ¨¡æ¿ä¸ºtestæ•°æ®ç±»å‹å…·ä½“åŒ–ï¼Œå¦‚æœä¼ å…¥æ˜¯testç±»å‹çš„è¯ï¼Œä¼˜å…ˆè°ƒç”¨å…·ä½“åŒ–çš„æ¨¡æ¿ template\u0026lt;\u0026gt; void fuc(test a, test b){ // ... code } 4. ç±»æ¨¡æ¿ ä½œç”¨ï¼šå»ºç«‹ä¸€ä¸ªé€šç”¨ç±»ï¼Œç±»çš„æˆå‘˜çš„æ•°æ®ç±»å‹å¯ä»¥ä¸æŒ‡å®šï¼Œç”¨ä¸€ä¸ªè™šæ‹Ÿçš„ç±»å‹æ¥ä»£è¡¨ã€‚\nè¯­æ³•ï¼šå’Œå‡½æ•°æ¨¡æ¿ä¸€æ ·\ntemplate\u0026lt;typename T\u0026gt; ç±» ä¾‹ç¨‹ï¼š\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; using namespace std; template\u0026lt;class nameType, class ageType\u0026gt; class Person{ public: Person(nameType name, ageType age) : m_name(name), m_age(age){ }; void print(){ cout \u0026lt;\u0026lt; m_name \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; m_age \u0026lt;\u0026lt; endl; } string m_name; int m_age; }; int main(){ Person\u0026lt;string, int\u0026gt; a(\u0026#34;å¼ ä¸‰\u0026#34;, 18); a.print(); return 0; } 5. ç±»æ¨¡æ¿ä¸å‡½æ•°æ¨¡æ¿åŒºåˆ« ç±»æ¨¡æ¿æ²¡æœ‰è‡ªåŠ¨ç±»å‹æ¨å¯¼ï¼Œå¿…é¡»æŒ‡å®šç±»å‹ã€‚ ç±»æ¨¡æ¿åœ¨å‚æ•°åˆ—è¡¨ä¸­ï¼Œå¯ä»¥æœ‰é»˜è®¤å‚æ•°ï¼Œåœ¨C++11æ ‡å‡†ä»¥åï¼Œå‡½æ•°æ¨¡æ¿ä¹Ÿå¯ä»¥æœ‰é»˜è®¤å‚æ•°äº†ã€‚ ä¸Šè¾¹çš„ä»£ç å¯ä»¥æ”¹æˆè¿™ï¼š\ntemplate\u0026lt;class nameType = string, class ageType = int\u0026gt; 6. ç±»æ¨¡æ¿ä¸­æˆå‘˜å‡½æ•°åˆ›å»ºçš„æ—¶æœº ç±»æ¨¡æ¿ä¸­çš„æˆå‘˜å‡½æ•°ä¸æ™®é€šç±»çš„æˆå‘˜å‡½æ•°åˆ›å»ºæ—¶æœºæœ‰æ‰€åŒºåˆ«ï¼š\næ™®é€šç±»çš„æˆå‘˜å‡½æ•°ä¸€å¼€å§‹å°±å¯ä»¥åˆ›å»ºã€‚ ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°åœ¨è°ƒç”¨æ—¶æ‰åˆ›å»ºã€‚ ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°åœ¨è°ƒç”¨æ—¶æ‰åˆ›å»ºçš„åŸå› å¦‚ä¸‹ï¼š\nå› ä¸ºç±»ä¸­çš„æŸäº›ç±»å‹å¹¶ä¸ç¡®å®šï¼Œä¼ å…¥çš„ç±»å‹åˆ°åº•èƒ½ä¸èƒ½æ‰§è¡Œæˆå‘˜å‡½æ•°ä¸­çš„åŠ¨ä½œä¹Ÿä¸çŸ¥é“ï¼Œæ‰€ä»¥ä¸èƒ½æå‰åˆ›å»ºã€‚\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; using namespace std; class Person1{ public: void f1(){ cout \u0026lt;\u0026lt; \u0026#34;f1\u0026#34; \u0026lt;\u0026lt; endl; } }; class Person2{ public: void f2(){ cout \u0026lt;\u0026lt; \u0026#34;f2\u0026#34; \u0026lt;\u0026lt; endl; } }; template\u0026lt;class T\u0026gt; class tt{ public: T obj; void f1(){ obj.f1(); } void f2(){ obj.f2(); } }; int main(){ tt\u0026lt;Person1\u0026gt; s; s.f1(); // åˆæ³• s.f2();\t// ä¸åˆæ³• å› ä¸ºç±»æ¨¡æ¿æŒ‡å®šçš„ç±»å‹æ˜¯Person1ï¼Œè€Œè¯¥ç±»å‹æ²¡æœ‰f2çš„æ–¹æ³•ã€‚ return 0; } 7. ç±»æ¨¡æ¿å®ä¾‹åŒ–çš„å¯¹è±¡ åš å‡½æ•°å‚æ•° å‡½æ•°å‚æ•°æœ‰ä¸‰ç§ç±»å‹è¿›è¡Œæ¥æ”¶ï¼š\næŒ‡å®šç±»å‹ ï¼š å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œç›´æ¥å°†è¯¥ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•° æŠŠç±»æ¨¡æ¿çš„å‚æ•° æ¨¡æ¿åŒ–ï¼š å°†å¯¹è±¡ä¸­çš„å‚æ•°å˜ä¸ºæ¨¡æ¿ æŠŠ ç±»æ¨¡æ¿æ•´ä½“ æ¨¡æ¿åŒ– ç¬¬ä¸€ç§åœ¨å®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨ï¼Œå› ä¸ºåä¸¤ç§éœ€è¦å‡½æ•°æ¨¡æ¿é…åˆç±»æ¨¡æ¿ï¼Œéº»çƒ¦ã€‚\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; using namespace std; template\u0026lt;class T1, class T2\u0026gt; class Person{ public: T1 m_name; T2 m_age; Person(T1 name, T2 age){ m_name = name; m_age = age; } void print(){ cout \u0026lt;\u0026lt; \u0026#34;name : \u0026#34; \u0026lt;\u0026lt; m_name \u0026lt;\u0026lt; \u0026#34; age : \u0026#34; \u0026lt;\u0026lt; m_age \u0026lt;\u0026lt; endl; } }; //1. æŒ‡å®šç±»å‹ void printP1(Person\u0026lt;string, int\u0026gt; \u0026amp;a){ a.print();\t} // 2. å‚æ•°æ¨¡æ¿åŒ– template\u0026lt;class T1, class T2\u0026gt; void printP2(Person\u0026lt;T1, T2\u0026gt; \u0026amp;a){ a.print(); } // 3. ç±»æ¨¡æ¿ æ¨¡æ¿åŒ– template\u0026lt;class T\u0026gt; void printP3( T \u0026amp;a){ a.print(); } int main(){ Person\u0026lt;string, int\u0026gt; a(\u0026#34;å¼ ä¸‰\u0026#34;, 33); printP1(a); printP2(a); printP3(a); return 0; } 8. ç±»æ¨¡æ¿é‡åˆ°ç»§æ‰¿ åœ¨ç»§æ‰¿æ—¶ï¼Œå¦‚æœçˆ¶ç±»æ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œé‚£ä¹ˆå¿…é¡»æŒ‡å®šçˆ¶ç±»æ¨¡æ¿çš„æ•°æ®ç±»å‹ã€‚ å¦‚æœæƒ³çµæ´»ç»§æ‰¿çˆ¶ç±»æ¨¡æ¿ï¼Œé‚£ä¹ˆå­ç±»ä¹Ÿéœ€è¦åšæˆç±»æ¨¡æ¿ã€‚ 9. ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°ç±»å¤–å®ç° template\u0026lt;class T1, class T2\u0026gt; class Person{ public: T1 m_name; T2 m_age; Person(T1 name, T2 age); void print(); }; template\u0026lt;class T1, class T2\u0026gt; Person\u0026lt;T1, T2\u0026gt;::Person(T1 name, T2 age){ m_name = name; m_age = age; } template\u0026lt;class T1, class T2\u0026gt; void Person\u0026lt;T1, T2\u0026gt;::print(){ cout \u0026lt;\u0026lt; \u0026#34;name : \u0026#34; \u0026lt;\u0026lt; m_name \u0026lt;\u0026lt; \u0026#34; age : \u0026#34; \u0026lt;\u0026lt; m_age \u0026lt;\u0026lt; endl; } 10. ç±»æ¨¡æ¿åˆ†æ–‡ä»¶ç¼–å†™ ç±»æ¨¡æ¿çš„å£°æ˜åœ¨.hæ–‡ä»¶ä¸­ï¼Œç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°åœ¨ç›¸å…³è”çš„.cppæ–‡ä»¶ä¸­å®ç°ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨åˆ«çš„æ–‡ä»¶ä¸­ï¼ˆæ¯”å¦‚main.cppï¼‰å¼•å…¥è¯¥ .hæ–‡ä»¶ï¼Œä½¿ç”¨è¯¥ç±»ï¼Œä¼šæ— æ³•ç¼–è¯‘ï¼ˆæ— æ³•è§£æå¤–éƒ¨ç¬¦å·ï¼‰ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\nåŸå› æ˜¯ï¼Œç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°åœ¨è°ƒç”¨æ—¶æ‰ä¼šåˆ›å»ºã€‚main.cppå¼•å…¥äº†.hæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­åªæœ‰ç±»æ¨¡æ¿çš„å£°æ˜ï¼Œæ²¡æœ‰å…·ä½“å®ç°ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š\næ³•1ï¼šä¸includeç±»çš„.hæ–‡ä»¶ï¼Œè€Œæ˜¯includeç±»çš„.cppæ–‡ä»¶ã€‚ æ³•2ï¼šå¯ä»¥å°†ç±»æ¨¡æ¿çš„å£°æ˜å’Œå®ç°å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”ä¹ æƒ¯ä¸ŠæŠŠè¯¥æ–‡ä»¶çš„åç¼€åå†™æˆ .hppã€‚ å®é™…ä¸­ï¼Œç¬¬äºŒç§æ–¹æ³•æ›´åŠ æ™®éã€‚\n11. ç±»æ¨¡æ¿çš„å‹å…ƒ ç±»å†…å®šä¹‰ï¼šä¸æ™®é€šç±»å®šä¹‰å‹å…ƒä¸€æ ·ã€‚ ç±»å†…å£°æ˜ï¼Œç±»å¤–å®šä¹‰ï¼šç±»å¤–å®šä¹‰çš„è¯ï¼Œè‚¯å®šè¦å£°æ˜ç§°æ¨¡æ¿ï¼Œè€Œç±»å†…çš„å£°æ˜è¯­å¥ï¼Œä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œç±»å†…çš„å£°æ˜è¦åŠ ä¸Šç©ºå‚æ•°åˆ—è¡¨friend test\u0026lt;\u0026gt;(test\u0026lt;T1, T2\u0026gt;);è¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ã€‚ ä¾‹ç¨‹ï¼š\n#include \u0026lt;iostream\u0026gt; using namespace std; // å£°æ˜æœ‰Personç±» è¦ä¸ç„¶test2æ‰¾ä¸åˆ°Personç±» template\u0026lt;class T\u0026gt; class Person; // å£°æ˜test2æ˜¯ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¦ä¸ç„¶ä¸‹è¾¹çš„Personç±»ä¸­æ‰¾ä¸åˆ°test2è¿™ä¸ªæ¨¡æ¿å‡½æ•° template\u0026lt;class T\u0026gt; void test2(Person\u0026lt;T\u0026gt; a){ cout \u0026lt;\u0026lt; a.a \u0026lt;\u0026lt; endl; } template\u0026lt;class T\u0026gt; class Person{ // 1. ç±»å†…å®ç°å‹å…ƒ friend void test1(){ // å‹å…ƒå‡½æ•°å£°æ˜ + å®šä¹‰ï¼Œå¦‚æœä¸åŠ friendçš„è¯ï¼Œç›¸å½“äºä¸€ä¸ªæ™®é€šçš„æˆå‘˜ cout \u0026lt;\u0026lt; 123 \u0026lt;\u0026lt; endl; } // 2. ç±»å¤–å®ç°å‹å…ƒ è¿™é‡Œå£°æ˜è¦åŠ ç©ºå‚æ•°åˆ—è¡¨ è¯´æ˜éœ€è¦çš„æ˜¯ä¸€ä¸ªæ¨¡æ¿å‡½æ•° friend void test2\u0026lt;\u0026gt;(Person\u0026lt;T\u0026gt;); public: Person(T age){ a = age; } T a; }; // test1å‡½æ•°çš„å£°æ˜ ä¾›mainè°ƒç”¨ã€‚ void test1(); int main(){ Person\u0026lt;int\u0026gt; a(10); test2(a); return 0; } ","permalink":"https://Clay-Hex.github.io/posts/2021/02/cpp-template/","summary":"0. æ¨¡æ¿ C++ä¸­é™¤äº†æœ‰é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œè¿˜æœ‰æ³›å‹ç¼–ç¨‹çš„æ€æƒ³ï¼Œæ³›å‹ç¼–ç¨‹åˆ©ç”¨çš„ä¸»è¦æŠ€æœ¯å°±æ˜¯æ¨¡æ¿ã€‚ C++ä¸­ä¸¤ç§æ¨¡æ¿ï¼šå‡½æ•°æ¨¡æ¿ã€ç±»æ¨¡æ¿ è¯­æ³•ï¼š template\u0026lt;typename T\u0026gt; å‡½æ•°å£°æ˜æˆ–å®šä¹‰ å«ä¹‰ï¼š template å›ºå®šçš„ï¼Œå£°æ˜åˆ›å»ºæ¨¡æ¿ typename è¡¨æ˜åè¾¹çš„Tæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥ç”¨classä»£æ›¿ T ç±»ä¼¼å½¢å‚ï¼Œä»»æ„çš„åˆæ³•å­—ç¬¦éƒ½å¯ä»¥ï¼Œä¹ æƒ¯ä¸Šç”¨ T æ¨¡æ¿æœ‰ä¸¤ç§","title":"C++å­¦ä¹ è®°å½•(8) æ¨¡æ¿"},{"content":"0. åŸºæœ¬è¯­æ³• å¤šæ€æ˜¯é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ã€‚\nå¤šæ€ï¼šå¤šæ€å³è°ƒç”¨æˆå‘˜å‡½æ•°æ—¶ï¼Œä¼šæ ¹æ®è°ƒç”¨å‡½æ•°çš„å¯¹è±¡çš„ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„å‡½æ•°ã€‚\nå¤šæ€åˆ†ä¸ºä¸¤ç±»\né™æ€å¤šæ€ï¼šå‡½æ•°é‡è½½ å’Œ è¿ç®—ç¬¦é‡è½½ å±äºé™æ€å¤šæ€ï¼Œæ˜¯å¯¹å‡½æ•°åçš„å¤ç”¨ã€‚ åŠ¨æ€å¤šæ€ï¼šæ´¾ç”Ÿç±»å’Œè™šå‡½æ•°å®ç°è¿è¡Œæ—¶å¤šæ€ã€‚ é™æ€å¤šæ€çš„å‡½æ•°åœ°å€æ—©ç»‘å®šï¼Œ ç¼–è¯‘é˜¶æ®µç¡®å®šå‡½æ•°åœ°å€ã€‚ åŠ¨æ€å¤šæ€çš„å‡½æ•°åœ°å€æ™šç»‘å®šï¼Œ è¿è¡Œé˜¶æ®µç¡®å®šå‡½æ•°åœ°å€ã€‚ å¼•å…¥è™šå‡½æ•°ï¼Œå°±æ˜¯ä¸ºäº†é€šè¿‡å‡½æ•°é‡å†™å®ç°å¤šæ€çš„æ•ˆæœã€‚\nåŠ¨æ€å¤šæ€éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š\nå‡ºç°åœ¨ç»§æ‰¿å½“ä¸­ å­ç±»é‡å†™çˆ¶ç±»çš„è™šå‡½æ•°ï¼Œæ³¨æ„ï¼Œå¿…é¡»æ˜¯è™šå‡½æ•°ï¼Œé‡å†™éè™šå‡½æ•°çš„è¯å®è´¨æ˜¯å‡½æ•°è¦†ç›–äº†ã€‚ åŠ¨æ€å¤šæ€çš„ä½¿ç”¨æ¡ä»¶ï¼š\nçˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼ŒæŒ‡å‘äº†å­ç±»å¯¹è±¡ã€‚ #include \u0026lt;iostream\u0026gt; #include \u0026lt;cstdio\u0026gt; using namespace std; class base{ public: virtual void speak(){ cout \u0026lt;\u0026lt; \u0026#34;baseåœ¨è¯´è¯\u0026#34; \u0026lt;\u0026lt; endl; } }; class son : public base { public: void speak(){ // é‡å†™äº†çˆ¶ç±»çš„è™šå‡½æ•° å®ç°äº†å¤šæ€ cout \u0026lt;\u0026lt; \u0026#34;sonåœ¨è¯´è¯\u0026#34; \u0026lt;\u0026lt; endl; } }; // C++ä¸­ æœ‰è‡ªåŠ¨çš„çˆ¶å­ç±» ç±»å‹è½¬æ¢ void speak(base \u0026amp;person){ // ä½¿ç”¨å¼•ç”¨è§¦å‘å¤šæ€ person.speak(); } int main(){ base b; son s; speak(s); return 0; } 1. å¤šæ€çš„åŸç† ç±»ä¸­å®šä¹‰äº†è™šå‡½æ•°çš„è¯ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ a ä»¥åï¼Œå°±ä¼šåœ¨ a ä¸­äº§ç”Ÿä¸€ä¸ªè™šå‡½æ•°æŒ‡é’ˆvfptrï¼ŒæŒ‡å‘è™šå‡½æ•°è¡¨ï¼ˆvftableï¼‰ã€‚\nç®€è€Œè¨€ä¹‹ï¼Œå­ç±»åœ¨è™šå‡½æ•°è¡¨ä¸­æ›¿æ¢äº†é‡å†™å‡½æ•°çš„é‚£æ¡è®°å½•ã€‚\n2. çº¯è™šå‡½æ•°å’ŒæŠ½è±¡ç±» çº¯è™šå‡½æ•°è¯­æ³•ï¼švirtual è¿”å›å€¼ç±»å‹ å‡½æ•°å ï¼ˆå‚æ•°åˆ—è¡¨ï¼‰ = 0ï¼Œæ— éœ€å¤§æ‹¬å·ã€‚\nå½“ç±»ä¸­æœ‰äº†ä¸€æ—¦æœ‰äº†çº¯è™šå‡½æ•°ï¼Œè¿™ä¸ªç±»å°±æˆä¸ºäº†æŠ½è±¡ç±» æŠ½è±¡ç±»ç‰¹ç‚¹ï¼š\næŠ½è±¡ç±»æ— æ³•å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†å¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡ã€‚ å­ç±»å¿…é¡»é‡å†™æŠ½è±¡ç±»ä¸­çš„çº¯è™šå‡½æ•°ï¼Œå¦åˆ™ä¹Ÿå±äºæŠ½è±¡ç±»ï¼Œå°±æ— æ³•å®ä¾‹åŒ–å¯¹è±¡ã€‚ class base{ public: virtual void speak() = 0; // çº¯è™šå‡½æ•° int a; }; class son : public base { public: void speak(){ // é‡å†™äº†çˆ¶ç±»çš„è™šå‡½æ•° å®ç°äº†å¤šæ€ cout \u0026lt;\u0026lt; \u0026#34;sonåœ¨è¯´è¯\u0026#34; \u0026lt;\u0026lt; endl; } }; int main(){ base *b = new son; // çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘äº†å­ç±» è¿™å°±å®ç°äº†å¤šæ€ son ss; // å­ç±»ç›´æ¥å®ä¾‹åŒ–å‡ºä¸€ä¸ªå¯¹è±¡ return 0; } 3. è™šææ„å’Œçº¯è™šææ„ ä½œç”¨ï¼š\nè§£å†³é€šè¿‡çˆ¶ç±»æŒ‡é’ˆæ— æ³•é‡Šæ”¾å­ç±»å¯¹è±¡çš„é—®é¢˜ã€‚ å¦‚æœå­ç±»ä¸­æ²¡æœ‰å †åŒºæ•°æ®ï¼Œå¯ä»¥ä¸å†™è™šææ„æˆ–çº¯è™šææ„ æ‹¥æœ‰çº¯è™šææ„ä¹Ÿå±äºæŠ½è±¡ç±»ï¼Œæ— æ³•ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚ é—®é¢˜ï¼šå¤šæ€ä½¿ç”¨æ—¶ï¼ˆçˆ¶ç±»æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘äº†å­ç±»ï¼‰ï¼Œå¦‚æœå­ç±»ä¸­æœ‰å±æ€§å¼€è¾Ÿåˆ°äº†å †åŒºï¼Œé‚£ä¹ˆçˆ¶ç±»æŒ‡é’ˆåœ¨é‡Šæ”¾æ—¶æ— æ³•è°ƒç”¨å­ç±»çš„ææ„ä»£ç ã€‚\nè§£å†³åŠæ³•ï¼šå°†çˆ¶ç±»ä¸­çš„ææ„å‡½æ•°æ”¹ä¸ºè™šçš„æˆ–è€…çº¯è™šçš„ã€‚\næµ‹è¯•ä»£ç ï¼š\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;cstdio\u0026gt; using namespace std; class base{ public: virtual void f() = 0; // çº¯è™šå‡½æ•° base(){ cout \u0026lt;\u0026lt; \u0026#34;base æ„é€ å‡½æ•°\u0026#34; \u0026lt;\u0026lt; endl; } ~base(){ cout \u0026lt;\u0026lt; \u0026#34;baseææ„\u0026#34; \u0026lt;\u0026lt; endl; } }; class son : public base { public: void f(){ cout \u0026lt;\u0026lt; \u0026#34;void f fuction in son\u0026#34; \u0026lt;\u0026lt; endl; } son(){ cout \u0026lt;\u0026lt; \u0026#34;sonæ„é€ å‡½æ•°\u0026#34; \u0026lt;\u0026lt; endl; } ~son(){ cout \u0026lt;\u0026lt; \u0026#34;sonææ„\u0026#34; \u0026lt;\u0026lt; endl; } }; int main(){ base *b = new son; delete b; return 0; } è¾“å‡º:\nbaseæ„é€  sonæ„é€  baseææ„ åœ¨baseææ„å‰è¾¹ï¼Œæ²¡æœ‰sonææ„ï¼Œå¦‚æœå­ç±»ä¸­åœ¨å †åŒºå¼€äº†ç©ºé—´ï¼Œé‚£å°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚\næ­¤æ—¶ï¼Œå¦‚æœæŠŠbaseç±»ä¸­çš„ææ„å‡½æ•°åŠ ä¸Švirtualä¿®é¥°ï¼Œå˜æˆä¸€ä¸ªè™šå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨é‡Šæ”¾çˆ¶ç±»æŒ‡é’ˆçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘å­ç±»çš„ææ„å‡½æ•°äº†ï¼ŒæŠŠå­ç±»é‡Šæ”¾æ‰ã€‚\nä¸€ä¸ªçº¯è™šçš„ææ„å‡½æ•°ï¼Œé™¤äº†æœ‰å£°æ˜ï¼Œè¿˜å¿…é¡»è¦æœ‰å…·ä½“å®ç°ï¼Œç±»å†…å£°æ˜ï¼Œç±»å¤–å®šä¹‰ ","permalink":"https://Clay-Hex.github.io/posts/2021/02/cpp-polymorphic/","summary":"0. åŸºæœ¬è¯­æ³• å¤šæ€æ˜¯é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ã€‚ å¤šæ€ï¼šå¤šæ€å³è°ƒç”¨æˆå‘˜å‡½æ•°æ—¶ï¼Œä¼šæ ¹æ®è°ƒç”¨å‡½æ•°çš„å¯¹è±¡çš„ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„å‡½æ•°ã€‚ å¤šæ€åˆ†ä¸ºä¸¤ç±» é™æ€å¤šæ€ï¼šå‡½æ•°é‡è½½ å’Œ è¿ç®—ç¬¦é‡è½½ å±äºé™æ€å¤šæ€ï¼Œæ˜¯å¯¹å‡½æ•°åçš„å¤ç”¨ã€‚ åŠ¨æ€å¤šæ€ï¼šæ´¾ç”Ÿç±»å’Œè™šå‡½æ•°å®ç°è¿è¡Œæ—¶å¤šæ€ã€‚ é™æ€å¤šæ€çš„å‡½æ•°åœ°å€æ—©ç»‘å®šï¼Œ ç¼–è¯‘é˜¶æ®µç¡®å®šå‡½æ•°åœ°å€ã€‚ åŠ¨æ€å¤š","title":"C++å­¦ä¹ è®°å½•(7) å¤šæ€"},{"content":"0. åŸºæœ¬è¯­æ³• ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ã€‚\nclass å­ç±» ï¼š ç»§æ‰¿æ–¹å¼ çˆ¶ç±»\nä»çˆ¶ç±»ç»§æ‰¿æ¥çš„è¡¨ç°å…¶å…±æ€§ï¼Œè€Œæ–°å¢çš„æˆå‘˜è¡¨ç°å…¶ä¸ªæ€§ã€‚\n1. ç»§æ‰¿æ–¹å¼ ä¸‰ç§ç»§æ‰¿æ–¹å¼\npublic protected private çˆ¶ç±»ä¸­çš„privateæˆå‘˜ï¼Œæ— è®ºå“ªç§æ–¹å¼éƒ½ä¸èƒ½è®¿é—®ã€‚ 2. ç»§æ‰¿ä¸­çš„å¯¹è±¡æ¨¡å‹ é—®é¢˜ï¼šä»çˆ¶ç±»ç»§æ‰¿æ¥çš„æˆå‘˜ï¼Œå“ªäº›å±äºå­ç±»å¯¹è±¡ä¸­ï¼Ÿ\nè¾“å‡ºå­ç±»çš„sizeofå¯ä»¥çœ‹å‡ºï¼Œçˆ¶ç±»ä¸­çš„æ‰€æœ‰éé™æ€æˆå‘˜éƒ½ä¼šè¢«å­ç±»ç»§æ‰¿ä¸‹å»ï¼Œæ— è®ºå“ªç§ç»§æ‰¿æ–¹å¼ã€‚\n3. çˆ¶ç±»å’Œå­ç±»çš„æ„é€ å’Œææ„é¡ºåº æ„é€ ï¼šå…ˆbaseåson\nææ„ï¼šæ°æ°ç›¸åï¼Œå…ˆsonåbase\n4. åŒåæˆå‘˜çš„å¤„ç† è¦è®¿é—®å­ç±»æˆå‘˜ï¼šç›´æ¥è®¿é—® è¦è®¿é—®çˆ¶ç±»æˆå‘˜ï¼šåŠ ä¸Šä½œç”¨åŸŸ son.base::a çˆ¶å­ç±»å‡ºç°é‡åæˆå‘˜å‡½æ•°æ—¶ï¼Œå­ç±»ä¼šå±è”½æ‰çˆ¶ç±»ä¸­æ‰€æœ‰çš„åŒåå‡½æ•°ï¼ˆå¦‚æœçˆ¶ç±»ä¸­æœ‰é‡è½½ï¼Œä¹Ÿå…¨éƒ½å±è”½æ‰ï¼‰ï¼Œå¦‚æœæƒ³è®¿é—®ï¼Œå°±éœ€è¦åŠ ä¸Šçˆ¶ç±»ä½œç”¨åŸŸã€‚å› ä¸ºè¿™æ˜¯åœ¨é‡å†™çˆ¶ç±»ä¸­çš„éè™šå‡½æ•°ï¼Œè¯¥å‡½æ•°æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆåœ°å€ç»‘å®šçš„ã€‚å¦‚æœéè¦é‡å†™éè™šå‡½æ•°ï¼Œåœ¨è®¾è®¡ä¸Šæ˜¯çŸ›ç›¾çš„ï¼Œçˆ¶ç±»æŠŠè¯¥å‡½æ•°è®¾è®¡æˆéè™šå‡½æ•°çš„æœ¬æ„å°±æ˜¯ä¸å¸Œæœ›å­ç±»å»æ›´æ”¹è¯¥å‡½æ•°ã€‚ 5. å¤šç»§æ‰¿ C++å…è®¸ä¸€ä¸ªç±»ç»§æ‰¿å¤šä¸ªç±»\nè¯­æ³•ï¼šclass å­ç±» ï¼š ç»§æ‰¿æ–¹å¼ çˆ¶ç±»1ï¼Œ ç»§æ‰¿æ–¹å¼ çˆ¶ç±»2ã€‚ã€‚ã€‚\nå¤šç»§æ‰¿å¯èƒ½ä¼šå¼•å‘çˆ¶ç±»ä¸­æœ‰åŒåæˆå‘˜å‡ºç°ï¼Œéœ€è¦åŠ ä½œç”¨åŸŸåŒºåˆ†ã€‚\nC++å®é™…å¼€å‘ä¸­ä¸å»ºè®®ä½¿ç”¨å¤šç»§æ‰¿ã€‚\n6. è±å½¢ï¼ˆé’»çŸ³ï¼‰ç»§æ‰¿ bç±»å’Œcç±»ç»§æ‰¿äºaç±»ï¼Œdç±»åˆåŒæ—¶ç»§æ‰¿äºbç±»å’Œcç±»ï¼Œå°±å«åšè±å½¢ç»§æ‰¿ã€‚\nä¼šå‡ºç°çš„é—®é¢˜ï¼š\nä¸¤ä¸ªçˆ¶ç±»ä¼šæœ‰ç›¸åŒçš„æ•°æ®ï¼Œéœ€è¦åŠ ä»¥ä½œç”¨åŸŸè¿›è¡ŒåŒºåˆ†ã€‚ è±å½¢ç»§æ‰¿ä¼šå¯¼è‡´æ•°æ®æœ‰ä¸¤ä»½ï¼ˆæ¥è‡ªbå’Œæ¥è‡ªcçš„éƒ½æœ‰ä¸€ä»½ï¼‰ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚æ­¤æ—¶ä½¿ç”¨è™šåŸºç±»å¯ä»¥è§£å†³ã€‚ vbptrè™šåŸºç±»æŒ‡é’ˆä¼šæŒ‡å‘vbtableè™šåŸºç±»è¡¨ã€‚\nè™šç»§æ‰¿å¯èƒ½å®é™…ä¸­ä¸å¤ªä¼šç”¨åˆ°ï¼Œå› ä¸ºå¤šç»§æ‰¿éƒ½å¾ˆå°‘ç”¨åˆ°ï¼Œå¤§æ¦‚ç‡æ˜¯åœ¨é¢è¯•ä¸­å‡ºç°ï¼ŒçŸ¥é“åº•å±‚å®ç°çš„åŸç†å³å¯ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/02/cpp-inheritance/","summary":"0. åŸºæœ¬è¯­æ³• ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ã€‚ class å­ç±» ï¼š ç»§æ‰¿æ–¹å¼ çˆ¶ç±» ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„è¡¨ç°å…¶å…±æ€§ï¼Œè€Œæ–°å¢çš„æˆå‘˜è¡¨ç°å…¶ä¸ªæ€§ã€‚ 1. ç»§æ‰¿æ–¹å¼ ä¸‰ç§ç»§æ‰¿æ–¹å¼ public protected private çˆ¶ç±»ä¸­çš„privateæˆå‘˜ï¼Œæ— è®ºå“ªç§æ–¹å¼éƒ½ä¸èƒ½è®¿é—®ã€‚ 2. ç»§æ‰¿ä¸­çš„å¯¹è±¡æ¨¡å‹ é—®é¢˜ï¼šä»çˆ¶ç±»ç»§æ‰¿æ¥çš„æˆå‘˜ï¼Œå“ªäº›å±äºå­ç±»å¯¹è±¡ä¸­ï¼Ÿ è¾“å‡ºå­ç±»çš„sizeofå¯ä»¥","title":"C++å­¦ä¹ è®°å½•(6) ç»§æ‰¿"},{"content":"0. ç±»çš„4ä¸ªé»˜è®¤å‡½æ•° 4ä¸ªå‡½æ•°ï¼šæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€èµ‹å€¼å·é‡è½½å‡½æ•°ã€‚\nåœ¨å®šä¹‰ç±»æ—¶ï¼Œå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰è¿™äº›å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šæä¾›é»˜è®¤çš„å‡½æ•°ï¼Œåœ¨é»˜è®¤çš„å‡½æ•°ä¸­ï¼Œæ„é€ å‡½æ•°ã€ææ„å‡½æ•°é»˜è®¤ç©ºå®ç°ï¼Œæ‹·è´æ„é€ å‡½æ•°ã€èµ‹å€¼å·é‡è½½å‡½æ•°é»˜è®¤æ˜¯æµ…æ‹·è´ã€‚\næ‹·è´æ„é€ å‡½æ•°ä½œç”¨ï¼š\nå‚æ•°æ˜¯ä¸€ä¸ªåŒç±»å‹çš„å¯¹è±¡ï¼Œç›´æ¥æ‹·è´è¿™ä¸ªå‚æ•°çš„æ‰€æœ‰å±æ€§ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæ‹·è´é»˜è®¤æ˜¯æµ…æ‹·è´ï¼Œéœ€è¦æ·±æ‹·è´çš„è¯éœ€è¦é‡è½½æ‹·è´æ„é€ å‡½æ•°ã€‚ ã€æ³¨ã€‘\nå¦‚æœåœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåè¾¹åŠ äº†ä¸€ä¸ªç©ºæ‹¬å·ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜è€Œä¸æ˜¯å®ä¾‹åŒ–ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œå®ä¾‹åŒ–æ—¶ä¸ç”¨é™„åŠ ç©ºæ‹¬å·. Person a(); // è¿™æ ·ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜ Person a; // åº”è¯¥è¿™æ · ä¸è¦ç”¨æ‹·è´æ„é€ å‡½æ•°å»åˆå§‹åŒ–ä¸€ä¸ªåŒ¿åå¯¹è±¡ï¼Œå¦åˆ™ä»ç¼–è¯‘å™¨ä¼šè®¤ä¸ºè¿™æ˜¯é‡å®šä¹‰ã€‚\nå¯ä»¥åƒè¿™æ ·ç»™æ„é€ å‡½æ•°ä¼ å‚Person aaa = 10; éšå¼è½¬æ¢æ³•ã€‚\nå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰æ„é€ å‡½æ•°çš„è¯ï¼ŒC++ä¼šè‡ªåŠ¨åˆ†é…ç©ºçš„æ„é€ å‡½æ•°å’Œ åªä¼šæµ…æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°\n1. ç±»çš„è®¿é—®è¯´æ˜ç¬¦ï¼ˆè®¿é—®æƒé™ï¼‰ publicï¼šå¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å­ç±»çš„å‡½æ•°ã€å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä¹Ÿå¯ä»¥ç”±è¯¥ç±»çš„å¯¹è±¡è®¿é—®ï¼› protectedï¼šå¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å­ç±»çš„å‡½æ•°ã€å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä½†ä¸å¯ä»¥ç”±è¯¥ç±»çš„å¯¹è±¡è®¿é—®ï¼› privateï¼šå¯ä»¥è¢«è¯¥ç±»ä¸­çš„å‡½æ•°ã€å‹å…ƒå‡½æ•°è®¿é—®ï¼Œä½†ä¸å¯ä»¥ç”±å­ç±»çš„å‡½æ•°ã€è¯¥ç±»çš„å¯¹è±¡è®¿é—®ã€‚ ä¸‰è€…éƒ½å…è®¸å‹å…ƒè®¿é—®ã€‚ protectedå’Œpublicçš„åŒºåˆ«å°±åœ¨äºç±»çš„ç±»å¤–å¯ä¸å¯ä»¥è°ƒç”¨ã€‚ protectedå’Œprivateçš„åŒºåˆ«å°±åœ¨äºå­ç±»æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œprivateæƒé™ç»™çš„æœ€å°ï¼Œå­ç±»éƒ½ä¸å¯ä»¥è®¿é—®ã€‚ æ€»ç»“ï¼šæŒ‰ç…§ç±»çš„å¯¹è±¡æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œå¯ä»¥å°†åä¸¤ä¸ªåˆ†æˆä¸€ç±»ï¼ŒæŒ‰ç…§å­ç±»æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œå¯ä»¥å°†å‰ä¸¤ä¸ªåˆ†æˆä¸€ç±»ã€‚\n2. å‹å…ƒ å¯¹äºä¸å®Œå…¨å¼€æ”¾çš„protectedå’Œprivateä¸­çš„æˆå‘˜ï¼Œç±» å¯ä»¥ä¸ºå‹å…ƒå‡½æ•°ï¼ˆç±»ï¼‰æä¾›å•ç‹¬çš„è®¿é—®æƒé™ã€‚\nå…¨å±€å‡½æ•°å¯ä»¥åšå‹å…ƒ ç±»å¯ä»¥åšå‹å…ƒ ç±»çš„æˆå‘˜å‡½æ•°å¯ä»¥åšå‹å…ƒ å‹å…ƒå‡½æ•°çš„å£°æ˜å¿…é¡»åœ¨ç±»å†…ï¼Œæœ€å¥½æ˜¯åœ¨ç±»çš„å¼€å§‹ä½ç½®ã€‚ä½†æ˜¯å‹å…ƒå‡½æ•°çš„å®šä¹‰æˆ–è€…è¯´å®ç°å³å¯åœ¨åœ¨ç±»å†…ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»å¤–ã€‚\nå‹å…ƒçš„å£°æ˜ä»…ä»…æŒ‡å®šäº†è®¿é—®æƒé™ï¼Œè€Œéé€šå¸¸æ„ä¹‰ä¸Šçš„å‡½æ•°å£°æ˜ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ç±»çš„ç”¨æˆ·å¯ä»¥è°ƒç”¨æŸä¸ªå‹å…ƒå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»åœ¨å‹å…ƒå£°æ˜ä¹‹å¤–ï¼Œå†ä¸“é—¨å¯¹è¯¥å‡½æ•°è¿›è¡Œä¸€æ¬¡å£°æ˜ï¼ˆæä¾›ç»™ç”¨æˆ·ï¼‰ã€‚\nä¸ºäº†æ–¹ä¾¿ï¼Œé€šå¸¸æŠŠå‹å…ƒçš„å£°æ˜ä¸ç±»æœ¬èº«æ”¾ç½®åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ï¼ˆç±»çš„å¤–éƒ¨å•ç‹¬å¯¹è¯¥å‡½æ•°å£°æ˜ï¼Œä»¥å¤‡å¤–éƒ¨è°ƒç”¨æ–¹ä¾¿ï¼‰ã€‚\nç±»å†…è¿›è¡Œå‹å…ƒå‡½æ•°å®šä¹‰ï¼Œç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ªå…¨å±€å‡½æ•°ã€‚ å‚è€ƒä»£ç ï¼š\n#include \u0026lt;iostream\u0026gt; using namespace std; class Person{ friend void test(){ // å‹å…ƒå‡½æ•°å£°æ˜ + å®šä¹‰ï¼Œå¦‚æœä¸åŠ friendçš„è¯ï¼Œç›¸å½“äºä¸€ä¸ªæ™®é€šçš„æˆå‘˜ cout \u0026lt;\u0026lt; 123 \u0026lt;\u0026lt; endl; } public: int a; }; // testå‡½æ•°çš„å®šä¹‰åœ¨Personç±»çš„å†…éƒ¨ï¼Œç°åœ¨æƒ³ä½¿ç”¨å®ƒï¼Œå¿…é¡»å•ç‹¬è¿›è¡Œå£°æ˜ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæˆ‘å·²ç»å®šä¹‰äº†testå‡½æ•°ï¼Œç›´æ¥è°ƒç”¨æ²¡é—®é¢˜ã€‚ void test(); int main(){ test(); return 0; } 3. å†…è”å‡½æ•° ä¸€èˆ¬æ¥è¯´ï¼Œå†…è”æœºåˆ¶ç”¨äºä¼˜åŒ–è§„æ¨¡è¾ƒå°ã€æµç¨‹ç®€å•ã€é¢‘ç¹è°ƒç”¨çš„å‡½æ•°ã€‚\nåœ¨ç¼–è¯‘æ—¶ï¼Œç›´æ¥æŠŠå†…è”å‡½æ•°æ›¿æ¢åˆ°è°ƒç”¨å®ƒçš„åœ°æ–¹ï¼Œè¿™æ ·å°±çœå»äº†è¿è¡Œæ—¶è°ƒç”¨å‡½æ•°çš„å¼€é”€ã€‚\nç±»å†…å®šä¹‰çš„æˆå‘˜å‡½æ•°é»˜è®¤éƒ½æ˜¯inlineçš„ã€‚ ç±»å¤–å®šä¹‰çš„æˆå‘˜å‡½æ•°é»˜è®¤éƒ½ä¸æ˜¯inlineçš„ï¼Œæƒ³ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥åŠ ä¸Šinlineè¯´æ˜ã€‚åŒæ—¶ï¼Œéœ€è¦æŠŠç±»çš„å®šä¹‰å’Œè¯¥ç±»å¤–å®šä¹‰çš„æˆå‘˜å‡½æ•° æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¦åˆ™ç¼–è¯‘æ—¶æ‰¾ä¸åˆ°å†…è”å‡½æ•°ã€‚ 4. æ·±æ‹·è´ä¸æµ…æ‹·è´ å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰æ„é€ å‡½æ•°çš„è¯ï¼ŒC++ä¼šè‡ªåŠ¨åˆ†é…ç©ºçš„æ„é€ å‡½æ•°å’Œ åªä¼šæµ…æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°\nåœ¨æ‰§è¡Œæ‹·è´æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡ a1 åœ¨å †ä¸Šå¼€äº†ä¸€ä¸ªæŒ‡é’ˆ p æŒ‡å‘çš„åœ°å€æ˜¯0x0011ï¼Œa2ä½¿ç”¨a1è¿›è¡Œåˆå§‹åŒ–ï¼ˆä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°å¤åˆ¶a1çš„å€¼ï¼‰ã€‚æ‰€æœ‰å±æ€§å®Œå…¨å¤åˆ¶ï¼Œæ‰€ä»¥a2ä¸­çš„pæ‰€æŒ‡çš„åœ°å€ä¹Ÿæ˜¯0x0011ï¼Œå¹¶æ²¡æœ‰é‡æ–°å¼€è¾Ÿä¸€ä¸ªå †çš„ç©ºé—´ã€‚æ‰€ä»¥å¦‚æœa1å…ˆè¢«é‡Šæ”¾äº†çš„è¯ï¼Œa2å†ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆè¿›è¡Œæ“ä½œï¼Œå°±ä¼šäº§ç”Ÿå¼‚å¸¸äº†ã€‚\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;limits.h\u0026gt; #include \u0026lt;algorithm\u0026gt; using namespace std; class TEST{ public: TEST(int a){ age = new int(a); } ~TEST(){ if(age != nullptr){ delete age; age = nullptr; } } int *age = nullptr; }; int main(){ TEST a1(10); TEST a2(a1); cout \u0026lt;\u0026lt; *a1.age \u0026lt;\u0026lt; endl; //a1.~TEST(); cout \u0026lt;\u0026lt; *a2.age \u0026lt;\u0026lt; endl; return 0; } ç¼–è¯‘å™¨é»˜è®¤ç»™çš„æ‹·è´æ„é€ å‡½æ•°å°±æ˜¯åªä¼šæµ…æ‹·è´ï¼Œæƒ³å®ç°æ·±æ‹·è´ï¼Œéœ€è¦è‡ªå·±åŠ¨æ‰‹ã€‚\n5. ç±»aä½œä¸ºç±»bçš„æˆå‘˜ å…ˆæ„é€ æˆå‘˜ç±» aï¼Œ å†æ„é€  bã€‚\nå…ˆææ„bï¼Œå†ææ„æˆå‘˜ç±»aï¼Œä¹Ÿå°±æ˜¯è¯´ææ„çš„é¡ºåºä¸æ„é€ çš„é¡ºåºç›¸åã€‚\n6. é™æ€æˆå‘˜ é™æ€æˆå‘˜ï¼šç”¨staticä¿®é¥°çš„æˆå‘˜å˜é‡æˆ–å‡½æ•°ï¼Œä¹Ÿæ˜¯å¯ä»¥è®¾ç½®publicã€privateç­‰è®¿é—®æƒé™çš„ã€‚\nç‰¹ç‚¹ï¼šç±»å†…å£°æ˜ï¼Œç±»å¤–åˆå§‹åŒ–ã€‚\né™æ€æˆå‘˜å˜é‡ï¼š\næ‰€æœ‰å®ä¾‹åŒ–åçš„å¯¹è±¡å…±äº«ä¸€ä»½æ•°æ® åœ¨ç¼–è¯‘é˜¶æ®µåˆ†é…å†…å­˜ ç±»å†…å£°æ˜ï¼Œç±»å¤–åˆå§‹åŒ–int test::age = 10; é™æ€æˆå‘˜å‡½æ•°ï¼š\næ‰€æœ‰å®ä¾‹åŒ–åçš„å¯¹è±¡å…±äº«ä¸€ä¸ªå‡½æ•° é™æ€æˆå‘˜å‡½æ•°åªèƒ½è®¿é—®é™æ€æˆå‘˜å˜é‡ï¼ˆå› ä¸ºé™æ€æˆå‘˜å‡½æ•°åªæœ‰ä¸€ä»½ï¼Œè¿™ä¸ªç±»å¯èƒ½å®ä¾‹åŒ–å‡ºæ¥å¥½å¤šå¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨çš„ä¸æ˜¯é™æ€æˆå‘˜å˜é‡ï¼ˆæ¯ä¸ªå¯¹è±¡éƒ½ä¼šæ‹·è´å‡ºæ¥ä¸€ä¸ªï¼‰ï¼Œå®ƒæ ¹æœ¬ä¸çŸ¥é“å»è®¿é—®å“ªä¸€ä¸ªå¯¹è±¡çš„å˜é‡ï¼‰ã€‚ é™æ€çš„æˆå‘˜ï¼ˆåŒ…æ‹¬å˜é‡å’Œå‡½æ•°ï¼‰éƒ½å¯ä»¥ä¸å®ä¾‹åŒ–å¯¹è±¡ç›´æ¥è¿›è¡Œè®¿é—®å’Œè°ƒç”¨\n#include \u0026lt;iostream\u0026gt; using namespace std; class test{ public: // è¿™é‡Œå¦‚æœæ˜¯privateï¼Œé‚£ä¹ˆå¤–éƒ¨å°±ä¸å¯ä»¥è®¿é—®äº†ï¼Œåªèƒ½åœ¨ç±»ä¸­æ“ä½œ static int a; }; int test::a = 10; int main(){ test a; cout \u0026lt;\u0026lt; test::a \u0026lt;\u0026lt; endl; // privateä¿®é¥°ä¸‹ä¸å…è®¸è®¿é—® cout \u0026lt;\u0026lt; a.a \u0026lt;\u0026lt; endl; // privateä¿®é¥°ä¸‹ä¸å…è®¸è®¿é—® return 0; } 7. å¯¹è±¡æ¨¡å‹å’ŒthisæŒ‡é’ˆ ç±»ä¸­çš„å˜é‡å’Œå‡½æ•°æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œç±»é€šè¿‡ä¸€äº›åŠæ³•å°†ä»–ä»¬ç»„ç»‡åˆ°ä¸€èµ·ï¼Œæ„æˆäº†ä¸€ä¸ªç±»ã€‚\nå˜é‡ã€å‡½æ•°ã€é™æ€å˜é‡ã€é™æ€å‡½æ•°å››è€…ä¸­ï¼Œåªæœ‰å˜é‡æ˜¯å±äºç±»çš„å¯¹è±¡ä¸Šçš„ï¼Œå…¶ä»–ä¸‰ä¸ªéƒ½ä¸å±äºç±»çš„å¯¹è±¡ä¸Šã€‚\nåŸå› ï¼š\næ¯ä¸€ä¸ªéé™æ€æˆå‘˜å‡½æ•°å…¶å®åªæœ‰ä¸€ä»½ã€‚å„ä¸ªå®ä¾‹åŒ–äº†çš„å¯¹è±¡è°ƒç”¨è‡ªå·±çš„è¿™ä¸ªæˆå‘˜å‡½æ•°æ—¶ï¼ŒthisæŒ‡é’ˆæŒ‡å‘è¯¥å¯¹è±¡ï¼Œè¯¥æˆå‘˜å‡½æ•°é€šè¿‡ this æŒ‡é’ˆåŒºåˆ†æ˜¯å“ªä¸ªå¯¹è±¡è°ƒç”¨äº†å®ƒã€‚å¯ä»¥ä½¿ç”¨ *thisè¿”å›å¯¹è±¡è‡ªå·±ã€‚\n#include \u0026lt;iostream\u0026gt; using namespace std; class test{ public: test(int a){ age = a; } test \u0026amp;add( int a){ // æ³¨æ„è¿™é‡Œ è¿”å›æ˜¯å¼•ç”¨ å¦åˆ™è¿”å›çš„å°±æ˜¯åŸå§‹å¯¹è±¡æœ¬èº«äº† å°±æ˜¯åŸå§‹å¯¹è±¡çš„ä¸€ä¸ªæ‹·è´ï¼Œå°±ä¸èƒ½æ»¡è¶³é“¾å¼ç¼–ç¨‹çš„æ€æƒ³ age += a; return *this; } int age; }; int main(){ test a(10); // è¿™ä¹Ÿæ˜¯é“¾å¼ç¼–ç¨‹çš„æ€æƒ³ a.add(3).add(3); cout \u0026lt;\u0026lt; a.age \u0026lt;\u0026lt; endl; // è¾“å‡º16 return 0; } ä¸€ä¸ªç©ºçš„æŒ‡é’ˆä¹Ÿæ˜¯å¯ä»¥è®¿é—®ç±»å†…å‡½æ•°çš„ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œæ­¤æ—¶ç±»å†…çš„thisæŒ‡é’ˆä¹Ÿæ˜¯nullï¼Œæ‰€ä»¥ï¼Œå¦‚æœç”¨ç©ºæŒ‡é’ˆè°ƒç”¨ç±»å†…å‡½æ•°ï¼Œå¹¶ä¸”ç±»å†…å‡½æ•°è®¿é—®äº†æˆå‘˜å˜é‡ï¼ˆå®Œæ•´å½¢å¼æ˜¯ this -\u0026gt; æˆå‘˜å˜é‡ï¼‰ï¼Œå°±ç›¸å½“äºå¯¹nullè¿›è¡Œè®¿é—®ï¼Œç¨‹åºå°±ä¼šå‡ºé”™ã€‚ 8. constä¿®é¥°æˆå‘˜å‡½æ•° å¸¸å‡½æ•°ï¼š\næ˜¯ç”¨constä¿®é¥°çš„æˆå‘˜å‡½æ•° å¸¸å‡½æ•°ä¸å¯ä¿®æ”¹æˆå‘˜å±æ€§ï¼ˆé™¤äº†mutableçš„å±æ€§ï¼‰ å¸¸å¯¹è±¡ï¼š\nä½¿ç”¨constä¿®é¥°ä¸€ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå³ä¸ºå¸¸å¯¹è±¡ å¸¸å¯¹è±¡åªèƒ½è°ƒç”¨å¸¸å‡½æ•° ä¸ºä»€ä¹ˆconstä¿®é¥°è¿‡çš„å‡½æ•°ï¼ˆå¸¸å‡½æ•°ï¼‰ä¸èƒ½ä¿®æ”¹æˆå‘˜å±æ€§ï¼Ÿ\nä¿®æ”¹æˆå‘˜å±æ€§å®é™…ä¸Šæ˜¯thisä¸‹çš„å±æ€§ï¼ŒthisæŒ‡é’ˆå®é™…ä¸Šæ˜¯æŒ‡é’ˆå¸¸é‡(* const )ï¼Œä¸€æ—¦å®ä¾‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡ï¼ŒthisæŒ‡é’ˆå°±æŒ‡å‘äº†å®ƒï¼Œä¸”ä¸èƒ½å†æ›´æ”¹äº†ã€‚ åœ¨æˆå‘˜å‡½æ•°å‚æ•°åˆ—è¡¨åè¾¹åŠ ä¸Šconstè¿›è¡Œä¿®é¥°ï¼Œç›¸å½“äºè¯´ï¼šåœ¨æœ¬å‡½æ•°ä¸­ï¼ŒthisæŒ‡å‘çš„ç©ºé—´ä¹Ÿæ˜¯constçš„äº†ï¼Œä¹Ÿä¸å…è®¸é€šè¿‡thisè¿›è¡Œä¿®æ”¹äº†ã€‚ #include \u0026lt;iostream\u0026gt; using namespace std; class test{ public: // this æŒ‡é’ˆç›¸å½“äºæŒ‡é’ˆå¸¸é‡ test * const this // å‡½æ•°ååŠ äº†ä¸€ä¸ªconst ä¿®é¥°çš„å…¶å®æ˜¯thisæ‰€æŒ‡çš„ç©ºé—´ å³ const test * const this // å³åŠ äº†constï¼Œåœ¨æœ¬å‡½æ•°å†… thisæ‰€æŒ‡çš„ç©ºé—´ ä¸å…è®¸é€šè¿‡thisè¿›è¡Œæ”¹å˜äº† void fuc1() const { this -\u0026gt; a = 10; // ç¼–è¯‘å™¨æŠ¥é”™ } int a; }; int main(){ test p; p.fuc1(); return 0; } ä¸ºä»€ä¹ˆå¸¸å¯¹è±¡åªå…è®¸è°ƒç”¨å¸¸å‡½æ•°ï¼Ÿ\nå¯ä»¥è¿™æ ·ç†è§£ï¼šå¸¸å¯¹è±¡æœ¬èº«çš„æ„æ€å°±æ˜¯åªè¯»ï¼Œå¦‚æœè°ƒç”¨äº†ä¸€ä¸ªéå¸¸å‡½æ•°ï¼Œä¸‡ä¸€è¿™ä¸ªå‡½æ•°å¯¹è‡ªå·±çš„å±æ€§è¿›è¡Œäº†ä¿®æ”¹æ€ä¹ˆåŠï¼Ÿæ‰€ä»¥ï¼Œç›´æ¥åœ¨æ ¹æœ¬ä¸Šæ‹’ç»è¿™æ ·å±é™©çš„æ“ä½œï¼Œç›´æ¥é™å®šå¸¸å¯¹è±¡åªå…è®¸è°ƒç”¨å¸¸å‡½æ•°ï¼Œå› ä¸ºå¸¸å‡½æ•°è‚¯å®šä¿®æ”¹ä¸äº†è‡ªå·±çš„å±æ€§ã€‚ 9. é‡è½½è¿ç®—ç¬¦ 9.1 åŸºæœ¬è¿ç®—ç¬¦é‡è½½ ä»¥åŠ æ³•ä¸ºä¾‹ï¼Œå°±ç›¸å½“äºè‡ªå·±åœ¨ç±»é‡Œè¾¹å†™äº†ä¸€ä¸ªåšåŠ æ³•çš„å‡½æ•°ï¼Œä½†æ˜¯å‡½æ•°åç»Ÿä¸€æˆoperator +äº†ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°ååƒæ™®é€šæˆå‘˜å‡½æ•°é‚£æ ·è°ƒç”¨a.operator+( b )ï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ç®€å†™ä¸º a + bã€‚\nè¿ç®—ç¬¦é‡è½½ï¼Œä¹Ÿå¯ä»¥å‘ç”Ÿå‡½æ•°é‡è½½ï¼Œæ¯”å¦‚åŠ æ³•è¿ç®—ï¼Œå¯ä»¥æ˜¯ä¸¤ä¸ªç±»åšç›¸åŠ ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»å’Œä¸€ä¸ªæ•´æ•°ç›¸åŠ ã€‚ 9.2 å·¦ç§»è¿ç®—ç¬¦é‡è½½ ä½œç”¨ï¼šè¾“å‡ºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹eg: cout \u0026lt;\u0026lt; class\nå¦‚æœåœ¨ç±»å†…å®šä¹‰å·¦ç§»é‡è½½è¿ç®—ç¬¦çš„è¯ç±»æœ¬èº«å°±é»˜è®¤ä½œä¸ºå·¦æ“ä½œæ•°äº†ï¼Œé‚£ä¹ˆcoutå°±åªèƒ½åœ¨å³è¾¹ï¼Œæ¯”å¦‚class \u0026lt;\u0026lt; coutï¼Œå¯è§è¿™æ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ï¼Œæ‰€ä»¥å·¦ç§»è¿ç®—ç¬¦çš„é‡è½½ï¼Œä¸€èˆ¬ä¸å†™åœ¨ç±»ä¸­ï¼Œéƒ½å†™æˆå…¨å±€å‡½æ•°çš„å½¢å¼ã€‚ ä¸ºäº†æ»¡è¶³é“¾å¼ç¼–ç¨‹ï¼Œè¿”å›å€¼ä¹Ÿè¦æ˜¯è¾“å‡ºæµçš„å¼•ç”¨ã€‚ inline ostream \u0026amp;operator\u0026lt;\u0026lt; (ostream \u0026amp;out, test \u0026amp;s){ out \u0026lt;\u0026lt; s.a; return out; } æ­¤æ—¶ï¼Œé‡è½½è¿ç®—ç¬¦çš„å‡½æ•°æ˜¯å®šä¹‰åœ¨å…¨å±€å‡½æ•°ä¸­çš„ï¼Œæ˜¯å¦‚æ³•è®¿é—®ç±»ä¸­çš„privateæˆå‘˜çš„ï¼Œè¿˜éœ€è¦è¿›è¡Œå‹å…ƒç”³æ˜ï¼Œç»™å®ƒè®¿é—®æƒé™ã€‚ 9.3 é€’å¢é€’å‡è¿ç®—ç¬¦é‡è½½ é‡è½½è¿ç®—ç¬¦å‡½æ•°ä¸­ç©ºå‚æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºå°†thisä½œä¸ºå³æ“ä½œæ•°ã€‚ åç½®++è¿ç®—ç¬¦é‡è½½ï¼Œéœ€è¦ä¸€ä¸ªintå ä½ï¼Œæ¥åŒºåˆ†å‰ç½®å’Œåç½®çš„é‡è½½ã€‚ è¦æ³¨æ„å‰ç½®å’Œåç½®ä¸¤ç§é‡è½½çš„è¿”å›ç±»å‹ã€‚ class test{ friend inline ostream\u0026amp; operator\u0026lt;\u0026lt; (ostream \u0026amp;out, test a); public: test(){ age = 10; } // é‡è½½å‰ç½®++ å¿…é¡»è¦è¿”å›å¼•ç”¨ test\u0026amp; operator++(){ // æ²¡æœ‰å ä½çš„å°±å½“ä½œthisæ˜¯å³æ“ä½œæ•° age++; return *this; } // é‡è½½åç½®++ï¼Œä¸ç”¨è¿”å›å¼•ç”¨ï¼Œå› ä¸ºè¿”å›å»å¯èƒ½å°±çœ‹ä¸€ä¸‹å€¼æ˜¯å¤šå°‘ï¼Œthisæœ¬èº«è¿˜æ˜¯åšäº†+1çš„ã€‚ test operator++ (int){ // thisæœ¬èº«ä½œä¸ºå·¦å€¼äº†ï¼Œ å³ä¾§æä¸€ä¸ªintæ¥å ä½ test tmp = *this; age++; return tmp; } private: int age; }; inline ostream\u0026amp; operator\u0026lt;\u0026lt; (ostream \u0026amp;out, test a){ out \u0026lt;\u0026lt; a.age; return out; } 9.4 èµ‹å€¼è¿ç®—ç¬¦é‡è½½ c++ç¼–è¯‘å™¨è‡³å°‘æ·»åŠ 4ä¸ªé»˜è®¤çš„å‡½æ•°ã€‚\né»˜è®¤æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå¯¹å±æ€§è¿›è¡Œæµ…æ‹·è´ï¼‰ã€‚\nè¦æ³¨æ„å¦‚æœæœ‰å †åŒºæ•°æ®çš„è¯ï¼Œåœ¨é‡è½½èµ‹å€¼è¿ç®—ç¬¦çš„æ—¶å€™éœ€è¦å¯¹å †å–æ•°æ®è¿›è¡Œæ·±æ‹·è´ã€‚\nè¦æ³¨æ„a = b = cçš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯èµ‹å€¼è¿ç®—ç¬¦çš„é‡è½½å‡½æ•°éœ€è¦æœ‰ä¸€ä¸ªè¿”å›å€¼å¼•ç”¨ã€‚\ntest\u0026amp; operator= (test \u0026amp;a) { if(age != nullptr){ delete age; age = nullptr; } // æ·±æ‹·è´ age = new int(*a.age); return *this; // è¿ç»­èµ‹å€¼ } 9.5 å…³ç³»è¿ç®—ç¬¦é‡è½½ æ²¡ä»€ä¹ˆç‰¹æ®Šçš„\n9.6 å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦é‡è½½ å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ï¼šå°±æ˜¯å°æ‹¬å·ï¼ˆï¼‰ï¼Œä¹Ÿå¯ä»¥é‡è½½ã€‚\nç”±äºé‡è½½åä½¿ç”¨çš„æ–¹å¼éå¸¸åƒå‡½æ•°çš„è°ƒç”¨ï¼Œå› æ­¤ä¹Ÿç§°ä»¿å‡½æ•°ï¼ˆSTLä¸­ä½¿ç”¨çš„è¾ƒå¤šï¼‰ã€‚\nä»¿å‡½æ•°æ²¡æœ‰å›ºå®šå†™æ³•ï¼Œéå¸¸çµæ´»ã€‚\n10. è½¬æ¢å‡½æ•° ç›®çš„ï¼šå°†ä¸€ä¸ªç±»è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚\nè½¬æ¢å‡½æ•°é€šå¸¸ä¸ä¼šä¿®æ”¹è‡ªèº«çš„æ•°æ®ï¼Œä¸€èˆ¬è¦åŠ ä¸Šconstä¿®é¥°ã€‚\nclass person{ public: operator int() const { return int(1.0); } // ä¸ç”¨å†™è¿”å›ç±»å‹ï¼Œå› ä¸ºå‡½æ•°åå°±æ˜¯è¿”å›çš„ç±»å‹ã€‚ // ä¸€èˆ¬éƒ½åŠ ä¸Šconstä¿®é¥° }; person f; int a = 4 + f; // å°è¯•å°†fè½¬æ¢ä¸ºintå‹ã€‚è°ƒç”¨äº†ç±»ä¸­çš„é‡è½½å‡½æ•°ã€‚ // int a = f + 4; // è¿™å¥è¯åˆ™æ˜¯å°è¯•å°†4è½¬æ¢æˆpersonçš„ç±»å‹ï¼Œéœ€è¦ç”¨åˆ°è½¬æ¢æ„é€ å‡½æ•°ã€‚ 11.è½¬æ¢æ„é€ å‡½æ•° çœŸå®åå­—å«non-explicit-one-argument-constructor\n","permalink":"https://Clay-Hex.github.io/posts/2021/02/cpp-class/","summary":"0. ç±»çš„4ä¸ªé»˜è®¤å‡½æ•° 4ä¸ªå‡½æ•°ï¼šæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€èµ‹å€¼å·é‡è½½å‡½æ•°ã€‚ åœ¨å®šä¹‰ç±»æ—¶ï¼Œå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰è¿™äº›å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šæä¾›é»˜è®¤çš„å‡½æ•°ï¼Œåœ¨é»˜è®¤çš„å‡½æ•°ä¸­ï¼Œæ„é€ å‡½æ•°ã€ææ„å‡½æ•°é»˜è®¤ç©ºå®ç°ï¼Œæ‹·è´æ„é€ å‡½æ•°ã€èµ‹å€¼å·é‡è½½å‡½æ•°é»˜è®¤æ˜¯æµ…æ‹·è´ã€‚ æ‹·è´æ„é€ å‡½æ•°ä½œç”¨ï¼š å‚æ•°æ˜¯ä¸€ä¸ªåŒç±»å‹çš„å¯¹è±¡ï¼Œç›´æ¥æ‹·è´è¿™ä¸ª","title":"C++å­¦ä¹ è®°å½•(5) ç±»"},{"content":"0. å¼•ç”¨çš„æœ¬è´¨ æœ¬è´¨ï¼šå¼•ç”¨åœ¨C++å†…éƒ¨çš„å®ç°æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡ï¼ˆ* constï¼‰ã€‚\nconstå°±é™åˆ¶äº†å¿…é¡»è¦åˆå§‹åŒ–ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä»¥åä¸å¯æ›´æ”¹ã€‚\nå®ƒä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æ²¡æœ‰å¼•ç”¨çš„å¼•ç”¨ã€‚\n1. æ³¨æ„äº‹é¡¹ å¼•ç”¨å¿…é¡»åˆå§‹åŒ– å¼•ç”¨åœ¨åˆå§‹åŒ–åä¸å¯ä¿®æ”¹ 2. å¼•ç”¨åšå‡½æ•°å‚æ•° ä¸æŒ‡é’ˆä¼ é€’ç›¸ä¼¼\n3. å¼•ç”¨åšå‡½æ•°è¿”å›å€¼ ä¸æŒ‡é’ˆä¸€æ ·ï¼Œä¸è¦è¿”å›å±€éƒ¨å˜é‡ï¼ˆæ ˆåŒºç©ºé—´ï¼‰çš„å¼•ç”¨ å‡½æ•°çš„è°ƒç”¨å¯ä»¥ä½œä¸ºå·¦å€¼ int\u0026amp; test(){ static int a = 10; return a; } int main(){ int \u0026amp;ss = test(); test() = 100; // å¼•ç”¨ä½œä¸ºå·¦å€¼ cout \u0026lt;\u0026lt; ss \u0026lt;\u0026lt; endl; // è¾“å‡º100 return 0; } 4. å¸¸é‡å¼•ç”¨ ä½œç”¨ï¼šåœ¨å‡½æ•°ä¸­ç”¨æ¥ä¿®é¥°å½¢å‚ï¼Œé˜²æ­¢è¯¯æ“ä½œã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/02/cpp-reference/","summary":"0. å¼•ç”¨çš„æœ¬è´¨ æœ¬è´¨ï¼šå¼•ç”¨åœ¨C++å†…éƒ¨çš„å®ç°æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¸¸é‡ï¼ˆ* constï¼‰ã€‚ constå°±é™åˆ¶äº†å¿…é¡»è¦åˆå§‹åŒ–ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä»¥åä¸å¯æ›´æ”¹ã€‚ å®ƒä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æ²¡æœ‰å¼•ç”¨çš„å¼•ç”¨ã€‚ 1. æ³¨æ„äº‹é¡¹ å¼•ç”¨å¿…é¡»åˆå§‹åŒ– å¼•ç”¨åœ¨åˆå§‹åŒ–åä¸å¯ä¿®æ”¹ 2. å¼•ç”¨åšå‡½æ•°å‚æ•° ä¸æŒ‡é’ˆä¼ é€’ç›¸ä¼¼ 3. å¼•ç”¨åšå‡½æ•°è¿”å›å€¼ ä¸æŒ‡é’ˆä¸€æ ·ï¼Œä¸è¦è¿”å›å±€","title":"C++å­¦ä¹ è®°å½•(4) å¼•ç”¨"},{"content":"ä¸¤ä¸ªæ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚\n0. è®°å¿†æ–¹æ³• const int * p; int * const p; int const * p; è¿™æ˜¯å¸¸è§çš„ä¸‰ç§å†™æ³•ï¼ŒæŒ‰ç…§ä»å·¦è‡³å³çš„é¡ºåºè®°å¿†ï¼ŒæŒ‰ç…§ä»å³è‡³å·¦çš„é¡ºåºç†è§£ã€‚\nè®°å¿† åªå…³æ³¨const å’Œ * çš„å…ˆåå…ˆåé¡ºåºï¼Œconstè¯»åšå¸¸é‡ï¼Œ*è¯»åšæŒ‡é’ˆã€‚\nå‚è€ƒã€ŠEffective c++ã€‹Item21ä¸Šçš„åšæ³•ï¼Œå¦‚æœconstä½äºæ˜Ÿå·çš„å·¦ä¾§ï¼Œåˆ™constå°±æ˜¯ç”¨æ¥ä¿®é¥°æŒ‡é’ˆæ‰€æŒ‡å‘çš„å˜é‡ï¼Œå³æŒ‡é’ˆæŒ‡å‘ä¸ºå¸¸é‡ï¼›å¦‚æœconstä½äºæ˜Ÿå·çš„å³ä¾§ï¼Œconstå°±æ˜¯ä¿®é¥°æŒ‡é’ˆæœ¬èº«ï¼Œå³æŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡ã€‚\næ¯”å¦‚\nconst int * p; // å¸¸é‡æŒ‡é’ˆ int * const p;\t// æŒ‡é’ˆå¸¸é‡ int const * p; // å¸¸é‡æŒ‡é’ˆ ç†è§£ å°† * è¯»åšæŒ‡å‘ã€‚\nconst int * p; // pæŒ‡å‘ä¸€ä¸ªconst int * const p; // å¸¸é‡p æŒ‡å‘ä¸€ä¸ª int int const * p; // pæŒ‡å‘ä¸€ä¸ªconst 1. æŒ‡é’ˆå¸¸é‡ int * const p; // å¸¸é‡p æŒ‡å‘ä¸€ä¸ª int é‡ç‚¹åœ¨â€œå¸¸é‡â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæŒ‡é’ˆä¸€æ—¦æŒ‡å‘äº†ä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å¯ä»¥å†æŒ‡å‘åˆ«çš„åœ°å€ç©ºé—´ã€‚\n2. å¸¸é‡æŒ‡é’ˆ const int * p; // pæŒ‡å‘ä¸€ä¸ªconst int const * p; // pæŒ‡å‘ä¸€ä¸ªconst é‡ç‚¹åœ¨â€œæŒ‡é’ˆâ€ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨constä¿®é¥°çš„æŒ‡é’ˆï¼Œå®ƒæ—¢å¯ä»¥æŒ‡å‘å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘å˜é‡ã€‚\næ‰€è°“çš„â€œå¸¸é‡â€æŒ‡é’ˆæˆ–è€…â€œå¸¸é‡â€å¼•ç”¨ï¼Œä¸è¿‡æ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨â€œè‡ªä»¥ä¸ºæ˜¯â€ç½¢äº†ï¼Œåªæ˜¯ä¸èƒ½é€šè¿‡è¯¥æŒ‡é’ˆæˆ–å¼•ç”¨æ¥ä¿®æ”¹å¯¹è±¡çš„å€¼ã€‚\ncode:\nint a = 15; const int *p = \u0026amp;a; cout \u0026lt;\u0026lt; *p \u0026lt;\u0026lt; endl; output:\n15 é€šè¿‡æŒ‡é’ˆä¿®æ”¹ int a = 15; const int *p = \u0026amp;a; *p = 10; // é€šè¿‡å¸¸é‡æŒ‡é’ˆä¿®æ”¹ cout \u0026lt;\u0026lt; *p \u0026lt;\u0026lt; endl; output:\nç¼–è¯‘æŠ¥é”™ é€šè¿‡å˜é‡è‡ªèº«ä¿®æ”¹ int a = 15; const int *p = \u0026amp;a; a = 10; // é€šè¿‡å˜é‡è‡ªèº«ä¿®æ”¹ cout \u0026lt;\u0026lt; *p \u0026lt;\u0026lt; endl; output:\n10 3. åº•å±‚constå’Œé¡¶å±‚const å¯¹äºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡æ¥è¯´ï¼Œå®ƒæœ¬èº«å¯ä»¥æ˜¯constçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªå¯ä»¥æŒ‡å‘åˆå§‹åŒ–çš„åœ°å€ï¼Œä¸å¯ä»¥å†æŒ‡å‘å…¶ä»–åœ°å€ç©ºé—´ã€‚å¦å¤–ï¼ŒæŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯constçš„ï¼Œè¿™å°±å«åº•å±‚constï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ‰€æŒ‡çš„åœ°å€ç©ºé—´æˆ–è€…å¯¹è±¡æ˜¯ä¸å¯ä»¥é€šè¿‡å®ƒä¿®æ”¹çš„ï¼ˆå‰è¾¹è¯´è¿‡ï¼Œè¿™æ˜¯â€œè‡ªä»¥ä¸ºæ˜¯â€çš„ï¼‰ã€‚\nåœ¨æ‰§è¡Œæ‹·è´æ“ä½œæ—¶ï¼Œé¡¶å±‚constä¸å—å½±å“ï¼Œæ‹·å…¥å’Œæ‹·å‡ºçš„å¯¹è±¡æ˜¯å¦æ˜¯å¸¸é‡æ²¡æœ‰å…³ç³»ã€‚\nè€Œåº•å±‚constä¸å¯ä»¥ï¼Œæ‹·å…¥å’Œæ‹·å‡ºçš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸åŒçš„åº•å±‚constèµ„æ ¼ï¼Œæˆ–è€…ä¸¤ä¸ªå¯¹è±¡çš„æ•°æ®ç±»å‹å¿…é¡»èƒ½å¤Ÿè½¬æ¢ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œéå¸¸é‡å¯ä»¥è½¬æ¢ä¸ºå¸¸é‡ï¼Œåä¹‹åˆ™ä¸è¡Œã€‚\nå‡ ä¸ªè½¬æ¢çš„ä¾‹å­\n// å˜é‡å£°æ˜ const int v2 = 0; int v1 = v2; int *p1 = \u0026amp;v1, \u0026amp;r1 = v1; const int *p2 = \u0026amp;v2, *const p3 = \u0026amp;i, \u0026amp;r2 = v2; // ä¸‹åˆ—å“ªäº›æ˜¯åˆæ³•çš„ï¼Ÿ r1 = v2; // åˆæ³• p1 = p2; // ä¸åˆæ³•ï¼Œp1æ˜¯å˜é‡ï¼Œp2æ˜¯åº•å±‚constã€‚äºŒè€…è¦ä¹ˆéƒ½æœ‰åº•å±‚constï¼Œè¦ä¹ˆæ˜¯å˜é‡èµ‹ç»™å¸¸é‡ã€‚ p2 = p1; // åˆæ³•ï¼Œ p1æ˜¯å˜é‡ï¼Œp2æ˜¯åº•å±‚constã€‚æ‰§è¡Œçš„æ˜¯å˜é‡è½¬åˆ°å¸¸é‡ã€‚ p1 = p3; // ä¸åˆæ³•ï¼Œp1æ˜¯å˜é‡ï¼Œp3æ˜¯é¡¶å±‚const+åº•å±‚constï¼ŒäºŒè€…è¦ä¹ˆéƒ½æœ‰åº•å±‚constï¼Œè¦ä¹ˆæ˜¯å˜é‡èµ‹ç»™å¸¸é‡ã€‚ p2 = p3; // åˆæ³•ï¼Œp2æ˜¯åº•å±‚constï¼Œp3æ˜¯é¡¶å±‚const+åº•å±‚constï¼ŒäºŒè€…éƒ½æœ‰åº•å±‚constèµ„æ ¼ã€‚ 4. é€šè¿‡åœ°å€ä¿®æ”¹constä¿®é¥°çš„å˜é‡ ä½¿ç”¨constä¿®é¥°å˜é‡ä»¥åï¼Œè¯¥å˜é‡å°±æˆä¸ºäº†ä¸€ä¸ªå¸¸é‡ã€‚ä½¿ç”¨èµ‹å€¼çš„æ–¹å¼å¯¹è¯¥å˜é‡ç›´æ¥è¿›è¡Œä¿®æ”¹æ˜¯è¡Œä¸é€šçš„ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡å˜é‡çš„åœ°å€è¿›è¡Œä¿®æ”¹ï¼ˆåšä¸€æ¬¡å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ã€‚\nconst int a = 2; int *p = const_cast\u0026lt;int*\u0026gt;(\u0026amp;a); (*p)++; cout \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; (*p) \u0026lt;\u0026lt; endl; ä¸Šè¾¹ä»£ç è¾“å‡ºçš„æ˜¯\n2 3 ä¸ºä»€ä¹ˆï¼Ÿ\nå†æ¬¡è¾“å‡ºå˜é‡açš„åœ°å€å’Œpæ‰€æŒ‡å‘çš„åœ°å€ï¼Œä¹Ÿæ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯è¾“å‡ºçš„æ—¶å€™aå´æ˜¾ç¤º3ã€‚åŸå› åœ¨äºï¼šC++ä¸­çš„å¸¸é‡æŠ˜å ã€‚æŒ‡constå˜é‡ï¼ˆå³å¸¸é‡ï¼‰å€¼æ”¾åœ¨ç¼–è¯‘å™¨çš„ç¬¦å·è¡¨ä¸­ï¼Œè®¡ç®—æ—¶ç¼–è¯‘å™¨ç›´æ¥ä»è¡¨ä¸­å–å€¼ï¼Œçœå»äº†è®¿é—®å†…å­˜çš„æ—¶é—´ï¼Œä»è€Œè¾¾åˆ°äº†ä¼˜åŒ–ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/02/cpp-constant-pointer-and-pointer-constant/","summary":"ä¸¤ä¸ªæ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ¦‚å¿µã€‚ 0. è®°å¿†æ–¹æ³• const int * p; int * const p; int const * p; è¿™æ˜¯å¸¸è§çš„ä¸‰ç§å†™æ³•ï¼ŒæŒ‰ç…§ä»å·¦è‡³å³çš„é¡ºåºè®°å¿†ï¼ŒæŒ‰ç…§ä»å³è‡³å·¦çš„é¡ºåºç†è§£ã€‚ è®°å¿† åªå…³æ³¨const å’Œ * çš„å…ˆåå…ˆåé¡ºåºï¼Œconstè¯»åšå¸¸é‡ï¼Œ*è¯»åšæŒ‡é’ˆã€‚ å‚è€ƒã€ŠEffective c++ã€‹Item21ä¸Šçš„åšæ³•ï¼Œå¦‚æœconstä½äºæ˜Ÿå·çš„å·¦ä¾§","title":"C++å­¦ä¹ è®°å½•(3) å¸¸é‡æŒ‡é’ˆä¸æŒ‡é’ˆå¸¸é‡"},{"content":"1. å•è°ƒæ ˆ 1.1 å¯è§£å†³çš„é—®é¢˜ å•è°ƒæ ˆçš„ä½¿ç”¨åœºæ™¯æ—¶åˆ†æœ‰é™ï¼Œåªå¤„ç†ä¸€ç§å…¸å‹çš„é—®é¢˜ï¼Œå«åš Next Greater Elementã€‚\nä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ•°å·¦è¾¹ï¼ˆå³è¾¹ï¼‰ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§ï¼ˆå°ï¼‰çš„æ•°æ˜¯ä»€ä¹ˆã€‚\n1.2 è¯¦è§£ ç›´æ¥ä¸Šä¾‹å­è§£é‡Šå®ƒã€‚\né¢˜ç›®ï¼šç»™å‡ºä¸€ä¸ªåŸå§‹æ•°ç»„ a[3, 4, 2, 7, 5]ï¼Œè¾“å‡ºæ¯ä¸ªæ•°å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æ•°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º-1ã€‚\nè§£é‡Šï¼šç¬¬ä¸€ä¸ª3å·¦è¾¹æ²¡æœ‰æ•°ï¼Œç­”æ¡ˆæ˜¯-1ï¼Œ4å·¦è¾¹ç¬¬ä¸€ä¸ªå°çš„æ•°æ˜¯3ï¼Œ2å·¦è¾¹æ²¡æœ‰æ¯”2å°çš„æ•°ï¼Œç­”æ¡ˆæ˜¯-1ï¼Œ7å·¦è¾¹ç¬¬ä¸€ä¸ªå°çš„æ•°æ˜¯2ï¼Œ5å·¦è¾¹ç¬¬ä¸€ä¸ªå°çš„æ•°æ˜¯2ï¼Œæ‰€ä»¥æœ€åç­”æ¡ˆæ˜¯[-1, 3, -1, 2, 2]ã€‚\n1.2.0 æš´åŠ›åšæ³• é¦–å…ˆï¼Œä¸€èˆ¬çš„æš´åŠ›åšæ³•æ˜¯éå†æ•´ä¸ªæ•°ç»„ï¼Œéå†åˆ°æŸä¸ªæ•°æ—¶ï¼Œä»å®ƒå¼€å§‹å‘å‰éå†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æ•°ï¼Œä½†æ˜¯è¿™æ ·åšçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n^2)ã€‚\n1.2.1 ä¼˜åŒ–çš„æ€è·¯ åœ¨éå†æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ç§æƒ…å†µï¼šå·²ç»éå†çš„å…ƒç´ å‘ˆâ€œå·¦å¤§å³å°â€ã€‚\nå‡è®¾æ­¤æ—¶å·²ç»éå†è¿‡çš„å…ƒç´ æ˜¯[Â·Â·Â·, 4ï¼Œ 2]ï¼ˆå·¦å¤§å³å°ï¼‰ï¼Œé‚£ä¹ˆï¼Œå¦‚æœå½“å‰éå†åˆ°çš„å…ƒç´ æ˜¯5ï¼ˆæ¯”2å’Œ4éƒ½è¦å¤§ï¼‰ï¼Œé‚£ä¹ˆè‚¯å®šç­”æ¡ˆå–2ï¼›\nå¦‚æœå½“å‰éå†åˆ°çš„å…ƒç´ æ˜¯3ï¼ˆä»‹äº2å’Œ4ä¹‹é—´ï¼‰ï¼Œé‚£ä¹ˆç­”æ¡ˆè‚¯å®šå–2ï¼›\nå¦‚æœå½“å‰éå†åˆ°çš„å…ƒç´ æ˜¯1ï¼ˆæ¯”2å’Œ4éƒ½è¦å°ï¼‰ï¼Œé‚£ä¹ˆç›¸å½“äºåˆé‡å¤äº†æœ€å¼€å§‹å·¦å¤§å³å°çš„å‡è®¾ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸è€ƒè™‘ã€‚\nä»ä¸Šè¿°å‡è®¾å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ€ä¹ˆæ ·ï¼Œåªè¦ 2 å­˜åœ¨ï¼Œ4å°±æ°¸è¿œä¸ä¼šæ˜¯ç­”æ¡ˆï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼šå¦‚æœå·²ç»éå†çš„å…ƒç´ å‘ˆå•è°ƒå‡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå…¶å®åªæœ‰æœ€å°çš„é‚£ä¸ªæ‰æœ‰ç”¨ï¼ˆæœ€å³è¾¹çš„æœ€å°ï¼‰ï¼Œå…¶ä»–å·¦è¾¹çš„å…ƒç´ éƒ½ä¸ç”¨å†è€ƒè™‘äº†ã€‚\nå…¶å®ï¼Œåœ¨æœ´ç´ çš„è§£æ³•ä¸­ï¼Œå·²ç»éå†çš„å…ƒç´ æ˜¯æ‚ä¹±æ— ç« çš„ï¼Œæ—¢æœ‰å·¦å¤§å³å°ï¼Œä¹Ÿæœ‰å·¦å°å³å¤§ï¼Œé€šè¿‡ä¸Šé¢çš„ä¼˜åŒ–æ€è·¯å¯ä»¥çœ‹å‡ºï¼Œåœ¨æœ¬é¢˜ä¸­â€œå·¦å¤§å³å°â€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æƒ…å†µè¿‡æ»¤æ‰ï¼Œåªä¿ç•™â€œå·¦å°å³å¤§â€çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯åªä¿ç•™å•è°ƒå¢çŠ¶æ€ã€‚\n1.2.2 ä¸ºä»€ä¹ˆæ˜¯æ ˆï¼Ÿ ä»ä¸Šè¾¹ä¼˜åŒ–æ€è·¯å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå·²ç»éå†è¿‡çš„å…ƒç´ ï¼Œæˆ‘ä»¬åªåœ¨è¿™äº›å…ƒç´ çš„å°¾éƒ¨è¿›è¡Œæ“ä½œäº†ï¼Œè¿‡æ¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå°±ç”¨æœ€åçš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ€åçš„å…ƒç´ æ¯”æ–°å…ƒç´ å¤§ï¼Œé‚£ä¹ˆæœ€åçš„å…ƒç´ å°±åˆ é™¤æ‰ï¼Œç›´åˆ°å…¨éƒ½åˆ é™¤æˆ–è€…åˆ åˆ°äº†ä¸€ä¸ªæ¯”æ–°å…ƒç´ å°çš„å…ƒç´ ä¸ºæ­¢ã€‚åªåœ¨ä¸€ç«¯æ“ä½œï¼Œé‚£è¿™æ­£å¥½ç¬¦åˆæ ˆçš„ç»“æ„ï¼Œåªåœ¨æ ˆé¡¶æ–°å¢å’Œåˆ é™¤ã€‚\nå…¶å®ï¼Œç¬¦åˆè¿™æ ·æ“ä½œçš„æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥æ˜¯vectorã€dequeç­‰ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šéƒ½æ˜¯ç”¨è¿™äº›æ•°æ®ç»“æ„æ¨¡æ‹Ÿäº†ä¸€ä¸ªæ ˆã€‚\n1.2.3 æ¨¡ç‰ˆä»£ç  ä¸Šè¾¹ä¾‹é¢˜çš„ä»£ç \n#include \u0026lt;iostream\u0026gt; #include \u0026lt;stack\u0026gt; using namespace std; int n; stack\u0026lt;int\u0026gt; s; int main(){ cin \u0026gt;\u0026gt; n; for(int i = 0; i \u0026lt; n; i++){ int x; cin \u0026gt;\u0026gt; x; while(!s.empty() \u0026amp;\u0026amp; s.top() \u0026gt;= x) s.pop(); // ä¸€æ¬¡æ¯”è¾ƒæ ˆé¡¶å…ƒç´ ä¸å½“å‰æ–°å…ƒç´  if(!s.empty()) cout \u0026lt;\u0026lt; s.top() \u0026lt;\u0026lt; \u0026#34; \u0026#34;; // æ‰¾åˆ°å½“å‰å…ƒç´ xå·¦è¾¹ç¬¬ä¸€ä¸ªå°çš„æ•° else cout \u0026lt;\u0026lt; -1 \u0026lt;\u0026lt; \u0026#34; \u0026#34;; s.push(x); // å°†xæ”¾å…¥æ ˆä¸­ } return 0; } 1.3 å³è¾¹ç¬¬ä¸€ä¸ªå¤§ï¼ˆå°ï¼‰çš„æ•°ï¼Ÿ ä¸Šè¾¹ä¾‹å­æ˜¯æ‰¾å·¦è¾¹ç¬¬ä¸€ä¸ªå°çš„æ•°ï¼Œé‚£ä¹ˆæ‰¾ç¬¬ä¸€ä¸ªå¤§çš„æ•°ï¼Œåªè¦ä¿®æ”¹ä¸€ä¸‹æ ˆçš„å•è°ƒæ€§å³å¯ã€‚\nå¦‚æœæ˜¯æ‰¾å³è¾¹ç¬¬ä¸€ä¸ªå¤§æˆ–è€…å°çš„æ•°ï¼Œé‚£ä¹ˆå¯ä»¥å°†åŸå§‹æ•°ç»„ä»åå¾€å‰éå†ï¼Œå°±è½¬æ¢åˆ°å·¦è¾¹ç¬¬ä¸€ä¸ªå¤§æˆ–è€…å°çš„æ•°è¿™ä¸ªé—®é¢˜ä¸Šäº†ã€‚\n1.4 æ•°ç»„æ˜¯ç¯å½¢çš„ï¼Ÿ ä¸Šè¾¹ä¾‹å­ä¸­ï¼Œä¿®æ”¹ä¸€ä¸‹ï¼Œæ‰¾å·¦ä¾§ç¬¬ä¸€ä¸ªæ¯”è‡ªå·±å°çš„æ•°ï¼Œå¦‚æœå·¦ä¾§æ²¡æœ‰å°±ä»å³ä¾§åå‘æ‰¾ã€‚è¿™æ ·å°±ç›¸å½“äºä¸€ä¸ªç¯å½¢æ•°ç»„ã€‚\nè§£å†³åŠæ³•å°±æ˜¯å°†åŸå§‹æ•°ç»„ç¿»å€ï¼Œå°†aå¤åˆ¶ä¸€ä¸‹è¿æ¥åˆ°è‡ªå·±åè¾¹ï¼Œå°±å¯ä»¥è§£å†³ã€‚\n2. å•è°ƒé˜Ÿåˆ— 2.1 å¯è§£å†³çš„é—®é¢˜ å¯ä»¥è§£å†³æ»‘åŠ¨çª—å£é—®é¢˜ï¼Œä¾‹å¦‚ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œä¸€ä¸ªå¤§å°ä¸ºkçš„æ»‘åŠ¨çª—å£ï¼Œçª—å£ä»å·¦å‘å³ä¾æ¬¡æ»‘åŠ¨ï¼Œè¦æ±‚æ‰¾å‡ºæ¯ä¸ªçª—å£å†…çš„æœ€å€¼ã€‚\n2.2 è¯¦è§£ ç›´æ¥ä¸Šä¾‹å­è§£é‡Šå®ƒã€‚\né¢˜ç›®ï¼šç»™å‡ºä¸€ä¸ªåŸå§‹æ•°ç»„ a[1, 3, -1, -3, 5, 3, 6, 7]ï¼Œçª—å£å¤§å° k = 3ï¼Œçª—å£æ¯æ¬¡å‘å³æ»‘åŠ¨ 1 ä¸ªä½ç½®ï¼Œè¾“å‡ºçª—å£åœ¨æ¯ä¸ªä½ç½®æ—¶ï¼Œçª—å£ä¸­çš„æœ€å°å€¼ã€‚\nè§£é‡Šï¼š\nçª—å£ä½ç½® æœ€å°å€¼ [1 3 -1] -3 5 3 6 7 -1 1 [3 -1 -3] 5 3 6 7 -3 1 3 [-1 -3 5] 3 6 7 -3 1 3 -1 [-3 5 3] 6 7 -3 1 3 -1 -3 [5 3 6] 7 3 1 3 -1 -3 5 [3 6 7] 3 2.2.0 æš´åŠ›åšæ³• éå†æ•°ç»„aä¸­æ¯ä¸ªå…ƒç´ ï¼Œéå†åˆ°æŸä¸ªå…ƒç´ æ—¶ï¼Œéå†åŒ…æ‹¬å®ƒè‡ªå·±ä»¥åŠå‰è¾¹çš„ä¸€å…± k ä¸ªå…ƒç´ ï¼Œæ‰¾åˆ°æœ€å°çš„ã€‚\n2.2.1 ä¼˜åŒ–æ€è·¯ éå†æ—¶ï¼Œæˆ‘ä»¬ä¾ç„¶è€ƒè™‘ä¸€ç§æƒ…å†µï¼šå·²ç»éå†çš„å…ƒç´ å‘ˆâ€œå·¦å¤§å³å°â€ã€‚\nå‡è®¾çª—å£é•¿åº¦k = 3ï¼Œæ­¤æ—¶å·²ç»éå†è¿‡çš„å…ƒç´ æ˜¯[4ï¼Œ2]ï¼ˆå·¦å¤§å³å°ï¼‰ï¼Œé‚£ä¹ˆï¼Œå¦‚æœå½“å‰éå†åˆ°çš„å…ƒç´ æ˜¯5ï¼ˆæ¯”2å’Œ4éƒ½è¦å¤§ï¼‰ï¼Œé‚£ä¹ˆå½“å‰çª—å£ä¸º [4, 2, 5] ,è‚¯å®šç­”æ¡ˆå–2ï¼›\nå¦‚æœå½“å‰éå†åˆ°çš„å…ƒç´ æ˜¯3ï¼ˆä»‹äº2å’Œ4ä¹‹é—´ï¼‰ï¼Œé‚£ä¹ˆå½“å‰çª—å£ä¸º [4, 2, 3] ï¼Œç­”æ¡ˆè‚¯å®šå–2ï¼›\nå¦‚æœå½“å‰éå†åˆ°çš„å…ƒç´ æ˜¯1ï¼ˆæ¯”2å’Œ4éƒ½è¦å°ï¼‰ï¼Œé‚£ä¹ˆå½“å‰çª—å£ä¸º [4, 2, 1] ï¼Œç­”æ¡ˆè‚¯å®šå–1ï¼›\nä»ä¸Šè¿°å‡è®¾å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ€ä¹ˆæ ·ï¼Œåªè¦ 2 å­˜åœ¨ï¼Œ4å°±æ°¸è¿œä¸ä¼šæ˜¯ç­”æ¡ˆï¼Œé™¤é2å·²ç»ä¸åœ¨çª—å£ä¸­äº†ï¼Œå¦‚æœ2ä¸åœ¨çª—å£ä¸­ï¼Œé‚£ä¹ˆ4è‚¯å®šæ—©å°±ä¸åœ¨çª—å£ä¸­äº†ã€‚\nå¯ä»¥å¾—å‡ºç»“è®ºï¼šå¦‚æœçª—å£å†…çš„å…ƒç´ å‘ˆå•è°ƒå‡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå…¶å®åªæœ‰æœ€å°çš„é‚£ä¸ªæ‰æœ‰ç”¨ï¼Œå…¶ä»–å·¦è¾¹çš„å…ƒç´ éƒ½ä¸ç”¨å†è€ƒè™‘äº†ã€‚\nåœ¨æœ´ç´ çš„è§£æ³•ä¸­ï¼Œçª—å£å†…çš„å…ƒç´ æ˜¯æ‚ä¹±æ— ç« çš„ï¼Œæ—¢æœ‰å·¦å¤§å³å°ï¼Œä¹Ÿæœ‰å·¦å°å³å¤§ï¼Œé€šè¿‡ä¸Šé¢çš„ä¼˜åŒ–æ€è·¯å¯ä»¥çœ‹å‡ºï¼Œåœ¨æœ¬é¢˜ä¸­â€œå·¦å¤§å³å°â€æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æƒ…å†µè¿‡æ»¤æ‰ï¼Œåªä¿ç•™â€œå·¦å°å³å¤§â€çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯åªä¿ç•™å•è°ƒå¢çŠ¶æ€ã€‚\nè¿‡æ»¤æ‰äº†ä¸€éƒ¨åˆ†å…ƒç´ ï¼Œé‚£ä¹ˆçª—å£å†…çš„å…ƒç´ è‚¯å®šå˜å°‘äº†ï¼Œå°±ä¸æ˜¯é¢˜ç›®è¯´çš„å›ºå®šé•¿åº¦käº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‡æƒ³å‡ºæœ‰ä¸€ä¸ªé•¿åº¦å¯å˜çš„çª—å£ï¼Œå®ƒçš„æœ€å¤§é•¿åº¦æ˜¯kï¼Œè¿™ä¸ªçª—å£å†…çš„å…ƒç´ å•è°ƒé€’å¢ï¼ˆä»å·¦å‘å³çœ‹æ˜¯å•è°ƒé€’å¢ï¼‰ã€‚\nå¯å˜çª—å£çš„æœ€å·¦è¾¹å…ƒç´ ç»´æŠ¤çš„å°±æ˜¯â€œåˆ°å½“å‰ä½ç½®ä¸ºæ­¢ï¼Œå‰kä¸ªå…ƒç´ ä¸­çš„æœ€å°å€¼â€ã€‚\n2.2.2 ä¸ºä»€ä¹ˆæ˜¯é˜Ÿåˆ—ï¼Ÿ è¿™é‡Œå¯ä»¥å‚è€ƒä¸Šè¾¹å•è°ƒæ ˆçš„è§£é‡Šï¼Œå•è°ƒæ ˆæ˜¯åœ¨ä¸€ç«¯è¿›è¡Œæ–°å¢å’Œåˆ é™¤ã€‚è€Œå¯¹äºæˆ‘ä»¬å‡æƒ³å‡ºæ¥çš„è¿™ä¸ªçª—å£æ¥è¯´ï¼Œä¸ä»…è¦åœ¨ä¸€ç«¯è¿›è¡Œæ–°å¢å’Œåˆ é™¤ï¼Œè¿˜éœ€è¦éšæ—¶åœ¨å¦ä¸€ç«¯å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ ã€‚\né‚£è¿™æ­£å¥½ç¬¦åˆåŒç«¯é˜Ÿåˆ—dequeçš„ç‰¹ç‚¹ï¼ŒåŒç«¯é˜Ÿåˆ—ï¼Œä¸¤ç«¯éƒ½å¯ä»¥è¿›è¡Œåˆ é™¤ã€æ–°å¢ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥è¯¢é˜Ÿé¦–å…ƒç´ ã€‚\nç¬¦åˆè¿™æ ·æ“ä½œçš„æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥æ˜¯vectorç­‰ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šéƒ½æ˜¯ç”¨è¿™äº›æ•°æ®ç»“æ„æ¨¡æ‹Ÿäº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ã€‚\n2.2.3 æ¨¡æ¿ä»£ç  #include \u0026lt;iostream\u0026gt; using namespace std; const int N = 1e6 + 5; int n, k, q[N], a[N]; int hh = 0, tt = -1; // é˜Ÿåˆ—å¤´å’Œå°¾ é˜Ÿåˆ—å­˜å‚¨çš„æ˜¯ä¸‹æ ‡ int main(){ cin \u0026gt;\u0026gt; n \u0026gt;\u0026gt; k; for(int i = 0; i \u0026lt; n; i++) cin \u0026gt;\u0026gt; a[i]; for(int i = 0; i \u0026lt; n; i++){ if(tt \u0026gt;= hh \u0026amp;\u0026amp; q[hh] \u0026lt; i - k + 1) hh++; // åˆ¤æ–­é˜Ÿé¦–æ˜¯å¦ å»¶åäº çª—å£ while(tt \u0026gt;= hh \u0026amp;\u0026amp; a[q[tt]] \u0026gt;= a[i]) tt--; // å¤„ç†å½“å‰çš„ç¬¬ iä¸ªæ•° è¿™ä¸¤è¡Œä¿è¯é˜Ÿåˆ—å•è°ƒ q[++tt] = i; if(i \u0026gt;= k - 1) cout \u0026lt;\u0026lt; a[q[hh]] \u0026lt;\u0026lt; \u0026#34; \u0026#34;; // æ»¡ä¸€ä¸ªçª—å£æ‰å¼€å§‹è¾“å‡ºç»“æœ } return 0; } ","permalink":"https://Clay-Hex.github.io/posts/2021/02/monotone-stack-monotone-queue/","summary":"1. å•è°ƒæ ˆ 1.1 å¯è§£å†³çš„é—®é¢˜ å•è°ƒæ ˆçš„ä½¿ç”¨åœºæ™¯æ—¶åˆ†æœ‰é™ï¼Œåªå¤„ç†ä¸€ç§å…¸å‹çš„é—®é¢˜ï¼Œå«åš Next Greater Elementã€‚ ä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ•°å·¦è¾¹ï¼ˆå³è¾¹ï¼‰ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§ï¼ˆå°ï¼‰çš„æ•°æ˜¯ä»€ä¹ˆã€‚ 1.2 è¯¦è§£ ç›´æ¥ä¸Šä¾‹å­è§£é‡Šå®ƒã€‚ é¢˜ç›®ï¼šç»™å‡ºä¸€ä¸ªåŸå§‹æ•°ç»„ a[3, 4, 2, 7, 5]ï¼Œè¾“å‡ºæ¯ä¸ªæ•°å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„æ•°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º-1ã€‚ è§£é‡Š","title":"å•è°ƒæ ˆä¸å•è°ƒé˜Ÿåˆ—è¯¦è§£"},{"content":"Lambdaè¡¨è¾¾å¼ Lambdaè¡¨è¾¾å¼\nå½¢å¼ [capture](params) -\u0026gt; return-type{ function body } è¯´æ˜ capture éœ€è¦æ•è·çš„å¤–éƒ¨å˜é‡åˆ—è¡¨ï¼ˆè¿™é‡Œçš„å¤–éƒ¨å˜é‡ä¸åŒ…æ‹¬ç¨‹åºçš„å…¨å±€å˜é‡ï¼ŒæŒ‡çš„æ˜¯åŒ¿åå‡½æ•°çˆ¶ä½œç”¨åŸŸå†…çš„å˜é‡ï¼‰ã€‚\nå¦‚æœè¿™ä¸ªåŒ¿åå‡½æ•°éœ€è¦è°ƒç”¨æœ¬åŒ¿åå‡½æ•°ä»¥å¤–çš„å˜é‡ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è¿™ä¸ª[ ] ä¸­è¿›è¡Œæ•è·ï¼Œæ•è·åŒ…æ‹¬æ•è·çš„å˜é‡åç§°å’Œæ•è·çš„æ–¹å¼ï¼ˆå€¼å’Œå¼•ç”¨ï¼‰ã€‚\nä¾‹å¦‚ï¼š\n[ ] è¡¨ç¤ºä¸æ•è·å¤–éƒ¨çš„ä»»ä½•å˜é‡ [=] è¡¨ç¤ºæ•è·å¤–éƒ¨çš„æ‰€æœ‰å˜é‡ï¼ˆçˆ¶ä½œç”¨åŸŸå†…ï¼‰ï¼Œæ˜¯ä»¥å€¼çš„æ–¹å¼æ•è·ï¼ˆä¸å¯ä¿®æ”¹ï¼‰ã€‚ [\u0026amp;] è¡¨ç¤ºæ•è·å¤–éƒ¨çš„æ‰€æœ‰å˜é‡ï¼ˆçˆ¶ä½œç”¨åŸŸå†…ï¼‰ï¼Œæ˜¯ä»¥å¼•ç”¨çš„æ–¹å¼æ•è·ï¼ˆå¯ä¿®æ”¹ï¼‰ã€‚ [=, \u0026amp;x, \u0026amp;y] è¡¨ç¤ºæ•è·å¤–éƒ¨çš„æ‰€æœ‰å˜é‡ï¼ˆçˆ¶ä½œç”¨åŸŸå†…ï¼‰ï¼Œå…¶ä¸­xå’Œyä»¥å¼•ç”¨çš„æ–¹å¼æ•è·ï¼Œå…¶ä»–å˜é‡ä»¥å€¼çš„æ–¹å¼æ•è·ã€‚ [\u0026amp;, x, y] è¡¨ç¤ºæ•è·å¤–éƒ¨çš„æ‰€æœ‰å˜é‡ï¼ˆçˆ¶ä½œç”¨åŸŸå†…ï¼‰ï¼Œå…¶ä¸­xå’Œyä»¥å€¼çš„æ–¹å¼æ•è·ï¼Œå…¶ä»–å˜é‡ä»¥å¼•ç”¨çš„æ–¹å¼æ•è·ã€‚ captureæ³¨æ„äº‹é¡¹ å¦‚æœä¸è¿›è¡Œå˜é‡æ•è·ï¼Œé‚£ä¹ˆåœ¨åŒ¿åå‡½æ•°å†…ï¼Œä¸å¯ä»¥ä½¿ç”¨å¤–éƒ¨å˜é‡ã€‚\næ•è·åˆ—è¡¨å†…ï¼Œä¸å…è®¸é‡å¤æ•è·ã€‚æ¯”å¦‚ [=, a]ï¼Œ=å·²ç»è¯´æ˜æ‰€æœ‰çš„å˜é‡ï¼ˆåŒ…æ‹¬aï¼‰ä»¥å€¼çš„æ–¹å¼æ•è·ï¼Œåè¾¹çš„aåˆè¿›è¡Œäº†ä¸€æ¬¡è¯´æ˜ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚\næ•è·ä»»ä½•éçˆ¶ä½œç”¨åŸŸå†…å˜é‡æˆ–è€…ç¨‹åºçš„å…¨å±€å˜é‡ï¼Œéƒ½ä¼šå‡ºé”™ã€‚\n[this]åªèƒ½ä»¥å€¼çš„æ–¹å¼æ•è·\nparams å‚æ•°åˆ—è¡¨ï¼Œå°±æ˜¯å’Œä¸€èˆ¬çš„å‡½æ•°ä¸€æ ·çš„å‚æ•°åˆ—è¡¨ã€‚\nreturn-type åŒ¿åå‡½æ•°çš„è¿”å›ç±»å‹ã€‚\nè¿”å›ç±»å‹å¯ä»¥çœç•¥ï¼Œc++11å¯ä»¥æ ¹æ®å‡½æ•°ä½“å†…éƒ¨çš„return è‡ªåŠ¨åˆ¤æ–­ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¿”å›ç±»å‹ã€‚\næ€»ç»“ å¦‚æœéœ€è¦ç”¨åˆ°åŒ¿åå‡½æ•°å¤–éƒ¨çš„å˜é‡ï¼Œå°±å¿…é¡»è¦è¿›è¡Œæ•è·ï¼Œéœ€è¦æ³¨æ„æ•è·æ–¹å¼ï¼ˆå€¼å’Œå¼•ç”¨ï¼‰ï¼Œå…¶ä»–æ–¹é¢å’Œä¸€èˆ¬çš„å‡½æ•°æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/01/cpp-lambda-function/","summary":"Lambdaè¡¨è¾¾å¼ Lambdaè¡¨è¾¾å¼ å½¢å¼ [capture](params) -\u0026gt; return-type{ function body } è¯´æ˜ capture éœ€è¦æ•è·çš„å¤–éƒ¨å˜é‡åˆ—è¡¨ï¼ˆè¿™é‡Œçš„å¤–éƒ¨å˜é‡ä¸åŒ…æ‹¬ç¨‹åºçš„å…¨å±€å˜é‡ï¼ŒæŒ‡çš„æ˜¯åŒ¿åå‡½æ•°çˆ¶ä½œç”¨åŸŸå†…çš„å˜é‡ï¼‰ã€‚ å¦‚æœè¿™ä¸ªåŒ¿åå‡½æ•°éœ€è¦è°ƒç”¨æœ¬åŒ¿åå‡½æ•°ä»¥å¤–çš„å˜é‡ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è¿™ä¸ª[ ] ä¸­è¿›è¡Œæ•è·ï¼Œæ•è·åŒ…æ‹¬æ•è·çš„å˜é‡åç§°å’Œæ•è·çš„æ–¹å¼ï¼ˆå€¼å’Œå¼•ç”¨ï¼‰ã€‚ ä¾‹","title":"C++å­¦ä¹ è®°å½•(2) Lambdaè¡¨è¾¾å¼ï¼ˆåŒ¿åå‡½æ•°ï¼‰"},{"content":"0. é‡æ„ é‡æ„æ˜¯å¯¹ç¨‹åºå†…éƒ¨çš„æ¶æ„çš„è°ƒæ•´ã€‚\né‡æ„å¼ºè°ƒçš„æ˜¯åœ¨ä¸æ”¹å˜\u0026quot;è½¯ä»¶å¤–éƒ¨å¯è§‚å¯Ÿçš„è¡Œä¸º\u0026quot;å‰æä¸‹ï¼Œå¯¹å†…éƒ¨ç»“æ„è¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—ä»ç¨‹åºçš„å¤–éƒ¨åŠŸèƒ½ä¸Šçœ‹ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚\nå¦‚ä¸‹ä¾‹å­ï¼š\né‡æ„å‰ä»£ç å¦‚ä¸‹ï¼š\n#include \u0026lt;iostream\u0026gt; class child { private: public: child(){}; void func(){ std::cout \u0026lt;\u0026lt; 123 \u0026lt;\u0026lt; std::endl; } }; int main(int argc, char const *argv[]) { child a; a.func(); return 0; } ç¨‹åºè¿è¡Œåï¼Œè¾“å‡º123.\né‡æ„åçš„ä»£ç å¦‚ä¸‹ï¼š\n#include \u0026lt;iostream\u0026gt; class child { private: public: child(){}; void f1(){std::cout \u0026lt;\u0026lt; 1;} void f2(){std::cout \u0026lt;\u0026lt; 2;} void f3(){std::cout \u0026lt;\u0026lt; 3;} void func(){ f1(); f2(); f3(); std::cout \u0026lt;\u0026lt; std::endl; } }; int main(int argc, char const *argv[]) { child a; a.func(); return 0; } mainå‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾ç„¶æ˜¯è°ƒç”¨açš„funcæ–¹æ³•ï¼Œç¨‹åºçš„è¾“å‡ºä¹Ÿæ˜¯123ï¼Œå¯¹äºå¤–éƒ¨æ¥è¯´æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œä½†æ˜¯funcå†…éƒ¨çš„å®ç°æ–¹å¼å·²ç»æ”¹å˜ã€‚\n1. é‡å†™ é‡å†™ï¼ˆoverrideï¼‰ä¹Ÿå«è¦†ç›–ã€‚\næ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼šâ€œå‡½æ•°ç­¾åâ€ï¼Œå‡½æ•°ç­¾åä¸ä»…ä»…åŒ…æ‹¬å‡½æ•°åï¼Œè¿˜åŒ…æ‹¬å‡½æ•°çš„å‚æ•°ã€å‚æ•°çš„ä¸ªæ•°ã€å‚æ•°çš„é¡ºåºã€æ‰€åœ¨å‘½åç©ºé—´ç­‰ä¿¡æ¯ã€‚ä½†æ˜¯å‡½æ•°ç­¾åä¸åŒ…æ‹¬å‡½æ•°çš„è¿”å›å€¼ç±»å‹ï¼Œå¦‚æœä¸¤ä¸ªå‡½æ•°é™¤äº†è¿”å›å€¼ç±»å‹ä¸åŒä»¥å¤–ï¼Œå…¶ä»–éƒ½ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™åœ¨C++ä¸­æ˜¯ä¸è¢«å…è®¸çš„ã€‚\né‡å†™æ˜¯æŒ‡ä¸æ”¹å˜å‡½æ•°ç­¾åï¼Œæ”¹å˜çš„æ˜¯ä¸€ä¸ªå‡½æ•°å†…éƒ¨ã€‚å¦‚ä¸‹ä»£ç ï¼š\n#include \u0026lt;iostream\u0026gt; class parent { private: public: parent(){}; virtual void func(){ std::cout \u0026lt;\u0026lt; 123 \u0026lt;\u0026lt; std::endl; } }; class child : parent{ public: void func(){ std::cout \u0026lt;\u0026lt; 456 \u0026lt;\u0026lt; std::endl; } }; int main(int argc, char const *argv[]) { child a; a.func(); return 0; } childç»§æ‰¿parentç±»ï¼Œé‡å†™äº†ç±»å†…çš„funcæ–¹æ³•ï¼Œæ²¡æœ‰æ”¹å˜å‡½æ•°ç­¾åï¼Œåªæ”¹å˜å‡½æ•°å†…éƒ¨ä»£ç ã€‚\n2. é‡è½½ é‡è½½æ˜¯æŒ‡ä¸æ”¹å˜å‡½æ•°åï¼Œä½†æ”¹å˜å‡½æ•°çš„å‚æ•°ã€å‚æ•°ä¸ªæ•°ã€å‚æ•°é¡ºåºã€‚é‡è½½æ”¹å˜äº†å‡½æ•°çš„ç­¾åã€‚\nä¸¤ä¸ªåŒåå‡½æ•°è¦åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ ä¸¤ä¸ªå‡½æ•°åªæœ‰è¿”å›å€¼ä¸åŒï¼Œè¿™æ˜¯ä¸å…è®¸çš„ é‡è½½å‡½æ•°æœ‰é»˜è®¤å‚æ•°çš„æ—¶å€™ï¼Œè¯­æ³•ä¸Šæ˜¯å¯ä»¥é€šè¿‡çš„ï¼Œä½†æ˜¯è°ƒç”¨å‡½æ•°å¯èƒ½ä¼šå‡ºç°äºŒä¹‰æ€§ï¼Œç¼–è¯‘ä¸å…è®¸ã€‚ ä»£ç å¦‚ä¸‹ï¼š\n#include \u0026lt;iostream\u0026gt; class parent { private: public: parent(){}; virtual void func(){ std::cout \u0026lt;\u0026lt; 123 \u0026lt;\u0026lt; std::endl; } }; class child : parent{ public: void func(int a){ std::cout \u0026lt;\u0026lt; 456 \u0026lt;\u0026lt; std::endl; } }; int main(int argc, char const *argv[]) { child a; a.func(12); return 0; } childç»§æ‰¿parentç±»ï¼Œé‡è½½äº†ç±»å†…çš„funcæ–¹æ³•ï¼Œæ”¹å˜äº†å‡½æ•°ç­¾åï¼ˆå¢åŠ äº†ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œæ–¹æ³•å†…éƒ¨ä»£ç å¯ä»¥æ”¹å˜ä¹Ÿå¯ä»¥ä¸æ”¹å˜ï¼Œä½†æ˜¯ä¸æ”¹å˜ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2021/01/cpp-override-overload-refactoring/","summary":"0. é‡æ„ é‡æ„æ˜¯å¯¹ç¨‹åºå†…éƒ¨çš„æ¶æ„çš„è°ƒæ•´ã€‚ é‡æ„å¼ºè°ƒçš„æ˜¯åœ¨ä¸æ”¹å˜\u0026quot;è½¯ä»¶å¤–éƒ¨å¯è§‚å¯Ÿçš„è¡Œä¸º\u0026quot;å‰æä¸‹ï¼Œå¯¹å†…éƒ¨ç»“æ„è¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—ä»ç¨‹åºçš„å¤–éƒ¨åŠŸèƒ½ä¸Šçœ‹ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚ å¦‚ä¸‹ä¾‹å­ï¼š é‡æ„å‰ä»£ç å¦‚ä¸‹ï¼š #include \u0026lt;iostream\u0026gt; class child { private: public: child(){}; void func(){ std::cout \u0026lt;\u0026lt; 123 \u0026lt;\u0026lt; std::endl; } }; int main(int argc, char const *argv[]) { child a; a.func(); return 0; } ç¨‹åºè¿è¡Œåï¼Œè¾“å‡º123. é‡","title":"C++å­¦ä¹ è®°å½•(1) é‡å†™ã€é‡è½½ã€é‡æ„ä¸‰è€…åŒºåˆ«"},{"content":"0. æ¬§å‡ é‡Œå¾—ç®—æ³• æ¬§å‡ é‡Œå¾—ç®—æ³•ç”¨äºæ±‚è§£ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ã€‚ä»£ç å¦‚ä¸‹:\nint gcd(int a, int b){ if(b == 0) return a; return gcd(b, a % b); } å½“bä¸º0æ—¶ï¼Œç»“æŸé€’å½’ï¼Œæ­¤æ—¶aå³ä¸ºaå’Œbçš„æœ€å¤§å…¬çº¦æ•°ã€‚\n1. è£´èœ€å®šç† å®šç†å†…å®¹ï¼š\nå¦‚æœaã€bå‡æ˜¯æ•´æ•°ï¼Œåˆ™ä¸€å®šå­˜åœ¨æ•´æ•°xå’Œyï¼Œä½¿å¾—ax + by = gcd(a, b)æˆç«‹ã€‚\næˆ‘ä»¬å¯ä»¥å†æ·±å±‚æ¬¡çš„ç†è§£ä¸€ä¸‹å¼å­ax + by = gcd(a, b)çš„å«ä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´æ•°aå’Œæ•´æ•°bè¿›è¡Œçº¿æ€§è¿ç®—ï¼Œå¯ä»¥æ‹¼å‡‘å‡ºä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•°ã€‚å†æƒ³ä¸€æƒ³ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ‹¼å‡‘å‡ºä»–ä»¬æœ€å¤§å…¬çº¦æ•°çš„æ•´æ•°å€ï¼Ÿæ˜¯çš„ï¼Œå¯ä»¥æ‹¼å‡‘å‡ºä»–ä»¬æœ€å¤§å…¬çº¦æ•°çš„åœ¨æ•´æ•°å€ï¼Œåªè¦xå’Œyè¿›è¡Œå¯¹åº”çš„æ”¾å¤§æˆ–ç¼©å°å°±å¯ä»¥äº†ã€‚\né‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ç­‰å·å³ä¾§æ˜¯gcd(a,b)çš„æ•´æ•°å€ï¼Œå°±ä¸€å®šå­˜åœ¨æ•´æ•°xå’Œæ•´æ•°yã€‚ï¼ˆæ³¨æ„è¿™é‡Œï¼Œåè¾¹ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚è§£çº¿æ€§åŒä½™æ–¹ç¨‹æ—¶ä¼šç”¨åˆ°ï¼‰\næ³¨æ„å®šç†ä¸­è¯´çš„æ˜¯ä¸€å®šå­˜åœ¨æ•´æ•°xå’Œæ•´æ•°yï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•æ‰¾åˆ°xå’Œyï¼Œæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•å¯ä»¥æ‰¾åˆ°æ•´æ•°xå’Œæ•´æ•°yã€‚\n2. æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³• æˆ‘ä»¬å½“å‰æƒ³æ±‚è§£çš„æ–¹ç¨‹æ˜¯\n$$ ax + by = gcd(a, b) \\tag {1} $$ å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼Œé€’å½’çš„ä¸‹ä¸€å±‚åº”è¯¥æ˜¯\n$$ bx' + (a \\% b)y' = gcd(b, a \\% b) \\tag{2} $$ å…¶ä¸­\n$$gcd(b, a \\% b) = gcd(a, b) $$ æ•´ç†ä¸€ä¸‹â‘¡å¼ï¼š\n$$ bx' + (a -(a / b)*b)y' = gcd(a, b)\\\\ ay' + b(x' - (a/b)*b) = gcd(a, b) \\tag{3} $$ â‘ å’Œâ‘¢ç­‰å·å³ä¾§ç›¸ç­‰ï¼Œæ‰€ä»¥å·¦ä¾§ç›¸ç­‰ï¼Œå³ï¼š\n$$ ax + by = ay' + b(x' - (a/b)*y)\\tag{4} $$ ç”±â‘£å¼å¯å¾—ï¼š\n$$ x = y'\\\\ y=x' - (a/b)*y' $$ x\u0026rsquo;å’Œy\u0026rsquo;æ˜¯ä¸‹å±‚çš„ç­”æ¡ˆï¼Œæ‰€ä»¥ï¼Œåªè¦çŸ¥é“ä¸‹å±‚çš„ç­”æ¡ˆï¼Œå°±å¯ä»¥å¾—åˆ°æœ¬å±‚çš„xå’Œyã€‚\né‚£ä¹ˆè¿™æ ·é€’å½’çš„å‡ºå£åœ¨å“ªé‡Œï¼Ÿ\nå‡ºå£ä¾ç„¶æ˜¯æ¬§å‡ é‡Œå¾—ç®—æ³•çš„å‡ºå£ï¼Œå³bä¸º0æ—¶ï¼Œaä¸ºaå’Œbçš„æœ€å¤§å…¬çº¦æ•°ã€‚å¯¹äºæ–¹ç¨‹\n$$ ax + by = gcd(a, b) $$ æ¥è¯´ï¼Œå½“bä¸º0æ—¶ï¼Œgcd(a, b)å°±æ˜¯aã€‚æ‰€ä»¥æ­¤æ—¶x = 1ï¼Œyä»»æ„éƒ½å¯ä»¥ï¼Œé€šå¸¸è®©yç­‰äº0ã€‚\nç»¼ä¸Šï¼Œæˆ‘ä»¬å¯¹åŸæ¥çš„æ¬§å‡ é‡Œå¾—ç®—æ³•ä»£ç è¿›è¡Œä¿®æ”¹ï¼š\nint exgcd(int a, int b, int \u0026amp;x, int \u0026amp;y){ if(b == 0){ x = 1; y = 0; return a; } int d = exgcd(b, a % b, y, x); y -= (a / b) * x; return d; } è¿™é‡Œåœ¨é€’å½’çš„æ—¶å€™ï¼Œxå’Œyå‚æ•°äº¤å‰ä¼ é€’ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿ä»£ç ä¹¦å†™ï¼Œå¯ä»¥è‡ªå·±æ‹é¡ºä¸€ä¸‹ã€‚\n3. æ‰©å±•æ¬§å‡ é‡Œå¾—åº”ç”¨ è§£äºŒå…ƒä¸€æ¬¡ä¸å®šæ–¹ç¨‹ ä¸Šè¾¹è¯´åˆ°æ¬§å‡ é‡Œå¾—å¯ä»¥è§£å†³è§£å‡ºè£´èœ€å®šç†ä¸­çš„xå’Œyï¼Œåœ¨è£´èœ€å®šç†ä¸­æ–¹ç¨‹ä¸º\n$$ax+by=gcd(a,b)$$ ç­‰å·å³ä¾§ä¸ºaå’Œbçš„æœ€å¤§å…¬çº¦æ•°ï¼Œå…¶å®è¿™æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œæ›´ä¸€èˆ¬çš„æƒ…å†µåº”è¯¥æ˜¯ç­‰å·å³ä¾§æ˜¯ä¸€ä¸ªä»»æ„æ•´æ•°ã€‚å³\n$$ax + by =mï¼ˆmä¸ºä»»æ„æ•´æ•°ï¼‰$$ å¯¹äºè¿™ä¸ªæ›´ä¸€èˆ¬çš„æ–¹ç¨‹æ¥è¯´ï¼Œå¦‚æœmä¸æ˜¯gcd(a,b)çš„æ•´æ•°å€ï¼Œåˆ™æ²¡æœ‰æ•´æ•°è§£ï¼Œå¦‚æœmæ˜¯$gcd(a,b)$çš„$k$å€ï¼Œåˆ™æœ‰æ•´æ•°è§£ï¼Œä¸”è§£ä¸º\n$$ x =k*x_0\\\\ y = k*y_0\\\\ $$ å…¶ä¸­ï¼Œ$x_0$å’Œ$y_0$æ˜¯$ax+by=gcd(a,b)$çš„ç»“æœã€‚\nä¸Šè¾¹æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚å‡ºçš„xå’Œyå…¶å®æ˜¯ä¸€ç»„ç‰¹è§£ã€‚\næ–¹ç¨‹$ax + by = m$çš„è§£=é€šè§£ + ç‰¹è§£ã€‚\nç‰¹è§£å·²ç»æœ‰äº†ï¼Œä¸‹é¢å¯¹é€šè§£è¿›è¡Œè¯´æ˜ã€‚\nç°åœ¨å‡è®¾(Xi,Yi)å’Œ(Xj, Yj)æ˜¯ä¸å®šæ–¹ç¨‹ax + by = mçš„ä¸¤ç»„è§£ï¼Œåˆ™æœ‰\n$$ a*Xi + b*Yi = m\\\\ a*Xj + b*Yj = m $$ è”ç«‹ä¸¤ä¸ªæ–¹ç¨‹æœ‰\n$$ a*Xi + b*Yi = a*Xj + b*Yj\\\\ a(Xi-Xj) = -b(Yi - Yj) $$ å·¦å³ä¸¤è¾¹ï¼ŒåŒæ—¶é™¤ä»¥$gcd(a,b)$\n$$ \\frac{a}{gcd}(Xi-Xj) = -\\frac{b}{gcd}(Yi-Yj) $$ aå’Œbå‡é™¤ä»¥ä»–ä»¬çš„æœ€å¤§å…¬çº¦æ•°ä»¥åçš„ç»“æœäº’è´¨ï¼Œæ‰€ä»¥\n$$ \\frac{b}{gcd}æ˜¯(Xi-Xj)çš„å€æ•°ï¼Œè€Œä¸”\\frac{a}{gcd}æ˜¯-(Yi-Yj) çš„å€æ•°ã€‚ $$ å¯è§ï¼Œä»»æ„ä¸¤ä¸ªè§£ä¸­çš„Xä¹‹å·®ï¼Œä¸€å®šæ˜¯$\\frac{b}{gcd}$çš„å€æ•°ï¼ŒYåŒç†ï¼Œæ‰€ä»¥é€šè§£ä¸ºï¼š\n$$ X = x_0 + \\frac{b}{gcd} * k\\\\ Y = y_0 - \\frac{a}{gcd} * k $$ å…¶ä¸­$x_0$äº$y_0$æ˜¯ä¸€ç»„ç‰¹è§£ã€‚\næœ€å°æ­£æ•´æ•°è§£ ä»¥Xä¸ºä¾‹ï¼Œè¦æ±‚Xå¤§äº0ï¼Œä¸”æ˜¯æ»¡è¶³æ¡ä»¶çš„æœ€å°çš„é‚£ä¸ªXå€¼ï¼Œå³æœ€å°æ­£æ•´æ•°è§£ã€‚\né€šè§£ä¸º\n$$ X = x_0 + \\frac{b}{gcd} * k $$ å˜å½¢ä¸º\n$$ x_0 = X - \\frac{b}{gcd} * k $$ è§‚å¯Ÿä¸Šå¼ï¼Œåˆ™æ±‚åŸå¼çš„æœ€å°æ•´æ•°è§£çš„é—®é¢˜å°±è½¬æ¢ä¸ºæ±‚ï¼š$x_0$ % $\\frac{b}{gcd}$çš„æ­£æ•´æ•°ç»“æœã€‚\nå¦‚æœ$x_0$ % $\\frac{b}{gcd}$çš„ç»“æœæ˜¯æ­£æ•°ï¼Œé‚£å°±å·²ç»æ˜¯æœ€å°æ­£æ•´æ•°è§£äº†ï¼Œå¦‚æœ$x_0$ % $\\frac{b}{gcd}$çš„ç»“æœæ˜¯è´Ÿæ•°ï¼Œåˆ™å†åŠ ä¸Šä¸€ä¸ª $\\frac{b}{gcd}$è½¬æˆæ­£æ•°å³æ˜¯ç­”æ¡ˆã€‚\nè§£çº¿æ€§åŒä½™æ–¹ç¨‹ çº¿æ€§åŒä½™æ–¹ç¨‹ï¼š\nax = b(mod m)\nå³ ax % m = bï¼Œæ±‚æ»¡è¶³æ¡ä»¶çš„xã€‚\nå¯¹äºè¿™ä¸ªæ–¹ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è½¬åŒ–ä¸€ä¸‹ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œaxå‡å»mçš„yå€ç­‰äºbï¼Œå³\n$$ ax - my = b $$ è¿™ä¸ªè´Ÿå·å…¶å®å¯ä»¥ç®—ä½œyæœ¬èº«çš„è´Ÿå·ï¼Œä¸Šå¼å°±å˜æˆ\n$$ ax + my = bï¼ˆè¿™ä¸ªyä¸æ˜¯ä¸Šå¼çš„yï¼Œå¤šäº†ä¸ªè´Ÿå·ï¼‰ $$ åˆ°äº†è¿™ä¸€æ­¥ï¼Œåªè¦ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚å‡ºxå’Œyå°±å¥½äº†å‘€ï¼\næ±‚é€†å…ƒ å½“çº¿æ€§åŒä½™æ–¹ç¨‹ax = b(mod m)ä¸­ï¼Œå½“b = 1ï¼Œaå’Œmäº’è´¨æ—¶ï¼Œæ±‚å‡ºçš„xå°±æ˜¯açš„é€†å…ƒï¼Œè®°ä½œ$a^-1$ã€‚\n","permalink":"https://Clay-Hex.github.io/posts/2020/09/exgcd-cpp-code/","summary":"0. æ¬§å‡ é‡Œå¾—ç®—æ³• æ¬§å‡ é‡Œå¾—ç®—æ³•ç”¨äºæ±‚è§£ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ã€‚ä»£ç å¦‚ä¸‹: int gcd(int a, int b){ if(b == 0) return a; return gcd(b, a % b); } å½“bä¸º0æ—¶ï¼Œç»“æŸé€’å½’ï¼Œæ­¤æ—¶aå³ä¸ºaå’Œbçš„æœ€å¤§å…¬çº¦æ•°ã€‚ 1. è£´èœ€å®šç† å®šç†å†…å®¹ï¼š å¦‚æœaã€bå‡æ˜¯æ•´æ•°ï¼Œåˆ™ä¸€å®šå­˜åœ¨æ•´æ•°xå’Œyï¼Œä½¿å¾—ax + by = gcd(a, b)æˆç«‹ã€‚ æˆ‘ä»¬å¯ä»¥å†æ·±å±‚æ¬¡çš„ç†è§£ä¸€ä¸‹å¼å­ax + by = gcd(a, b","title":"æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•è¯¦è§£åŠC++ä»£ç å®ç°"},{"content":"æ¨¡æ¿ä»£ç ï¼š\ntypedef long long ll; ll quick_pow(ll a,ll b){ ll res = 1; while(b \u0026gt; 0){ if(b \u0026amp; 1){ res *= a; } a *= a; b \u0026gt;\u0026gt;= 1; } return res; } è¿™é‡Œä»¥a^10ä¸ºä¾‹ï¼Œè¯´ä¸€ä¸‹å¯¹å¿«é€Ÿå¹‚ä»£ç çš„ç†è§£ã€‚\nå³ä¸‹è§’çš„oè¡¨ç¤ºè¿™æ˜¯åè¿›åˆ¶æ•° è¿™é‡Œå†™é”™äº†ï¼Œå›¾ç‰‡ä¸­ä¸åº”è¯¥æ˜¯oï¼Œåº”è¯¥dï¼Œdè¡¨ç¤ºè¿™æ˜¯åè¿›åˆ¶æ•° ï¼Œbè¡¨ç¤ºè¿™æ˜¯äºŒè¿›åˆ¶æ•°ã€‚å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„å‡ ä¸ªå¼å­ï¼Œéƒ½æ˜¯é€æ­¥å˜æ¢å¾—å‡ºæ¥çš„ã€‚\næœ€åä¸€ä¸ªå¼å­å¯ä»¥å¾ˆå¥½çš„ç†è§£æ¨¡æ¿ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç­‰å·å³ä¾§æœ‰4é¡¹ï¼Œè¿™4é¡¹çš„å¹‚æ¬¡æ˜¯1010ï¼Œä¹Ÿå°±æ˜¯10çš„äºŒè¿›åˆ¶è¡¨è¾¾çš„æ¯ä¸€ä½ã€‚æ‰€ä»¥ï¼Œè¿™å°±è¦æ±‚å‡ºå¹‚æŒ‡æ•°10çš„äºŒè¿›åˆ¶çš„æ¯ä¸€ä½ï¼Œè€Œä¸”ï¼Œæœ€åä¸€ä¸ªå¼å­ä¸­ï¼Œå¹‚æ¬¡æ˜¯0çš„é¡¹ï¼ˆç¬¬äºŒé¡¹å’Œç¬¬å››é¡¹ï¼‰å…¶å®æ˜¯1ï¼Œå¯¹ç»“æœæ²¡æœ‰è´¡çŒ®ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ï¼Œæ±‚å‡ºå¹‚æŒ‡æ•°10çš„æ¯ä¸€ä½ä»¥åï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¿™ä¸€ä½æ˜¯0ï¼Œé‚£å°±ä¸äºˆè€ƒè™‘äº†ï¼Œå¦‚æœæ˜¯1çš„è¯ï¼Œå°±æŠŠè¿™ä¸€é¡¹ä¹˜åˆ°åŸæœ‰çš„ç»“æœä¸­ï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„è¿™å‡ è¡Œ\nif(b \u0026amp; 1){ res *= a; } } æ¯æ¬¡åˆ¤æ–­ä»¥åï¼Œè¦æŠŠå¹‚æ¬¡10å‘å³ç§»1ä½ï¼Œå‡†å¤‡è¿›è¡Œä¸‹ä¸€æ¬¡çš„åˆ¤æ–­ã€‚\nb \u0026gt;\u0026gt;= 1; è§‚å¯Ÿç¬¬å››ä¸ªå¼å­ï¼Œçœ‹æ¯ä¸€é¡¹çš„æ‹¬å·é‡Œè¾¹ï¼Œå½“å‰é¡¹å°±æ˜¯ä»–å³è¾¹é¡¹çš„å¹³æ–¹ï¼Œæ‰€ä»¥è¿™è¿˜éœ€è¦ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶è¿™ä¸ªä¸œè¥¿ï¼Œæ¯æ¬¡è‡ªå·±ä¹˜è‡ªå·±å°±å¯ä»¥äº†ï¼Œä»£ç é‡Œç”¨çš„åº•æ•°aæœ¬èº«ã€‚\na *= a; åŒç†ï¼Œå¯ä»¥å¾—åˆ°å¿«é€Ÿä¹˜æ³•çš„ä»£ç \nint qmul(int a, int b){ int ans = 0; while(b){ if(b \u0026amp; 1){ ans += a; } a += a; b \u0026gt;\u0026gt;= 1; } return ans; } ","permalink":"https://Clay-Hex.github.io/posts/2020/03/quick-power/","summary":"æ¨¡æ¿ä»£ç ï¼š typedef long long ll; ll quick_pow(ll a,ll b){ ll res = 1; while(b \u0026gt; 0){ if(b \u0026amp; 1){ res *= a; } a *= a; b \u0026gt;\u0026gt;= 1; } return res; } è¿™é‡Œä»¥a^10ä¸ºä¾‹ï¼Œè¯´ä¸€ä¸‹å¯¹å¿«é€Ÿå¹‚ä»£ç çš„ç†è§£ã€‚ å³ä¸‹è§’çš„oè¡¨ç¤ºè¿™æ˜¯åè¿›åˆ¶æ•° è¿™é‡Œå†™é”™äº†ï¼Œå›¾ç‰‡ä¸­ä¸åº”è¯¥æ˜¯oï¼Œåº”è¯¥dï¼Œdè¡¨ç¤ºè¿™æ˜¯åè¿›åˆ¶æ•° ï¼Œbè¡¨ç¤ºè¿™æ˜¯äºŒè¿›åˆ¶æ•°ã€‚å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„å‡ ä¸ªå¼å­ï¼Œéƒ½æ˜¯é€æ­¥å˜æ¢å¾—å‡ºæ¥çš„ã€‚ æœ€åä¸€ä¸ªå¼","title":"å¯¹å¿«é€Ÿå¹‚ä»£ç çš„ç†è§£"}]